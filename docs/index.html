<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-10-21 Sun 17:38 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Zetteldeft</title>
<meta name="generator" content="Org mode">
<meta name="author" content="EFLS">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel='stylesheet' href='style.css' type='text/css'/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">Zetteldeft</h1>
</header>
<p>
This document contains all the source code to a set of functions for <code>emacs</code> which aim to extend the <code>deft</code> package and turn it into a (very very) basic Zettelkasten note-taking system.
</p>

<p>
Check out the github <a href="https://github.com/EFLS/zetteldeft">repository</a> to get the source.
Read on for an introduction and some documentation.
</p>

<p>
Latest additions:
</p>
<ul class="org-ul">
<li><b>21 Oct</b>: <code>zetteldeft</code> is now a package.</li>
<li><b>10 Oct</b>: Insert contents of files with given search term with <code>zd-org-search-insert</code>.</li>
<li><b>24 Sep</b>: Count the total number of words in your zetteldeft with <code>zd-count-words</code>.</li>
<li><b>25 Aug</b>: Renaming a file with <code>zd-file-rename</code> now also updates filename within the org-file. Also altered <code>zd-after-title</code>.</li>
<li><b>18 July</b>: Include a list of links with <code>zd-insert-list-links</code>, or a list of files with <code>zd-org-search-include</code>.</li>
<li><b>17 July</b>: Insert note title with <code>zd-insert-org-title</code>.</li>
<li><b>16 July</b>: Highlight zetteldeft links in <code>org-mode</code>.</li>
</ul>


<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3780bdd">1. What?</a>
<ul>
<li><a href="#orgd163c86">1.1. A Zettelkasten system for <code>emacs</code> based on <code>deft</code></a></li>
<li><a href="#org76160a7">1.2. How to use this source</a></li>
<li><a href="#org00266a6">1.3. Basic concepts</a></li>
<li><a href="#orgd9dc0e1">1.4. Basic actions</a></li>
<li><a href="#org2e38c30">1.5. An overview</a></li>
</ul>
</li>
<li><a href="#org31dcfe3">2. The <code>zetteldeft</code> package</a>
<ul>
<li><a href="#org558d7d1">2.1. Package setup</a></li>
<li><a href="#org10f3d3b">2.2. Basic <code>zetteldeft</code> functions</a></li>
<li><a href="#org8f86fc6">2.3. Gathering notes</a></li>
<li><a href="#org5b1fcdc">2.4. Aesthetics</a></li>
<li><a href="#orgc27f69e">2.5. Package provided</a></li>
</ul>
</li>
<li><a href="#org00b8b86">3. Suggested setup</a>
<ul>
<li><a href="#org315697e">3.1. Suggested <code>zeteldeft</code> keybindings</a></li>
<li><a href="#org1e38b91">3.2. Suggested <code>deft</code> setup</a></li>
</ul>
</li>
<li><a href="#orga988e9b">4. Brainstorm</a>
<ul>
<li><a href="#orgcef8feb">4.1. Saved searches</a></li>
<li><a href="#orge2a086a">4.2. Generate list of tags</a></li>
<li><a href="#org88afb4d">4.3. HTML export</a></li>
<li><a href="#orgd5f98f4">4.4. Markdown export</a></li>
<li><a href="#org30b8452">4.5. Templates</a></li>
<li><a href="#org16ffd94">4.6. Minor mode</a></li>
</ul>
</li>
</ul>
</div>
</nav>

<div id="outline-container-org3780bdd" class="outline-2">
<h2 id="org3780bdd"><span class="section-number-2">1</span> What?</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgd163c86" class="outline-3">
<h3 id="orgd163c86"><span class="section-number-3">1.1</span> A Zettelkasten system for <code>emacs</code> based on <code>deft</code></h3>
<div class="outline-text-3" id="text-1-1">
<p>
This is my feeble attempt at recreating a Zettelkasten environment by extending the excellent <code>deft</code> package in <code>emacs</code>.<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>
I call it <b>zetteldeft</b>.
</p>

<p>
It is inspired by the <i>The Archive</i> app. For this and more on the Zettelkasten way of taking notes, see <a href="https://zettelkasten.de">zettelkasten.de</a>. They have a forum for discussion on both software and the specifics of the Zettelkasten philosophy.
</p>

<p>
The code that follows is created and maintained for my personal use, shared here in hope that it can benefit others as well.
I&rsquo;d be happy to learn how you use it and expand upon it.
</p>

<p>
It is very much WIP and I&rsquo;m fairly new to <code>elisp</code>, so it might contain some stupid code.
</p>

<p>
Anyway, here we go.
</p>
</div>
</div>

<div id="outline-container-org76160a7" class="outline-3">
<h3 id="org76160a7"><span class="section-number-3">1.2</span> How to use this source</h3>
<div class="outline-text-3" id="text-1-2">
<p>
This package requires:
</p>
<ul class="org-ul">
<li><code>deft</code>, obviously</li>
<li><code>avy</code> to jump &amp; search</li>
</ul>

<p>
From the github repository, either
</p>
<ul class="org-ul">
<li>download the <code>org-file</code> and <code>org-tangle</code> it yourself. It should contain everything.</li>
<li>or download the <code>zetteldeft.el</code> file.</li>
</ul>

<p>
Whichever way you go, load up the package by adding the package to your load path and requiring:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'load-path <span style="color: #98be65;">"~/path/to/folder/"</span>))
(<span style="color: #51afef;">require</span> '<span style="color: #a9a1e1;">zetteldeft</span>)
</pre>
</div>

<p>
and you&rsquo;re good to go!
Well, not quite. First you must read on about the basics of <code>zetteldeft</code>.
</p>
</div>
</div>

<div id="outline-container-org00266a6" class="outline-3">
<h3 id="org00266a6"><span class="section-number-3">1.3</span> Basic concepts</h3>
<div class="outline-text-3" id="text-1-3">
<p>
<b>Notes</b> reside in the <code>deft-directory</code>.
Notes are written in <code>org-mode</code> syntax (although most functions should work in <code>markdown</code> as well).
</p>

<p>
The filename of a note starts with a unique <b>id</b> based on the time and the date, for example: <code>2018-07-09-2115 This is a note.org</code>.
</p>

<p>
This unique id can be used to <b>link</b> notes together.
A link is indicated by a <code>§</code> character, followed by the id.
For example: <code>§2018-07-09-2115</code> should link to the file above.
A link can appear anywhere in the text.
</p>

<p>
When searching <code>deft</code> with the <b>id</b> as a filter, you&rsquo;ll find both the original note (with the id in its name) and all the notes that link to this note (with the id in its body). Do so with <code>zd-search-current-id</code> and <code>zd-avy-link-search</code> respectively
</p>

<p>
Notes can contain <b>tags</b> in plain text: words prepended with a <code>#</code>.
This is a tag: <code>#tag</code>.
Tags make it easy to retrieve notes. They can appear anywhere in the note, but I&rsquo;d suggest putting them somewhere at the top.
</p>
</div>
</div>

<div id="outline-container-orgd9dc0e1" class="outline-3">
<h3 id="orgd9dc0e1"><span class="section-number-3">1.4</span> Basic actions</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Create a note with <code>zd-new-file</code> and provide a name.
</p>

<p>
Insert links to other notes: use <code>zd-find-file-id-insert</code> and select a file from the list.
With <code>zd-find-file-full-title-insert</code>, you guessed it, the note&rsquo;s title is included as well.
To branch out from a current note and link to a new one, use <code>zd-new-file-and-link</code>.
</p>

<p>
To search for a tag or anything else under cursor, use <code>zd-search-at-point</code>.
Combined with the power of <code>avy</code> to jump to any character on screen, use these to jump and search in one go: <code>zd-avy-link-search</code> and <code>zd-avy-tag-search</code>.
</p>

<p>
To open the note behind a link, use <code>zd-avy-file-search</code>.
</p>
</div>
</div>

<div id="outline-container-org2e38c30" class="outline-3">
<h3 id="org2e38c30"><span class="section-number-3">1.5</span> An overview</h3>
<div class="outline-text-3" id="text-1-5">
<p>
While there are more functions, these should be enough to get you started.
Default keybindings are suggested at the bottom of this document.
Here is an overview.
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">Use</th>
<th scope="col" class="org-left">Keybinding</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>zd-new-file</code></td>
<td class="org-left">Create new note and open</td>
<td class="org-left"><code>SPC d n</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-new-file-and-link</code></td>
<td class="org-left">Create new note and insert <code>§</code> id</td>
<td class="org-left"><code>SPC d N</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-find-file-id-insert</code></td>
<td class="org-left">Pick a note and insert its <code>§</code> id</td>
<td class="org-left"><code>SPC d i</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-search-at-point</code></td>
<td class="org-left">Search for thing at point</td>
<td class="org-left"><code>SPC d s</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-file-search</code></td>
<td class="org-left">Select <code>§</code> id and open linked file</td>
<td class="org-left"><code>SPC d f</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-link-search</code></td>
<td class="org-left">Select <code>§</code> id and search for it</td>
<td class="org-left"><code>SPC d l</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-tag-search</code></td>
<td class="org-left">Select <code>#</code> tag and search for it</td>
<td class="org-left"><code>SPC d t</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-search-current-id</code></td>
<td class="org-left">Search for id of current file</td>
<td class="org-left"><code>SPC d c</code></td>
</tr>
</tbody>
</table>

<p>
More details documented below.
</p>
</div>
</div>
</div>

<div id="outline-container-org31dcfe3" class="outline-2">
<h2 id="org31dcfe3"><span class="section-number-2">2</span> The <code>zetteldeft</code> package</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org558d7d1" class="outline-3">
<h3 id="org558d7d1"><span class="section-number-3">2.1</span> Package setup</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org21abc0d" class="outline-4">
<h4 id="org21abc0d"><span class="section-number-4">2.1.1</span> Preamble</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
Some declaration.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">zetteldeft.el --- a simple package                     -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Copyright (C) 2018  EFLS</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Author: EFLS &lt;email&gt;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Keywords: deft zettelkasten zetteldeft</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Version: 0.0.1</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">the Free Software Foundation, either version 3 of the License, or</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">(at your option) any later version.</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">GNU General Public License for more details.</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">You should have received a copy of the GNU General Public License</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">along with this program.  If not, see <a href="http://www.gnu.org/licenses/">&lt;http://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Commentary:</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Zetteldeft: turn deft into a zettelkasten writing system to create linked notes.</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Code:</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org85af7d3" class="outline-4">
<h4 id="org85af7d3"><span class="section-number-4">2.1.2</span> Requirements</h4>
<div class="outline-text-4" id="text-2-1-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">require</span> '<span style="color: #a9a1e1;">deft</span>)

(<span style="color: #51afef;">unless</span> (package-installed-p 'avy)
  (<span style="color: #ECBE7B;">user-error</span> 'zetteldeft <span style="color: #98be65;">"Avy not installed, required for zd-avy-* functions."</span>))
(<span style="color: #51afef;">require</span> '<span style="color: #a9a1e1;">avy</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ded883" class="outline-4">
<h4 id="org2ded883"><span class="section-number-4">2.1.3</span> Customization</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
For easy but minor customization options.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defgroup</span> <span style="color: #ECBE7B;">zetteldeft</span> nil
  <span style="color: #83898d;">"A zettelkasten on top of deft."</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org10f3d3b" class="outline-3">
<h3 id="org10f3d3b"><span class="section-number-3">2.2</span> Basic <code>zetteldeft</code> functions</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-orge723fcd" class="outline-4">
<h4 id="orge723fcd"><span class="section-number-4">2.2.1</span> Search functions</h4>
<div class="outline-text-4" id="text-2-2-1">
</div>
<div id="outline-container-orgbb22b00" class="outline-5">
<h5 id="orgbb22b00"><span class="section-number-5">2.2.1.1</span> <code>zd-get-thing-at-point</code> returns string</h5>
<div class="outline-text-5" id="text-2-2-1-1">
<p>
Returns the thing at point as string.
</p>

<p>
Tries to get, in the following order:
</p>
<ul class="org-ul">
<li>links between <code>[[</code></li>
<li>hashtags: <code>§</code>, <code>#</code> or <code>@</code></li>
<li>words</li>
</ul>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft&rsquo;s <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-get-thing-at-point</span> ()
<span style="color: #83898d;">"Return the thing at point, which can be a link, tag or word."</span>
  (<span style="color: #51afef;">require</span> '<span style="color: #a9a1e1;">thingatpt</span>)
  (<span style="color: #51afef;">let*</span> ((link-re <span style="color: #98be65;">"\\[\\[</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">]]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\\]\\]"</span>)
         (htag-re <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[&#167;#@][[:alnum:]_-]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span>))
   (<span style="color: #51afef;">cond</span>
    ((thing-at-point-looking-at link-re)
      (match-string-no-properties 1))
     ((thing-at-point-looking-at htag-re)
      (match-string-no-properties 1))
     (t (thing-at-point 'word t)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb9f45a6" class="outline-5">
<h5 id="orgb9f45a6"><span class="section-number-5">2.2.1.2</span> <code>zd-search-at-point</code> thing at point</h5>
<div class="outline-text-5" id="text-2-2-1-2">
<p>
Search the thing at point.
Note that calling <code>zd-search-at-point</code> on a <code>§</code> link includes <code>§</code> in the filter string.
</p>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft&rsquo;s <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-search-at-point</span> ()
<span style="color: #83898d;">"Search deft with thing-at-point as filter.</span>
<span style="color: #83898d;">Thing can be a double-bracketed link, a hashtag, or a word."</span>
  (<span style="color: #51afef;">interactive</span>)
  (<span style="color: #51afef;">let</span> ((string (zd-get-thing-at-point)))
   (<span style="color: #51afef;">if</span> string
       (zd-search-global string t)
     (<span style="color: #ECBE7B;">user-error</span> <span style="color: #98be65;">"No search term at point"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5870746" class="outline-5">
<h5 id="org5870746"><span class="section-number-5">2.2.1.3</span> <code>zd-search-global</code> for string</h5>
<div class="outline-text-5" id="text-2-2-1-3">
<p>
Search with deft for given string.
If there is only one result, that file is opened, unless additional argument is true.
</p>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft&rsquo;s <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-search-global</span> (str <span style="color: #ECBE7B;">&amp;optional</span> dntOpn)
<span style="color: #83898d;">"Search deft with STR as filter.</span>
<span style="color: #83898d;">If there is only one result, open that file (unless DNTOPN is true)."</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Sanitize the filter string</span>
  (<span style="color: #51afef;">setq</span> str (replace-regexp-in-string <span style="color: #98be65;">"[[:space:]\n]+"</span> <span style="color: #98be65;">" "</span> str))
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Call deft search on the filter string</span>
  (<span style="color: #51afef;">let</span> ((deft-incremental-search t))
   (deft)
   (deft-filter str t))
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">If there is a single match, open the file</span>
  (<span style="color: #51afef;">unless</span> dntOpn
   (<span style="color: #51afef;">when</span> (eq (length deft-current-files) 1)
     (deft-open-file (car deft-current-files)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga07e4ea" class="outline-5">
<h5 id="orga07e4ea"><span class="section-number-5">2.2.1.4</span> <code>zd-search-filename</code> for string</h5>
<div class="outline-text-5" id="text-2-2-1-4">
<p>
Deft search on filename.
If there is only one result, open that file.
</p>

<p>
Incremental search is turned off, and the filter is set to filenames only.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-search-filename</span> (str)
<span style="color: #83898d;">"Search for deft files with string STR in filename.</span>
<span style="color: #83898d;">Open if there is only one result."</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Sanitize the filter string</span>
  (<span style="color: #51afef;">setq</span> str (replace-regexp-in-string <span style="color: #98be65;">"[[:space:]\n]+"</span> <span style="color: #98be65;">" "</span> str))
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Call deft search on the filter string</span>
  (<span style="color: #51afef;">let</span> ((deft-filter-only-filenames t))
   (deft)
   (deft-filter str t))
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">If there is a single match, open the file</span>
  (<span style="color: #51afef;">when</span> (eq (length deft-current-files) 1)
    (deft-open-file (car deft-current-files))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb904ff5" class="outline-5">
<h5 id="orgb904ff5"><span class="section-number-5">2.2.1.5</span> <code>zd-search-current-id</code> searches current id</h5>
<div class="outline-text-5" id="text-2-2-1-5">
<p>
Deft search on the id of the current file.
</p>

<p>
Result is not opened automaticaly.
</p>

<p>
This function is useful to easily see which notes link to the current file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-search-current-id</span> ()
<span style="color: #83898d;">"Search deft with the id of the current file as filter.</span>
<span style="color: #83898d;">Open if there is only one result."</span>
 (<span style="color: #51afef;">interactive</span>)
 (zd-search-global (zd-id-current-file) t))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org49f2c9f" class="outline-4">
<h4 id="org49f2c9f"><span class="section-number-4">2.2.2</span> IDs</h4>
<div class="outline-text-4" id="text-2-2-2">
</div>
<div id="outline-container-org352b05e" class="outline-5">
<h5 id="org352b05e"><span class="section-number-5">2.2.2.1</span> Basics for IDs</h5>
<div class="outline-text-5" id="text-2-2-2-1">
<p>
String format when generating ids.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">zd-id-format</span> <span style="color: #98be65;">"%Y-%m-%d-%H%M"</span>
  <span style="color: #83898d;">"Format used when generating zetteldeft IDs.</span>
<span style="color: #83898d;">Be warned, changing this won't alter the regexp to filter IDs and find your files. This is WIP."</span>
  <span style="color: #c678dd;">:type</span> 'string
  <span style="color: #c678dd;">:group</span> 'zetteldeft)
</pre>
</div>

<p>
While we&rsquo;re at it, lets tell deft to create new files with this new format.
For good measure: I&rsquo;d advise creating new notes in the <code>zetteldeft</code> system with <code>zd-new-file</code> or <code>zd-new-file-and-link</code>. See below.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">setq</span> deft-new-file-format zd-id-format)
</pre>
</div>

<p>
Here is a function to generate an id string in said format.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-generate-id</span> ()
  <span style="color: #83898d;">"Generates an id in `</span><span style="color: #a9a1e1;">zd-id-format</span><span style="color: #83898d;">'."</span>
  (format-time-string zd-id-format))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ee5476" class="outline-5">
<h5 id="org4ee5476"><span class="section-number-5">2.2.2.2</span> <code>zd-id-insert</code> inserts id</h5>
<div class="outline-text-5" id="text-2-2-2-2">
<p>
A helper function to insert a generated id.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-id-insert</span> ()
 (<span style="color: #51afef;">interactive</span>)
 <span style="color: #98be65;">"Inserts an id in `</span><span style="color: #a9a1e1;">zd-id-format</span><span style="color: #98be65;">'."</span>
 (insert (zd-generate-id) <span style="color: #98be65;">" "</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org08f3f04" class="outline-5">
<h5 id="org08f3f04"><span class="section-number-5">2.2.2.3</span> <code>zd-id-sanitized</code> cleans ids</h5>
<div class="outline-text-5" id="text-2-2-2-3">
<p>
Returns the string stripped from everything that is not a number or a <code>-</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-id-sanitized</span> (str)
<span style="color: #83898d;">"Strip STRING from everything that is not a number or a dash."</span>
 (replace-regexp-in-string <span style="color: #98be65;">"[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">(0-9)-]+"</span> <span style="color: #98be65;">""</span> str))
</pre>
</div>

<p>
Potential shortcomming: any numbers <i>after</i> the id are not stripped.
Problematic when stripping the id from a filename, for example.
</p>

<p>
The following regular expression should work better: <code>[0-9-]\\{2,\\}-[0-9-]+</code> (but cannot be used with <code>replace-regexp-in-string</code> function). Something to fix.
</p>
</div>
</div>

<div id="outline-container-orgc861dec" class="outline-5">
<h5 id="orgc861dec"><span class="section-number-5">2.2.2.4</span> <code>zd-file-id-stripped</code> strips file id from string</h5>
<div class="outline-text-5" id="text-2-2-2-4">
<p>
Attempts to strip the file id from a string.
</p>

<p>
This requires a <b>fix</b>, or better yet, a reimplementation. Too crude at the moment.
</p>

<p>
First, take only 17 first characters from the input string.
Next, omit anything that is not a digit or a dash.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-file-id-stripped</span> (file)
<span style="color: #83898d;">"Returns file id stripped from given filename FILE."</span>
 (<span style="color: #51afef;">let</span> ((file (substring file 0 16)))
   (zd-id-sanitized file)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org21cdf74" class="outline-5">
<h5 id="org21cdf74"><span class="section-number-5">2.2.2.5</span> <code>zd-id-current-file</code> returns id in filename</h5>
<div class="outline-text-5" id="text-2-2-2-5">
<p>
Return the id from the filename the buffer is currently visiting.
</p>

<p>
Requires <b>fix</b>: filenames with numbers in it are not fully stripped.
</p>

<p>
Steps:
</p>
<ol class="org-ol">
<li>Get the filename from the buffer</li>
<li>Strip the ID from it.</li>
<li>Result can be empty string when no id is detected in the filename.</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-id-current-file</span> ()
<span style="color: #83898d;">"Return the id from the filename the buffer is currently visiting."</span>
 (zd-file-id-stripped (file-name-base (buffer-file-name))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9841ee7" class="outline-5">
<h5 id="org9841ee7"><span class="section-number-5">2.2.2.6</span> <code>zd-copy-id-current-file</code> copies id in filename</h5>
<div class="outline-text-5" id="text-2-2-2-6">
<p>
Add the ID from the current file to the kill ring.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-copy-id-current-file</span> ()
<span style="color: #83898d;">"Add the id from the filename the buffer is currently visiting to the kill ring."</span>
(<span style="color: #51afef;">interactive</span>)
 (kill-new (zd-id-current-file)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org742e8f4" class="outline-4">
<h4 id="org742e8f4"><span class="section-number-4">2.2.3</span> Finding &amp; linking files from minibuffer</h4>
<div class="outline-text-4" id="text-2-2-3">
</div>
<div id="outline-container-orga2f4c39" class="outline-5">
<h5 id="orga2f4c39"><span class="section-number-5">2.2.3.1</span> <code>zd-find-file</code> opens file from minibuffer</h5>
<div class="outline-text-5" id="text-2-2-3-1">
<p>
Select file from the deft folder from the minibuffer.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-find-file</span> (file)
<span style="color: #83898d;">"Open deft file FILE."</span>
 (<span style="color: #51afef;">interactive</span>
  (list (completing-read <span style="color: #98be65;">"Deft find file: "</span>
        (deft-find-all-files-no-prefix))))
 (deft-find-file file))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7da855" class="outline-5">
<h5 id="orgd7da855"><span class="section-number-5">2.2.3.2</span> <code>zd-find-file-id-copy</code> copies file id</h5>
<div class="outline-text-5" id="text-2-2-3-2">
<p>
Select file from minibuffer and add its link id to kill ring.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-find-file-id-copy</span> (file)
<span style="color: #83898d;">"Find deft file FILE and add its id to the kill ring."</span>
 (<span style="color: #51afef;">interactive</span> (list
        (completing-read <span style="color: #98be65;">"File to copy id from: "</span>
        (deft-find-all-files-no-prefix))))
  (kill-new (concat <span style="color: #98be65;">"&#167;"</span> (zd-file-id-stripped file))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org919f6c3" class="outline-5">
<h5 id="org919f6c3"><span class="section-number-5">2.2.3.3</span> <code>zd-find-file-id-insert</code> inserts file id</h5>
<div class="outline-text-5" id="text-2-2-3-3">
<p>
Select file from minibuffer and insert its link, prepended by <code>§</code>.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-find-file-id-insert</span> (file)
<span style="color: #83898d;">"Find deft file FILE and insert its link id, prepended by &#167;."</span>
 (<span style="color: #51afef;">interactive</span> (list
        (completing-read <span style="color: #98be65;">"File to insert id from: "</span>
        (deft-find-all-files-no-prefix))))
  (insert (concat <span style="color: #98be65;">"&#167;"</span> (zd-file-id-stripped file))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdcd87ae" class="outline-5">
<h5 id="orgdcd87ae"><span class="section-number-5">2.2.3.4</span> <code>zd-find-file-full-title-insert</code> inserts full file title</h5>
<div class="outline-text-5" id="text-2-2-3-4">
<p>
Select file from minibuffer and insert its link, prepended by <code>§</code>.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-find-file-full-title-insert</span> (file)
<span style="color: #83898d;">"Find deft file FILE and insert its link id with title, prepended by &#167;."</span>
 (<span style="color: #51afef;">interactive</span> (list
        (completing-read <span style="color: #98be65;">"File to insert full title from: "</span>
        (deft-find-all-files-no-prefix))))
  (insert (concat <span style="color: #98be65;">"&#167;"</span> (file-name-base file))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2848717" class="outline-4">
<h4 id="org2848717"><span class="section-number-4">2.2.4</span> New file creation</h4>
<div class="outline-text-4" id="text-2-2-4">
</div>
<div id="outline-container-org238e77c" class="outline-5">
<h5 id="org238e77c"><span class="section-number-5">2.2.4.1</span> <code>zd-new-file</code> creates new file</h5>
<div class="outline-text-5" id="text-2-2-4-1">
<p>
Create new file with filename as <code>zd-id-format</code> and a string.
</p>

<p>
Either provide a name as argument, or enter one in the mini-buffer.
A title is automatically added to the file, unless an additioanl parameter is given.
When <code>evil</code> is used, enter the insert state as well.
The full name is added to the kill ring.
Note that the file is only actually created upon save.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-new-file</span> (str <span style="color: #ECBE7B;">&amp;optional</span> empty)
<span style="color: #83898d;">"Create a new deft file. Filename is `</span><span style="color: #a9a1e1;">zd-id-format</span><span style="color: #83898d;">' appended by STR. No extension needed.</span>

<span style="color: #83898d;">After creating, the title is inserted in org-mode format (unless EMPTY is true) and the full file name is added to the kill ring."</span>
 (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"name: "</span>)))
 (<span style="color: #51afef;">let*</span> ((zdId (zd-generate-id))
        (zdName (concat zdId <span style="color: #98be65;">" "</span> str)))
 (deft-new-file-named zdName)
 (kill-new zdName)
 (<span style="color: #51afef;">unless</span> empty (zd-insert-org-title))
 (<span style="color: #51afef;">when</span> (<span style="color: #51afef;">featurep</span> '<span style="color: #a9a1e1;">evil</span>) (evil-insert-state))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5806faa" class="outline-5">
<h5 id="org5806faa"><span class="section-number-5">2.2.4.2</span> <code>zd-new-file-and-link</code> inserts generated id</h5>
<div class="outline-text-5" id="text-2-2-4-2">
<p>
Generate an id, append a name, and generate a new file based on id and link.
</p>

<p>
Either provide a name as argument, or enter one in the mini-buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-new-file-and-link</span> (str)
<span style="color: #83898d;">"Inserts generated id with `</span><span style="color: #a9a1e1;">zd-id-format</span><span style="color: #83898d;">' appended with STR.</span>
<span style="color: #83898d;">Creates new deft file with id and STR as name."</span>
 (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"name: "</span>)))
 (insert <span style="color: #98be65;">"&#167;"</span> (zd-generate-id) <span style="color: #98be65;">" "</span> str)
 (zd-new-file str))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf9757a4" class="outline-4">
<h4 id="orgf9757a4"><span class="section-number-4">2.2.5</span> Functions with <code>avy</code></h4>
<div class="outline-text-4" id="text-2-2-5">
</div>
<div id="outline-container-org0cae86f" class="outline-5">
<h5 id="org0cae86f"><span class="section-number-5">2.2.5.1</span> <code>zd-avy-tag-search</code></h5>
<div class="outline-text-5" id="text-2-2-5-1">
<p>
Use avy to jump to a tag and search for it.
</p>

<p>
The search term should include the <code>#</code> as tag identifier, so it&rsquo;s as easy as jumping to the <code>#</code> and running <code>zd-search-at-point</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-avy-tag-search</span> ()
<span style="color: #83898d;">"Call on avy to jump and search tags indicated with #."</span>
 (<span style="color: #51afef;">interactive</span>)
 (<span style="color: #51afef;">save-excursion</span>
  (avy-goto-char ?#)
  (zd-search-at-point)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgefd3335" class="outline-5">
<h5 id="orgefd3335"><span class="section-number-5">2.2.5.2</span> <code>zd-avy-link-search</code></h5>
<div class="outline-text-5" id="text-2-2-5-2">
<p>
Use avy to jump to an id and search for it.
</p>

<p>
Jumps to the <code>§</code> identifier and searches for the thing at point &#x2013; excluding the <code>§</code> character.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-avy-link-search</span> ()
<span style="color: #83898d;">"Call on avy to jump and search link ids indicated with &#167;.</span>
<span style="color: #83898d;">Opens immediately if there is only one result."</span>
 (<span style="color: #51afef;">interactive</span>)
 (<span style="color: #51afef;">save-excursion</span>
  (avy-goto-char ?&#167;)
  (zd-search-global (zd-id-sanitized (zd-get-thing-at-point)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d3a335" class="outline-5">
<h5 id="org6d3a335"><span class="section-number-5">2.2.5.3</span> <code>zd-avy-file-search</code></h5>
<div class="outline-text-5" id="text-2-2-5-3">
<p>
Use avy to jump to an id and find the corresponding file.
There should be only one result, as the id should be unique.
</p>

<p>
Jump to a <code>§</code> with <code>avy</code>, get the thing at point.
If it is non-nil, search it after sanitizing.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-avy-file-search</span> ()
<span style="color: #83898d;">"Call on avy to jump to link ids indicated with &#167; and use it to search for filenames."</span>
 (<span style="color: #51afef;">interactive</span>)
 (<span style="color: #51afef;">save-excursion</span>
  (avy-goto-char ?&#167;)
  (zd-search-filename (zd-id-sanitized (zd-get-thing-at-point)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc971ce1" class="outline-4">
<h4 id="orgc971ce1"><span class="section-number-4">2.2.6</span> Utility functions</h4>
<div class="outline-text-4" id="text-2-2-6">
</div>
<div id="outline-container-org2f5d3d9" class="outline-5">
<h5 id="org2f5d3d9"><span class="section-number-5">2.2.6.1</span> Deft new search</h5>
<div class="outline-text-5" id="text-2-2-6-1">
<p>
The following function launches deft, clears the filter and enters <code>evil-insert-state</code> (when evil is used).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-deft-new-search</span> ()
<span style="color: #83898d;">"Launch deft, clear filter and enter insert state."</span>
 (<span style="color: #51afef;">interactive</span>)
 (deft)
 (deft-filter-clear)
 (<span style="color: #51afef;">when</span> (<span style="color: #51afef;">featurep</span> '<span style="color: #a9a1e1;">evil</span>) (evil-insert-state)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7961c2d" class="outline-5">
<h5 id="org7961c2d"><span class="section-number-5">2.2.6.2</span> <code>zd-file-rename</code> renames visited file</h5>
<div class="outline-text-5" id="text-2-2-6-2">
<p>
Rename the current file.
Based on the function <code>deft-rename-file</code> with only minor changes in the way <code>old-filename</code> is set: from current buffer rather than from <code>deft</code> search buffer.
</p>

<p>
Probably requires some more testing.
Anyway, best to use this only when visiting a file in the deft directory.
</p>

<p>
The function also updates the <code>#+title:</code> at the top of the buffer, if any is present.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-file-rename</span> ()
<span style="color: #83898d;">"Rename the current file via the deft function. Use this on files in the deft-directory."</span>
 (<span style="color: #51afef;">interactive</span>)
  (<span style="color: #51afef;">let</span> ((old-filename (buffer-file-name))
        (deft-dir (file-name-as-directory deft-directory))
        new-filename old-name new-name)
    (<span style="color: #51afef;">when</span> old-filename
      (<span style="color: #51afef;">setq</span> old-name (deft-base-filename old-filename))
      (<span style="color: #51afef;">setq</span> new-name (read-string
                      (concat <span style="color: #98be65;">"Rename "</span> old-name <span style="color: #98be65;">" to (without extension): "</span>)
                      old-name))
      (<span style="color: #51afef;">setq</span> new-filename
            (concat deft-dir new-name <span style="color: #98be65;">"."</span> deft-default-extension))
      (rename-file old-filename new-filename)
      (deft-update-visiting-buffers old-filename new-filename)
      (zd-update-title-in-file)
      (deft-refresh))))
</pre>
</div>

<p>
To update the title of the currently visited file, the following function is used.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-update-title-in-file</span> ()
<span style="color: #83898d;">"Update the #+TITLE in the current file, if present."</span>
  (<span style="color: #51afef;">save-excursion</span>
    (<span style="color: #51afef;">let</span> ((zd-string-after-title <span style="color: #98be65;">""</span>))
      (goto-char (point-min))
      (<span style="color: #51afef;">when</span> (search-forward <span style="color: #98be65;">"#+title:"</span> nil t)
        (delete-region (line-beginning-position) (line-end-position))
        (zd-insert-org-title)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0bf785" class="outline-5">
<h5 id="orgc0bf785"><span class="section-number-5">2.2.6.3</span> <code>zd-insert-org-title</code> inserts file title in org-mode</h5>
<div class="outline-text-5" id="text-2-2-6-3">
<p>
Easily insert the title of the current file in <code>org-mode</code> syntax, i.e. as a <code>#+title:</code> line.
</p>

<p>
The code gets the base of the buffer file name, takes from it the file title (i.e. strips the link id at the beginning), and inserts the remaining string.
</p>

<p>
Below the title, an additional template string is inserted automatically.
This string, variable <code>zd-string-after-title</code>, can be customized and is empty by default.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-insert-org-title</span> ()
 <span style="color: #83898d;">"Insert filename of current file as org syntax."</span>
 (<span style="color: #51afef;">interactive</span>)
 (insert
   <span style="color: #98be65;">"#+title: "</span>
   (zd-lift-file-title (file-name-base (buffer-file-name)))
   zd-string-after-title))
</pre>
</div>

<p>
Customize the string to be inserted below the title.
Used when generating a new file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">zd-string-after-title</span> <span style="color: #98be65;">""</span>
  <span style="color: #83898d;">"String inserted below title when `</span><span style="color: #a9a1e1;">zd-insert-org-title</span><span style="color: #83898d;">' is called.</span>
<span style="color: #83898d;">Empty by default.</span>
<span style="color: #83898d;">Don't forget to add `</span><span style="color: #a9a1e1;">\\n</span><span style="color: #83898d;">' at the beginning to start a new line."</span>
  <span style="color: #c678dd;">:type</span> 'string
  <span style="color: #c678dd;">:group</span> 'zetteldeft)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb39f7b6" class="outline-5">
<h5 id="orgb39f7b6"><span class="section-number-5">2.2.6.4</span> <code>zd-count-words</code> counts total number of words</h5>
<div class="outline-text-5" id="text-2-2-6-4">
<p>
To count the total number of words, lets loop over all the files and count words in each.
The total is printed in the minibuffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-count-words</span> ()
  <span style="color: #83898d;">"Prints total number of words in all deft files in the minibuffer."</span>
  (<span style="color: #51afef;">interactive</span>)
  (<span style="color: #51afef;">let</span> ((numWords 0))
    (<span style="color: #51afef;">dolist</span> (deftFile deft-all-files)
      (<span style="color: #51afef;">with-temp-buffer</span>
        (insert-file-contents deftFile)
        (<span style="color: #51afef;">setq</span> numWords (+ numWords (count-words (point-min) (point-max))))))
    (message <span style="color: #98be65;">"Total words accross all notes: %s"</span> numWords)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org8f86fc6" class="outline-3">
<h3 id="org8f86fc6"><span class="section-number-3">2.3</span> Gathering notes</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-orgeb2524a" class="outline-4">
<h4 id="orgeb2524a"><span class="section-number-4">2.3.1</span> On &ldquo;gathering notes&rdquo;</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
Sometimes you want to easily gather all notes with a certain tag or search term.
Say you want to quickly generate a list of links to all files including the tag <code>#zetteldeft</code>.
</p>

<p>
The following functions do that for you.
There are three of them, each either taking a search term as argument or prompting for one:
</p>
<ol class="org-ol">
<li><code>zd-insert-list-links</code> inserts a simple list of notes which contain the search term, spelling out the full filename for each note (including ID).</li>
<li><code>zd-org-search-include</code> generates <code>org-mode</code> syntax to <code>#+INCLUDE</code> the files below a header with their title.</li>
<li><code>zd-org-search-insert</code> inserts the contents of all of these notes below their respective titles.</li>
</ol>

<p>
More documentation can be found below.
</p>
</div>
</div>

<div id="outline-container-org17de997" class="outline-4">
<h4 id="org17de997"><span class="section-number-4">2.3.2</span> List of links</h4>
<div class="outline-text-4" id="text-2-3-2">
</div>
<div id="outline-container-orgc4039ca" class="outline-5">
<h5 id="orgc4039ca"><span class="section-number-5">2.3.2.1</span> <code>zd-insert-list-links</code> generates list with tagged files</h5>
<div class="outline-text-5" id="text-2-3-2-1">
<p>
Creates and inserts a list with links to all files with selected search term.
</p>

<p>
The code gets a list of files that contain the search string, runs through said list and inserts a link for each entry.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-insert-list-links</span> (zdSrch)
<span style="color: #83898d;">"Inserts at point a list of links to all deft files with a search string ZDSRCH.</span>
<span style="color: #83898d;">When searching for a tag, include # manually in the search."</span>
 (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"search string: "</span>)))
 (<span style="color: #51afef;">dolist</span> (zdFile (zd-get-file-list zdSrch))
  (zd-list-entry-file-link zdFile)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a42546" class="outline-5">
<h5 id="org1a42546"><span class="section-number-5">2.3.2.2</span> <code>zd-list-entry-file-link</code> includes a file link as list entry</h5>
<div class="outline-text-5" id="text-2-3-2-2">
<p>
Inserts for given file a link id and title as a list entry.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-list-entry-file-link</span> (zdFile)
<span style="color: #83898d;">"Insert ZDFILE as list entry."</span>
 (insert <span style="color: #98be65;">" - "</span> (concat <span style="color: #98be65;">"&#167;"</span> (file-name-base zdFile)) <span style="color: #98be65;">"\n"</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0dabcbe" class="outline-4">
<h4 id="org0dabcbe"><span class="section-number-4">2.3.3</span> Compiling a single <code>org</code></h4>
<div class="outline-text-4" id="text-2-3-3">
</div>
<div id="outline-container-orgdb92c64" class="outline-5">
<h5 id="orgdb92c64"><span class="section-number-5">2.3.3.1</span> Idea and example</h5>
<div class="outline-text-5" id="text-2-3-3-1">
</div>
<ol class="org-ol">
<li><a id="org66888a4"></a>Including notes with given search term<br>
<div class="outline-text-6" id="text-2-3-3-1-1">
<p>
The following explains what <code>zd-org-search-include</code> does, but the concept is more or less the same for <code>zd-org-search-insert</code>.
</p>

<p>
For each of the notes with the provided search term, it inserts a heading, a line with <code>#+INCLUDE</code> and the full path to the relevant notes.
This results in a single file that can be easily exported.
</p>

<p>
The only function meant for use on the users end, is <code>zd-org-search-include</code>.
</p>

<p>
For example,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(zd-org-search-include <span style="color: #98be65;">"#export"</span>)
</pre>
</div>

<p>
inserts necessary code to include all files containing the tag <code>#export</code>.
The results would look like the following:
</p>

<div class="org-src-container">
<pre class="src src-org">\* First file title
<span style="color: #83898d;">#+INCLUDE: "/path/to/2018-07-13-2210 First file title.org"</span>

\* File two
<span style="color: #83898d;">#+INCLUDE: "/path/to/2018-07-13-2223 File two.org"</span>
</pre>
</div>

<p>
All functions are documented below.
</p>
</div>
</li>

<li><a id="orga24ac63"></a>Semi-automated example<br>
<div class="outline-text-6" id="text-2-3-3-1-2">
<p>
You could, for example, add the following code to a document and execute (or evaluate) it from within <code>org-mode</code>.
Add it under a &ldquo;comment&rdquo; type heading to prevent it from being exported itself, like so: <code>* COMMENT Code</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">let</span> (frst)
  (<span style="color: #51afef;">save-excursion</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Move to next heading</span>
    (outline-next-heading)
    (<span style="color: #51afef;">setq</span> frst (point))
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Delete everything after</span>
    (delete-region frst (point-max))
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Include the files</span>
    (zd-org-search-include <span style="color: #98be65;">"#tag"</span>)
    <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Sort these entries alphabetically (set mark to use a region)</span>
<span style="color: #5B6268;">;   </span><span style="color: #5B6268;">(goto-char frst) (set-mark (point-max))</span>
<span style="color: #5B6268;">;   </span><span style="color: #5B6268;">(org-sort-entries nil ?a)</span>
  ))
</pre>
</div>

<p>
The code deletes everything after the current header and inserts all notes with <code>#tag</code> in them.
</p>

<p>
In order to also sort the entries alphabetically, uncomment the last two lines.
</p>

<p>
A final caveat: don&rsquo;t put the file with the above code in you <code>deft</code> folder, or it will attempt to include itself (since it has <code>#tag</code> in it).
</p>
</div>
</li>

<li><a id="org021c88e"></a>Issues &amp; things to note<br>
<div class="outline-text-6" id="text-2-3-3-1-3">
<p>
Before we look at the functions, a note on limitations of the current implementation.
</p>

<ol class="org-ol">
<li><b>Over-enthousiastic inclusion</b>
Sometimes, a tag appears in a file without the need for it to be included.
For example, a file with a list of all tags will also include the tag one wants.
In the future, this might be resolved by filtering, for example with <a href="http://ergoemacs.org/emacs/elisp_filter_list.html">http://ergoemacs.org/emacs/elisp_filter_list.html</a>.</li>

<li><b>Inclusion from second line onwards</b>
Currently, the <code>#+INCLUDE</code> lines only include from the second line onwards.
This is a work-around to prevent <code>#+TITLE</code> lines from being included (and messing up the title on <code>org-export</code>.
To change this, edit the inserted strings in the <code>zd-org-include-file</code> function.</li>

<li><b>Sorting</b>
The files included are unsorted, or rather: sorted as <code>deft</code> provides the results.
Attempts at sorting by title are included in <code>zd-get-file-list</code>, but not working properly.
As a solution, use <code>org-sort</code> manually after running <code>zd-org-search-include</code>.</li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-org86f1b6a" class="outline-5">
<h5 id="org86f1b6a"><span class="section-number-5">2.3.3.2</span> <code>zd-org-search-include</code> generates <code>#+INCLUDE</code> syntax</h5>
<div class="outline-text-5" id="text-2-3-3-2">
<p>
Asks user for a search string and inserts headers and <code>#+INCLUDE</code> code for all files with said tag.
When used on <code>#tag</code>, make sure to include the <code>#</code> manually.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-org-search-include</span> (zdSrch)
<span style="color: #83898d;">"Inserts at point org-mode code to include all files with the selected tag. Include the # manually in the prompt."</span>
 (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"tag (include the #): "</span>)))
 (<span style="color: #51afef;">dolist</span> (zdFile (zd-get-file-list zdSrch))
  (zd-org-include-file zdFile)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb75ae4" class="outline-5">
<h5 id="orgfb75ae4"><span class="section-number-5">2.3.3.3</span> <code>zd-org-search-insert</code> generates titles &amp; file content</h5>
<div class="outline-text-5" id="text-2-3-3-3">
<p>
Very similar to the previous function, but rather than writing syntax to include files, insert their contents directly.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-org-search-insert</span> (zdSrch)
<span style="color: #83898d;">"Inserts at point all the content of the files with ZDSRCH. When looking for zetteldeft tags, include the # manually in the search."</span>
 (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"Search term: "</span>)))
 (<span style="color: #51afef;">dolist</span> (zdFile (zd-get-file-list zdSrch))
   (zd-org-insert-file zdFile)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga66b068" class="outline-4">
<h4 id="orga66b068"><span class="section-number-4">2.3.4</span> Helper functions</h4>
<div class="outline-text-4" id="text-2-3-4">
</div>
<div id="outline-container-org8a43f46" class="outline-5">
<h5 id="org8a43f46"><span class="section-number-5">2.3.4.1</span> <code>zd-get-file-list</code> returns file list on search</h5>
<div class="outline-text-5" id="text-2-3-4-1">
<p>
Get a list of the files with given search string.
</p>

<p>
To <b>fix</b>: sorting of results.
</p>

<p>
The code searches for the given string and returns <code>deft-current-files</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-get-file-list</span> (srch)
<span style="color: #83898d;">"Returns a list of files with the search item SRCH."</span>
  (<span style="color: #51afef;">let</span> ((deft-current-sort-method 'title))
   (deft-filter srch t)
   deft-current-files))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf041281" class="outline-5">
<h5 id="orgf041281"><span class="section-number-5">2.3.4.2</span> <code>zd-lift-file-title</code> returns file title from path</h5>
<div class="outline-text-5" id="text-2-3-4-2">
<p>
Returns only the file title from a file, removing path, extension, and link ID.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-lift-file-title</span> (zdFile)
  <span style="color: #83898d;">"Returns the title of a zetteldeft note.</span>
<span style="color: #83898d;">ZDFILE should be a full path to a note."</span>
 (<span style="color: #51afef;">let</span> ((baseName (file-name-base zdFile)))
   (replace-regexp-in-string
    <span style="color: #98be65;">"[0-9]\\{2,\\}-[0-9-]+[[:space:]]"</span>
    <span style="color: #98be65;">""</span> baseName)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org94acc93" class="outline-5">
<h5 id="org94acc93"><span class="section-number-5">2.3.4.3</span> <code>zd-insert-file-contents</code> returns the contents of a file</h5>
<div class="outline-text-5" id="text-2-3-4-3">
<p>
Returns the contents of a file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-file-contents</span> (zdFile <span style="color: #ECBE7B;">&amp;optional</span> removeLines)
  <span style="color: #83898d;">"Inserts file contents of a zetteldeft note.</span>
<span style="color: #83898d;">ZDFILE should be a full path to a note.</span>

<span style="color: #83898d;">Optional: leave out first REMOVELINES lines."</span>
  (<span style="color: #51afef;">with-temp-buffer</span>
    (insert-file-contents zdFile)
    (<span style="color: #51afef;">when</span> removeLines
      (kill-whole-line removeLines))
    (buffer-string)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge672519" class="outline-5">
<h5 id="orge672519"><span class="section-number-5">2.3.4.4</span> <code>zd-org-include-file</code> includes a file in <code>org</code> format</h5>
<div class="outline-text-5" id="text-2-3-4-4">
<p>
Inserts the title as a new header, with the <code>#+INCLUDE</code> line below.
Includes only from the second line onward, so that any <code>#+TITLE</code> lines are omitted.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-org-include-file</span> (zdFile)
<span style="color: #83898d;">"Insert code to include org-file zdFile."</span>
 (insert
   <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Insert org-mode title</span>
   <span style="color: #98be65;">"\n* "</span> (zd-lift-file-title zdFile) <span style="color: #98be65;">"\n"</span>
   <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Insert #+INCLUDE: "file.org" :lines 2-</span>
   <span style="color: #98be65;">"#+INCLUDE: \""</span> zdFile <span style="color: #98be65;">"\" :lines \"2-\"\n"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e60f28" class="outline-5">
<h5 id="org2e60f28"><span class="section-number-5">2.3.4.5</span> <code>zd-org-insert-file</code> inserts a files content</h5>
<div class="outline-text-5" id="text-2-3-4-5">
<p>
For a file, insert its title and contents (without first 3 lines).
</p>

<p>
Even better would be: without any of the lines starting with <code>#</code> at the beginning of the file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-org-insert-file</span> (zdFile)
<span style="color: #83898d;">"Insert title and contents of ZDFILE."</span>
  (insert
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Insert org-mode title</span>
    <span style="color: #98be65;">"\n* "</span> (zd-lift-file-title zdFile) <span style="color: #98be65;">"\n\n"</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Insert file contents (without the first 3 lines)</span>
    (zd-file-contents zdFile 3)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org5b1fcdc" class="outline-3">
<h3 id="org5b1fcdc"><span class="section-number-3">2.4</span> Aesthetics</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-org1b33829" class="outline-4">
<h4 id="org1b33829"><span class="section-number-4">2.4.1</span> Highlighting zetteldeft links</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
To highlight zetteldeft links, let&rsquo;s add a <code>font-lock</code> keyword to <code>org-mode</code>.
</p>

<p>
Currently, the regexp to find links is hardcoded.
</p>

<p>
Highlighting not working in comments.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(font-lock-add-keywords 'org-mode '(
  (<span style="color: #98be65;">"&#167;[0-9]\\{2,\\}-[0-9-]+"</span> . font-lock-warning-face)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc27f69e" class="outline-3">
<h3 id="orgc27f69e"><span class="section-number-3">2.5</span> Package provided</h3>
<div class="outline-text-3" id="text-2-5">
<p>
That&rsquo;s all folks!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">provide</span> '<span style="color: #a9a1e1;">zetteldeft</span>)
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">zetteldeft.el ends here</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org00b8b86" class="outline-2">
<h2 id="org00b8b86"><span class="section-number-2">3</span> Suggested setup</h2>
<div class="outline-text-2" id="text-3">
<p>
The following assumes <code>deft</code> is loaded manually in your dotfile, it merely configures the package.
</p>

<p>
None of these code blocks are tangled into the <code>.el</code> file, they are here merely as a guide.
</p>
</div>

<div id="outline-container-org315697e" class="outline-3">
<h3 id="org315697e"><span class="section-number-3">3.1</span> Suggested <code>zeteldeft</code> keybindings</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org997b429" class="outline-4">
<h4 id="org997b429"><span class="section-number-4">3.1.1</span> Keybindings with <code>general</code></h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
To call <code>zetteldeft</code> functions from anywhere behind a leader key such as <code>SPC</code>, I recommend <code>general.el</code> with the following setup.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(general-define-key
  <span style="color: #c678dd;">:prefix</span> <span style="color: #98be65;">"SPC"</span>
  <span style="color: #c678dd;">:non-normal-prefix</span> <span style="color: #98be65;">"C-SPC"</span>
  <span style="color: #c678dd;">:states</span> '(normal visual motion emacs)
  <span style="color: #c678dd;">:keymaps</span> 'override
  <span style="color: #98be65;">"d"</span>  '(nil <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"deft"</span>)
  <span style="color: #98be65;">"dd"</span> '(deft <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"deft"</span>)
  <span style="color: #98be65;">"dD"</span> '(zd-deft-new-search <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"new search"</span>)
  <span style="color: #98be65;">"dR"</span> '(deft-refresh <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"refresh"</span>)
  <span style="color: #98be65;">"ds"</span> '(zd-search-at-point <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"search at point"</span>)
  <span style="color: #98be65;">"dc"</span> '(zd-search-current-id <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"search current id"</span>)
  <span style="color: #98be65;">"df"</span> '(zd-avy-file-search <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"avy file search"</span>)
  <span style="color: #98be65;">"dl"</span> '(zd-avy-link-search <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"avy link search"</span>)
  <span style="color: #98be65;">"dt"</span> '(zd-avy-tag-search <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"avy tag search"</span>)
  <span style="color: #98be65;">"di"</span> '(zd-find-file-id-insert <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"insert id"</span>)
  <span style="color: #98be65;">"dI"</span> '(zd-find-file-full-title-insert <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"insert full title"</span>)
  <span style="color: #98be65;">"do"</span> '(zd-find-file <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"find file"</span>)
  <span style="color: #98be65;">"dn"</span> '(zd-new-file <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"new file"</span>)
  <span style="color: #98be65;">"dN"</span> '(zd-new-file-and-link <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"new file &amp; link"</span>)
  <span style="color: #98be65;">"dr"</span> '(zd-file-rename <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"rename"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd23a269" class="outline-4">
<h4 id="orgd23a269"><span class="section-number-4">3.1.2</span> Spacemacs keybindings</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
Suggested keybindings for <code>spacemacs</code>.
</p>

<p>
These can be called from anywhere behind <code>SPC d</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Prefix</span>
(spacemacs/declare-prefix <span style="color: #98be65;">"d"</span> <span style="color: #98be65;">"deft"</span>)
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Launch deft</span>
(spacemacs/set-leader-keys <span style="color: #98be65;">"dd"</span> 'deft)
(spacemacs/set-leader-keys <span style="color: #98be65;">"dD"</span> 'zd-deft-new-search)
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">SEARCH</span>
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Search thing at point</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"ds"</span> 'zd-search-at-point)
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Search current file id</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"dc"</span> 'zd-search-current-id)
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Jump &amp; search with avy </span>
 <span style="color: #5B6268;">;  </span><span style="color: #5B6268;">search link as filename</span>
    (spacemacs/set-leader-keys <span style="color: #98be65;">"df"</span> 'zd-avy-file-search)
 <span style="color: #5B6268;">;  </span><span style="color: #5B6268;">search link as contents</span>
    (spacemacs/set-leader-keys <span style="color: #98be65;">"dl"</span> 'zd-avy-link-search)
 <span style="color: #5B6268;">;  </span><span style="color: #5B6268;">search tag as contents</span>
    (spacemacs/set-leader-keys <span style="color: #98be65;">"dt"</span> 'zd-avy-tag-search)
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">LINKS</span>
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Insert link from filename</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"di"</span> 'zd-find-file-id-insert)
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Insert link with full filename</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"dI"</span> 'zd-find-file-full-title-insert)
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">FILES</span>
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Open file</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"do"</span> 'zd-find-file)
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Create new file</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"dn"</span> 'zd-new-file)
   (spacemacs/set-leader-keys <span style="color: #98be65;">"dN"</span> 'zd-new-file-and-link)
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Rename file</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"dr"</span> 'zd-file-rename)
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">UTILITIES</span>
(spacemacs/set-leader-keys <span style="color: #98be65;">"dR"</span> 'deft-refresh)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1e38b91" class="outline-3">
<h3 id="org1e38b91"><span class="section-number-3">3.2</span> Suggested <code>deft</code> setup</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org5bada83" class="outline-4">
<h4 id="org5bada83"><span class="section-number-4">3.2.1</span> Notes &amp; extensions</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
Note extensions are <code>md</code>, <code>txt</code> and <code>org</code>.
First of this list is the default for new notes.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">setq</span> deft-extensions '(<span style="color: #98be65;">"org"</span> <span style="color: #98be65;">"md"</span> <span style="color: #98be65;">"txt"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7295e61" class="outline-4">
<h4 id="org7295e61"><span class="section-number-4">3.2.2</span> Set <code>deft-directory</code></h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Search the deft directory recursively, to include subdirectories.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">setq</span> deft-directory (concat org-directory <span style="color: #98be65;">"/notes/zetteldeft"</span>))
(<span style="color: #51afef;">setq</span> deft-recursive t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e95869" class="outline-4">
<h4 id="org2e95869"><span class="section-number-4">3.2.3</span> Additional <code>deft</code> functions</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Some personal additions.
</p>

<p>
A small function to open a file in the other window and shifting focus to it.
That final part is what the <code>t</code> argument does.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">efls/deft-open-other</span> ()
 (<span style="color: #51afef;">interactive</span>)
 (deft-open-file-other-window t))
</pre>
</div>

<p>
Let&rsquo;s add another function, to simply preview in the other window, i.e. not switch focus to it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">efls/deft-open-preview</span> ()
 (<span style="color: #51afef;">interactive</span>)
 (deft-open-file-other-window))
</pre>
</div>


<p>
To select results from the item list without leaving the <code>insert</code> state, I add the following keys.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">with-eval-after-load</span> 'deft
  (define-key deft-mode-map
    (kbd <span style="color: #98be65;">"&lt;tab&gt;"</span>) 'efls/deft-open-preview)
  (define-key deft-mode-map
    (kbd <span style="color: #98be65;">"&lt;s-return&gt;"</span>) 'efls/deft-open-other)
  (define-key deft-mode-map
    (kbd <span style="color: #98be65;">"s-j"</span>) 'evil-next-line)
  (define-key deft-mode-map (kbd <span style="color: #98be65;">"s-k"</span>) 'evil-previous-line))
</pre>
</div>
</div>
</div>

<div id="outline-container-org52b2e51" class="outline-4">
<h4 id="org52b2e51"><span class="section-number-4">3.2.4</span> Ignore more <code>org-mode</code> metadata</h4>
<div class="outline-text-4" id="text-3-2-4">
<p>
I tend to write <code>org-mode</code> titles with <code>#+title:</code> (i.e., uncapitalized). Also other <code>org-mode</code> code at the beginning is written in lower case.
</p>

<p>
In order to filter these from the deft summary, let&rsquo;s alter the regular expression:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">setq</span> deft-strip-summary-regexp
 (concat <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">"</span>
         <span style="color: #98be65;">"[\n\t]"</span> <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">blank</span>
         <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">^#\\+[a-zA-Z_]+:.*$"</span> <span style="color: #5B6268;">;;</span><span style="color: #5B6268;">org-mode metadata</span>
         <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span>))
</pre>
</div>

<p>
Its original value was <code>\\([\n ]\\|^#\\+[[:upper:]_]+:.*$\\)</code>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orga988e9b" class="outline-2">
<h2 id="orga988e9b"><span class="section-number-2">4</span> Brainstorm</h2>
<div class="outline-text-2" id="text-4">
<p>
Some ideas for the future.
</p>
</div>

<div id="outline-container-orgcef8feb" class="outline-3">
<h3 id="orgcef8feb"><span class="section-number-3">4.1</span> Saved searches</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Create a list of saved searches, somewhere easily accessible.
</p>
</div>
</div>

<div id="outline-container-orge2a086a" class="outline-3">
<h3 id="orge2a086a"><span class="section-number-3">4.2</span> Generate list of tags</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Auto-generate a list of tags.
</p>

<p>
Might exceed my elisp-fu.
</p>
</div>
</div>

<div id="outline-container-org88afb4d" class="outline-3">
<h3 id="org88afb4d"><span class="section-number-3">4.3</span> HTML export</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Export HTML pages with clickeable links between notes.
</p>
</div>
</div>

<div id="outline-container-orgd5f98f4" class="outline-3">
<h3 id="orgd5f98f4"><span class="section-number-3">4.4</span> Markdown export</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Export markdown through <code>pandoc</code>.
</p>
</div>
</div>

<div id="outline-container-org30b8452" class="outline-3">
<h3 id="org30b8452"><span class="section-number-3">4.5</span> Templates</h3>
<div class="outline-text-3" id="text-4-5">
<p>
A system for note templates.
</p>
</div>
</div>

<div id="outline-container-org16ffd94" class="outline-3">
<h3 id="org16ffd94"><span class="section-number-3">4.6</span> Minor mode</h3>
<div class="outline-text-3" id="text-4-6">
<p>
Create a minor mode on top of org-mode with some niceties:
</p>
<ul class="org-ul">
<li>higlight links &amp; tags</li>
<li>clickeable links</li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
For those not yet familiar: <b>deft</b> is a note manager within <code>emacs</code>, for easily searching and retrieving plain text notes.
It is inspired by the popular Notational Velocity.
Check out <a href="https://jblevins.org/projects/deft/">jblevins.org/projects/deft/</a> and <a href="http://notational.net">notational.net</a>.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class='author'>Author: EFLS</p>

    <p class='date'>Modified: 2018-10-21 Sun 17:37</p>

    <p class='creator'><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.1 (<a href="https://orgmode.org">Org</a> mode 9.1.13)</p>
</div>
</body>
</html>
