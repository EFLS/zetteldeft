<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2019-02-28 Thu 21:36 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Zetteldeft</title>
<meta name="generator" content="Org mode">
<meta name="author" content="EFLS">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel='stylesheet' href='style.css' type='text/css'/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">Zetteldeft</h1>
</header>
<p>
This document contains all the source code to a set of functions for <code>emacs</code> which aim to extend the <code>deft</code> package and turn it into a (very very) basic Zettelkasten note-taking system.
</p>

<p>
Check out the Github <a href="https://github.com/EFLS/zetteldeft">repository</a> to get the source.
Read on for an introduction and some documentation.
</p>

<p>
Latest additions:
</p>
<ul class="org-ul">
<li><b>28 Feb</b>: Update <code>zd-avy-tag-search</code> to use <code>avy-jump</code> since <code>avy--generic-jump</code> is obsolete.</li>
<li><b>16 Feb</b>: include customizable message <code>zd-list-links-missing</code> for when no missing links are found.</li>
<li><b>14 Feb</b>: fix <code>zd-insert-list-links</code> and its brother <code>zd-insert-list-links-missing</code>.</li>
<li><b>21 Jan</b>: introduction of customizable <code>zd-tag-regex</code>.</li>
<li><b>20 Jan 2019</b>: replaced <code>§</code> with customizable <code>zd-link-indicator</code>.</li>
<li><b>18 Dec</b>: insert not yet included links with <code>zd-insert-list-links-missing</code>.</li>
<li><b>15 Nov</b>: open link in other window with <code>zd-avy-file-search-ace-window</code>.</li>
<li><b>13 Nov</b>: functions to create <code>graphviz</code> added.</li>
<li><b>4 Nov</b>: <code>zd-all-tags</code> and <code>zd-tag-buffer</code> find all tags</li>
<li><b>21 Oct</b>: <code>zetteldeft</code> is now a package.</li>
<li><b>10 Oct</b>: Insert contents of files with given search term with <code>zd-org-search-insert</code>.</li>
<li><b>24 Sep</b>: Count the total number of words in your zetteldeft with <code>zd-count-words</code>.</li>
<li><b>18 July</b>: Include a list of links with <code>zd-insert-list-links</code>, or a list of files with <code>zd-org-search-include</code>.</li>
</ul>

<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc7acdee">1. What?</a>
<ul>
<li><a href="#org9abb93a">1.1. A Zettelkasten system for <code>emacs</code> based on <code>deft</code></a></li>
<li><a href="#org09b4925">1.2. How to use this source</a></li>
<li><a href="#org48cf7e0">1.3. Basic concepts</a></li>
<li><a href="#orgb7f76d4">1.4. Basic actions</a></li>
<li><a href="#orgd716b6d">1.5. An overview</a></li>
</ul>
</li>
<li><a href="#orgfa70c7f">2. The <code>zetteldeft</code> package</a>
<ul>
<li><a href="#org9c825fe">2.1. Package preparation</a></li>
<li><a href="#org6d7c2b7">2.2. Basic <code>zetteldeft</code> functions</a></li>
<li><a href="#org0feb1d9">2.3. Listing all tags</a></li>
<li><a href="#org20a534a">2.4. Gathering notes</a></li>
<li><a href="#org1c73f6a">2.5. Creating visuals</a></li>
<li><a href="#org2c61072">2.6. Aesthetics</a></li>
<li><a href="#org494fe17">2.7. End of package</a></li>
</ul>
</li>
<li><a href="#orge32b46c">3. Suggested setup</a>
<ul>
<li><a href="#orgb52f86a">3.1. Suggested <code>zeteldeft</code> keybindings</a></li>
<li><a href="#org5f8dcfa">3.2. Suggested <code>deft</code> setup</a></li>
</ul>
</li>
<li><a href="#orgf491785">4. Brainstorm</a></li>
</ul>
</div>
</nav>

<div id="outline-container-orgc7acdee" class="outline-2">
<h2 id="orgc7acdee"><span class="section-number-2">1</span> What?</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org9abb93a" class="outline-3">
<h3 id="org9abb93a"><span class="section-number-3">1.1</span> A Zettelkasten system for <code>emacs</code> based on <code>deft</code></h3>
<div class="outline-text-3" id="text-1-1">
<p>
This is my feeble attempt at recreating a Zettelkasten environment by extending the excellent <code>deft</code> package in <code>emacs</code>.<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>
I call it <b>zetteldeft</b>.
</p>

<p>
It is inspired by the <i>The Archive</i> app. For this and more on the Zettelkasten way of taking notes, see <a href="https://zettelkasten.de">zettelkasten.de</a>. They have a forum for discussion on both software and the specifics of the Zettelkasten philosophy.
</p>

<p>
The code that follows is created and maintained for my personal use, shared here in hope that it can benefit others as well.
I&rsquo;d be happy to learn how you use it and expand upon it.
</p>

<p>
It is very much WIP and I&rsquo;m fairly new to <code>elisp</code>, so it might contain some stupid code.
</p>

<p>
Anyway, here we go.
</p>
</div>
</div>

<div id="outline-container-org09b4925" class="outline-3">
<h3 id="org09b4925"><span class="section-number-3">1.2</span> How to use this source</h3>
<div class="outline-text-3" id="text-1-2">
<p>
This package requires:
</p>
<ul class="org-ul">
<li><code>deft</code>, obviously</li>
<li><code>avy</code> to jump &amp; search</li>
</ul>

<p>
From the <a href="https://github.com/EFLS/zetteldeft">Github repository</a>, either
</p>
<ul class="org-ul">
<li>download the <code>zetteldeft.el</code> file,</li>
<li>download the <code>org-file</code> and <code>org-tangle</code> it yourself. It should contain everything.</li>
</ul>

<p>
Whichever way you go, load up the package by adding the package to your load path and requiring:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'load-path <span style="color: #A2BF8A;">"~/path/to/folder/"</span>))
(<span style="color: #80A0C2;">require</span> '<span style="color: #B58DAE;">zetteldeft</span>)
</pre>
</div>

<p>
Or, if you use <code>use-package</code>, do something like:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">use-package</span> <span style="color: #B58DAE;">zetteldeft</span>
  <span style="color: #8EBCBB;">:load-path</span> <span style="color: #A2BF8A;">"~/git/zetteldeft/"</span>
  <span style="color: #8EBCBB;">:after</span> deft)
</pre>
</div>

<p>
and you&rsquo;re good to go!
Well, not quite.
First you must read on about the basics of <code>zetteldeft</code>.
You&rsquo;ll also want some keybindings. Check out the <a href="#orge32b46c">suggested setup</a> below.
</p>
</div>
</div>

<div id="outline-container-org48cf7e0" class="outline-3">
<h3 id="org48cf7e0"><span class="section-number-3">1.3</span> Basic concepts</h3>
<div class="outline-text-3" id="text-1-3">
<p>
<b>Notes</b> reside in the <code>deft-directory</code>.
Notes are written in <code>org-mode</code> syntax (although most functions should work in <code>markdown</code> as well).
</p>

<p>
The filename of a note starts with a unique <b>id</b> based on the time and the date, for example: <code>2018-07-09-2115 This is a note.org</code>.
</p>

<p>
This unique id can be used to <b>link</b> notes together.
A link consists of the <code>§</code> character followed by the id.
For example: <code>§2018-07-09-2115</code> should link to the file above.
A link can appear anywhere in the text.
See <a href="#orgaa4eb3b">below</a> for advanced information about IDs and links.
</p>

<p>
When searching <code>deft</code> with the <b>id</b> as a filter, you&rsquo;ll find both the original note (with the id in its name) and all the notes that link to this note (with the id in its body). Do so with <code>zd-search-current-id</code> and <code>zd-avy-link-search</code> respectively
</p>

<p>
Notes can contain <b>tags</b> in plain text: words prepended with a <code>#</code>.
This is a tag: <code>#tag</code>.
Tags make it easy to retrieve notes. They can appear anywhere in the note, but I&rsquo;d suggest putting them somewhere at the top.
</p>
</div>
</div>

<div id="outline-container-orgb7f76d4" class="outline-3">
<h3 id="orgb7f76d4"><span class="section-number-3">1.4</span> Basic actions</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Create a note with <code>zd-new-file</code> and provide a name.
</p>

<p>
To insert links to other notes, either
</p>
<ul class="org-ul">
<li>enter their links manually,</li>
<li>use <code>zd-find-file-id-insert</code> and select a file from the list,</li>
</ul>

<p>
With <code>zd-find-file-full-title-insert</code>, you guessed it, the note&rsquo;s title is included as well.
</p>

<p>
To easily branch out from the current note (i.e. create a new one and link to it in one go), use <code>zd-new-file-and-link</code>.
</p>

<p>
To search for a tag or anything else under cursor, use <code>zd-search-at-point</code>.
Combined with the power of <code>avy</code> to jump to any character on screen, use these to jump and search in one go: <code>zd-avy-link-search</code> and <code>zd-avy-tag-search</code>.
</p>

<p>
To open the note behind a link, use <code>zd-avy-file-search</code>.
</p>

<p>
Want more functionality?
How about showing a <a href="#org0feb1d9">list of tags</a> or <a href="#org20a534a">gathering notes</a> with a certain search string?
Or maybe a <a href="#org1c73f6a">graph</a> visualizing how notes are linked?
</p>

<p>
Still hungry?
I&rsquo;m welcoming both contributions and suggestions.
Feel free to submit comments or pull requests on Github.
</p>
</div>
</div>

<div id="outline-container-orgd716b6d" class="outline-3">
<h3 id="orgd716b6d"><span class="section-number-3">1.5</span> An overview</h3>
<div class="outline-text-3" id="text-1-5">
<p>
While there are many, these should be enough to get you started.
Default keybindings are suggested at <a href="#orgb52f86a">the end of this document</a>.
Here is an overview.
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">Use</th>
<th scope="col" class="org-left">Keybinding</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>zd-new-file</code></td>
<td class="org-left">Create new note and open</td>
<td class="org-left"><code>SPC d n</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-new-file-and-link</code></td>
<td class="org-left">Create new note and insert link</td>
<td class="org-left"><code>SPC d N</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-find-file-id-insert</code></td>
<td class="org-left">Pick a note and insert a link</td>
<td class="org-left"><code>SPC d i</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-file-search</code></td>
<td class="org-left">Select and follow a link</td>
<td class="org-left"><code>SPC d f</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-link-search</code></td>
<td class="org-left">Select and seearch a link&rsquo;s ID</td>
<td class="org-left"><code>SPC d l</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-tag-search</code></td>
<td class="org-left">Select a tag and search for it</td>
<td class="org-left"><code>SPC d t</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-search-at-point</code></td>
<td class="org-left">Search for thing at point</td>
<td class="org-left"><code>SPC d s</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-search-current-id</code></td>
<td class="org-left">Search for id of current file</td>
<td class="org-left"><code>SPC d c</code></td>
</tr>
</tbody>
</table>

<p>
Read on, dear reader, for all of this and much more.
</p>
</div>
</div>
</div>

<div id="outline-container-orgfa70c7f" class="outline-2">
<h2 id="orgfa70c7f"><span class="section-number-2">2</span> The <code>zetteldeft</code> package</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org9c825fe" class="outline-3">
<h3 id="org9c825fe"><span class="section-number-3">2.1</span> Package preparation</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The required preamble and some other initial settings.
To know how this package works, please skip right past this to the next section.
</p>
</div>

<div id="outline-container-orgcc7f954" class="outline-4">
<h4 id="orgcc7f954"><span class="section-number-4">2.1.1</span> Preamble</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
Some declaration.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #6f7787;">;;; </span><span style="color: #6f7787;">zetteldeft.el --- a simple package                     -*- lexical-binding: t; -*-</span>

<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Copyright (C) 2018-2019  EFLS</span>

<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Author: EFLS &lt;Elias Storms&gt;</span>
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Website: https://efls.github.io/zetteldeft/</span>
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Keywords: deft zettelkasten zetteldeft</span>
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Version: 0.0.1</span>

<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">the Free Software Foundation, either version 3 of the License, or</span>
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">(at your option) any later version.</span>

<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">GNU General Public License for more details.</span>

<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">You should have received a copy of the GNU General Public License</span>
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">along with this program.  If not, see <a href="http://www.gnu.org/licenses/">&lt;http://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #6f7787;">;;; </span><span style="color: #6f7787;">Commentary:</span>

<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Zetteldeft: turn deft into a zettelkasten writing system to create linked notes.</span>

<span style="color: #6f7787;">;;; </span><span style="color: #6f7787;">Code:</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org088fb41" class="outline-4">
<h4 id="org088fb41"><span class="section-number-4">2.1.2</span> Requirements</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
<code>deft</code> is required, obviously, and <code>avy</code> is needed for some utility functions.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">require</span> '<span style="color: #B58DAE;">deft</span>)

(<span style="color: #80A0C2;">unless</span> (<span style="color: #80A0C2;">require</span> '<span style="color: #B58DAE;">avy</span> nil 'no-error)
  (<span style="color: #ECCC87;">user-error</span> <span style="color: #A2BF8A;">"Avy not installed, required for zd-avy-* functions"</span>))
</pre>
</div>

<p>
Since february 2019, the <code>avy</code> API changed and <code>avy--generic-jump</code> is replaced by <code>avy-jump</code>.
Unfortunately, this change doesn&rsquo;t seem to be indicated with a specific version number.
So let&rsquo;s check whether that function is available, and show a message when it&rsquo;s not.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">unless</span> (fboundp 'avy-jump)
  (display-warning 'zetteldeft
    <span style="color: #A2BF8A;">"Function `</span><span style="color: #B58DAE;">avy-jump</span><span style="color: #A2BF8A;">' not available. Please update `</span><span style="color: #B58DAE;">avy</span><span style="color: #A2BF8A;">'"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org83f8924" class="outline-4">
<h4 id="org83f8924"><span class="section-number-4">2.1.3</span> Customization</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
For easy but minor customization options.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defgroup</span> <span style="color: #ECCC87;">zetteldeft</span> nil
  <span style="color: #78808f;">"A zettelkasten on top of deft."</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6d7c2b7" class="outline-3">
<h3 id="org6d7c2b7"><span class="section-number-3">2.2</span> Basic <code>zetteldeft</code> functions</h3>
<div class="outline-text-3" id="text-2-2">
<p>

</p>

<p>
In this section:
</p>
<div id="text-table-of-contents">
<ul>
<li><a href="#org349a8e5">2.2.1. Search functions</a>
<ul>
<li><a href="#org4331a3e">2.2.1.1. <code>zd-get-thing-at-point</code> returns string</a></li>
<li><a href="#org9ebe4ad">2.2.1.2. <code>zd-search-at-point</code> thing at point</a></li>
<li><a href="#org7a4b5f0">2.2.1.3. <code>zd-search-global</code> for string</a></li>
<li><a href="#orgbe31e8c">2.2.1.4. <code>zd-search-filename</code> for string</a></li>
<li><a href="#orgc018b1b">2.2.1.5. <code>zd-search-current-id</code> searches current id</a></li>
<li><a href="#org9626ddb">2.2.1.6. <code>zd-get-file-list</code> returns file list with search term</a></li>
</ul>
</li>
<li><a href="#org6b3ef80">2.2.2. IDs, links and tags</a>
<ul>
<li><a href="#orgaa4eb3b">2.2.2.1. A note on nomenclature, IDs and links</a></li>
<li><a href="#orga8118fc">2.2.2.2. <code>zd-id-format</code> for generating ID strings</a></li>
<li><a href="#org3d857d3">2.2.2.3. <code>zd-id-regex</code> for finding IDs</a></li>
<li><a href="#org5220adb">2.2.2.4. <code>zd-link-indicator</code> prepends ID links</a></li>
<li><a href="#org6b94c60">2.2.2.5. <code>zd-lift-id</code> filters the ID from a string</a></li>
<li><a href="#org47f8bfd">2.2.2.6. <code>zd-tag-regex</code> for finding tags</a></li>
</ul>
</li>
<li><a href="#org744a030">2.2.3. Finding &amp; linking files from minibuffer</a>
<ul>
<li><a href="#org06aa848">2.2.3.1. <code>zd-find-file</code> opens file from minibuffer</a></li>
<li><a href="#org2e515f4">2.2.3.2. <code>zd-find-file-id-insert</code> inserts file id</a></li>
<li><a href="#org38d21e8">2.2.3.3. <code>zd-find-file-full-title-insert</code> inserts id and title</a></li>
</ul>
</li>
<li><a href="#org8ca0ddd">2.2.4. New file creation</a>
<ul>
<li><a href="#org52c30de">2.2.4.1. <code>zd-new-file</code> creates new file</a></li>
<li><a href="#orge0e8447">2.2.4.2. <code>zd-new-file-and-link</code> inserts generated id</a></li>
</ul>
</li>
<li><a href="#org8cad1db">2.2.5. Moving around with <code>avy</code></a>
<ul>
<li><a href="#org46d21be">2.2.5.1. <code>zd-avy-tag-search</code></a></li>
<li><a href="#org6a4fcc4">2.2.5.2. <code>zd-avy-link-search</code></a></li>
<li><a href="#org3763e5e">2.2.5.3. <code>zd-avy-file-search</code></a></li>
</ul>
</li>
<li><a href="#orgfe5106f">2.2.6. Utility functions</a>
<ul>
<li><a href="#orge2e0740">2.2.6.1. Deft new search</a></li>
<li><a href="#org86ad499">2.2.6.2. <code>zd--check</code> checks if file is part of zetteldeft</a></li>
<li><a href="#org2d8d12e">2.2.6.3. <code>zd-file-rename</code> renames visited file</a></li>
<li><a href="#orgee321c0">2.2.6.4. <code>zd-lift-file-title</code> returns file title from path</a></li>
<li><a href="#org6383c8c">2.2.6.5. <code>zd-insert-org-title</code> inserts file title in org-mode</a></li>
<li><a href="#orgc6f9ba9">2.2.6.6. <code>zd-count-words</code> counts total number of words</a></li>
<li><a href="#orgf59cbb7">2.2.6.7. <code>zd-copy-id-current-file</code> copies id in filename</a></li>
<li><a href="#orgb7d47be">2.2.6.8. <code>zd-id-to-full-title</code> returns title from ID</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org349a8e5" class="outline-4">
<h4 id="org349a8e5"><span class="section-number-4">2.2.1</span> Search functions</h4>
<div class="outline-text-4" id="text-2-2-1">
</div>
<div id="outline-container-org4331a3e" class="outline-5">
<h5 id="org4331a3e"><span class="section-number-5">2.2.1.1</span> <code>zd-get-thing-at-point</code> returns string</h5>
<div class="outline-text-5" id="text-2-2-1-1">
<p>
Returns the thing at point as string.
</p>

<p>
Tries to get, in the following order:
</p>
<ul class="org-ul">
<li>links between <code>[[</code></li>
<li>hashtags: <code>§</code>, <code>#</code> or <code>@</code></li>
<li>words</li>
</ul>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft&rsquo;s <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-get-thing-at-point</span> ()
  <span style="color: #78808f;">"Return the thing at point, which can be a link, tag or word."</span>
  (<span style="color: #80A0C2;">require</span> '<span style="color: #B58DAE;">thingatpt</span>)
  (<span style="color: #80A0C2;">let*</span> ((link-re <span style="color: #A2BF8A;">"\\[\\[</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">(</span><span style="color: #A2BF8A;">[</span><span style="color: #80A0C2; font-weight: bold;">^</span><span style="color: #A2BF8A;">]]+</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">)</span><span style="color: #A2BF8A;">\\]\\]"</span>)
         (htag-re <span style="color: #A2BF8A;">"</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">(</span><span style="color: #A2BF8A;">[&#167;#@][[:alnum:]_-]+</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">)</span><span style="color: #A2BF8A;">"</span>))
   (<span style="color: #80A0C2;">cond</span>
    ((thing-at-point-looking-at link-re)
      (match-string-no-properties 1))
     ((thing-at-point-looking-at htag-re)
      (match-string-no-properties 1))
     (t (thing-at-point 'word t)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ebe4ad" class="outline-5">
<h5 id="org9ebe4ad"><span class="section-number-5">2.2.1.2</span> <code>zd-search-at-point</code> thing at point</h5>
<div class="outline-text-5" id="text-2-2-1-2">
<p>
Search the thing at point.
</p>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft&rsquo;s <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-search-at-point</span> ()
  <span style="color: #78808f;">"Search deft with `</span><span style="color: #B58DAE;">thing-at-point</span><span style="color: #78808f;">' as filter.</span>
<span style="color: #78808f;">Thing can be a double-bracketed link, a hashtag, or a word."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (<span style="color: #80A0C2;">let</span> ((string (zd-get-thing-at-point)))
   (<span style="color: #80A0C2;">if</span> string
       (zd-search-global string t)
     (<span style="color: #ECCC87;">user-error</span> <span style="color: #A2BF8A;">"No search term at point"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a4b5f0" class="outline-5">
<h5 id="org7a4b5f0"><span class="section-number-5">2.2.1.3</span> <code>zd-search-global</code> for string</h5>
<div class="outline-text-5" id="text-2-2-1-3">
<p>
Search with deft for given string.
If there is only one result, that file is opened, unless additional argument is true.
</p>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft&rsquo;s <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-search-global</span> (str <span style="color: #ECCC87;">&amp;optional</span> dntOpn)
  <span style="color: #78808f;">"Search deft with STR as filter.</span>
<span style="color: #78808f;">If there is only one result, open that file (unless DNTOPN is true)."</span>
  <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Sanitize the filter string</span>
  (<span style="color: #80A0C2;">setq</span> str (replace-regexp-in-string <span style="color: #A2BF8A;">"[[:space:]\n]+"</span> <span style="color: #A2BF8A;">" "</span> str))
  <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Call deft search on the filter string</span>
  (<span style="color: #80A0C2;">let</span> ((deft-incremental-search t))
   (deft)
   (deft-filter str t))
  <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">If there is a single match, open the file</span>
  (<span style="color: #80A0C2;">unless</span> dntOpn
   (<span style="color: #80A0C2;">when</span> (eq (length deft-current-files) 1)
     (deft-open-file (car deft-current-files)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe31e8c" class="outline-5">
<h5 id="orgbe31e8c"><span class="section-number-5">2.2.1.4</span> <code>zd-search-filename</code> for string</h5>
<div class="outline-text-5" id="text-2-2-1-4">
<p>
Deft search on filename.
If there is only one result, open that file.
</p>

<p>
Incremental search is turned off, and the filter is set to filenames only.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-search-filename</span> (thisStr <span style="color: #ECCC87;">&amp;optional</span> otherWindow)
  <span style="color: #78808f;">"Search for deft files with string THISSTR in filename.</span>
<span style="color: #78808f;">Open if there is only one result (in another window if OTHERWINDOW is non-nill)."</span>
  <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Sanitize the filter string</span>
  (<span style="color: #80A0C2;">setq</span> thisStr (replace-regexp-in-string <span style="color: #A2BF8A;">"[[:space:]\n]+"</span> <span style="color: #A2BF8A;">" "</span> thisStr))
  <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Call deft search on the filter string</span>
  (<span style="color: #80A0C2;">let</span> ((deft-filter-only-filenames t))
   (deft-filter thisStr t))
  <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">If there is a single match, open the file</span>
  (<span style="color: #80A0C2;">when</span> (eq (length deft-current-files) 1)
    (deft-open-file (car deft-current-files) otherWindow)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc018b1b" class="outline-5">
<h5 id="orgc018b1b"><span class="section-number-5">2.2.1.5</span> <code>zd-search-current-id</code> searches current id</h5>
<div class="outline-text-5" id="text-2-2-1-5">
<p>
Deft search on the id of the current file.
</p>

<p>
This function is useful to easily see which notes link to the current file.
</p>

<p>
Result is not opened automaticaly.
</p>

<p>
Steps:
</p>
<ol class="org-ol">
<li>Get the filename from the current buffer.</li>
<li>Lift the ID from it.</li>
<li>Search with resulting string.</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-search-current-id</span> ()
  <span style="color: #78808f;">"Search deft with the id of the current file as filter.</span>
<span style="color: #78808f;">Open if there is only one result."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (zd--check)
  (zd-search-global (zd-lift-id (file-name-base (buffer-file-name))) t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9626ddb" class="outline-5">
<h5 id="org9626ddb"><span class="section-number-5">2.2.1.6</span> <code>zd-get-file-list</code> returns file list with search term</h5>
<div class="outline-text-5" id="text-2-2-1-6">
<p>
Get a list of the files with given search string.
</p>

<p>
To <b>fix</b>: sorting of results.
</p>

<p>
The code searches for the given string and returns <code>deft-current-files</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-get-file-list</span> (srch)
  <span style="color: #78808f;">"Return a list of files with the search item SRCH."</span>
  (<span style="color: #80A0C2;">let</span> ((deft-current-sort-method 'title))
    (deft-filter srch t)
    deft-current-files))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6b3ef80" class="outline-4">
<h4 id="org6b3ef80"><span class="section-number-4">2.2.2</span> IDs, links and tags</h4>
<div class="outline-text-4" id="text-2-2-2">
</div>
<div id="outline-container-orgaa4eb3b" class="outline-5">
<h5 id="orgaa4eb3b"><span class="section-number-5">2.2.2.1</span> A note on nomenclature, IDs and links</h5>
<div class="outline-text-5" id="text-2-2-2-1">
<p>
In zetteldeft, the concepts of &ldquo;links&rdquo; and &ldquo;IDs&rdquo; have related meanings, but in the documentation they are not synonyms.
</p>

<p>
An ID refers to the unique numeric string identifying each note.
For example: <code>2019-01-20-1433</code>.
These are generated by <code>zd-generate-id</code>.
</p>

<p>
A link is an ID prepended by a character to easily identify it as a link.
For example: <code>§2019-01-20-1433</code>.
</p>

<p>
This identifying character can be changed by setting the <code>zd-link-indicator</code> variable and is <code>§</code> by default.
Note that if this variable is set to nil, the <code>zd-avy-link-search</code> and <code>zd-avy-file-search</code> functions will not work.
</p>
</div>
</div>

<div id="outline-container-orga8118fc" class="outline-5">
<h5 id="orga8118fc"><span class="section-number-5">2.2.2.2</span> <code>zd-id-format</code> for generating ID strings</h5>
<div class="outline-text-5" id="text-2-2-2-2">
<p>
Format used to generate ids.
</p>

<p>
See documentation of <code>format-time-string</code> for more info on possible placeholders.
</p>

<p>
If you customize this value, make sure to edit the <code>zd-id-regex</code> as well, so that the IDs can be found by other functions.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defcustom</span> <span style="color: #dac6d6;">zd-id-format</span> <span style="color: #A2BF8A;">"%Y-%m-%d-%H%M"</span>
  <span style="color: #78808f;">"Format used when generating zetteldeft IDs.</span>

<span style="color: #78808f;">Be warned: the regexp to find IDs is set separately.</span>
<span style="color: #78808f;">If you change this value, set `</span><span style="color: #B58DAE;">zd-id-regex</span><span style="color: #78808f;">' so that</span>
<span style="color: #78808f;">the IDs can be found.</span>

<span style="color: #78808f;">Check the documentation of the `</span><span style="color: #B58DAE;">format-time-string</span><span style="color: #78808f;">'</span>
<span style="color: #78808f;">function to see which placeholders can be used."</span>
  <span style="color: #8EBCBB;">:type</span> 'string
  <span style="color: #8EBCBB;">:group</span> 'zetteldeft)
</pre>
</div>

<p>
Another popular option would be to set this value to <code>"%Y%m%d%H%M"</code>, so that a similar ID is generated without any dashes.
See below for a corresponding regular expression.
</p>

<p>
While we&rsquo;re at it, lets tell <code>deft</code> to use this format when creating new files.
For good measure: I advise creating new notes in the <code>zetteldeft</code> system with <code>zd-new-file</code> or <code>zd-new-file-and-link</code> as defined below, rather than through <code>deft</code> itself.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">setq</span> deft-new-file-format zd-id-format)
</pre>
</div>

<p>
Next up, a function to generate an ID string in the above format.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-generate-id</span> ()
  <span style="color: #78808f;">"Generate an ID in the format of `</span><span style="color: #B58DAE;">zd-id-format</span><span style="color: #78808f;">'."</span>
  (format-time-string zd-id-format))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d857d3" class="outline-5">
<h5 id="org3d857d3"><span class="section-number-5">2.2.2.3</span> <code>zd-id-regex</code> for finding IDs</h5>
<div class="outline-text-5" id="text-2-2-2-3">
<p>
The regular expression used to search for zetteldeft IDs as set in <code>zd-id-format</code>.
</p>

<p>
The default regex dictates that a zetteldeft ID should consist of:
</p>
<ol class="org-ol">
<li>a series of exactly 4 numbers</li>
<li>followed by exactly 3 sets of a dash and two or more numbers</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defcustom</span> <span style="color: #dac6d6;">zd-id-regex</span> <span style="color: #A2BF8A;">"[0-9]\\{4\\}</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">(</span><span style="color: #A2BF8A;">-[0-9]\\{2,\\}</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">)</span><span style="color: #A2BF8A;">\\{3\\}"</span>
  <span style="color: #78808f;">"The regular expression used to search for zetteldeft IDs.</span>
<span style="color: #78808f;">Set it so that it matches strings generated with</span>
<span style="color: #78808f;">`</span><span style="color: #B58DAE;">zd-id-format</span><span style="color: #78808f;">'."</span>
  <span style="color: #8EBCBB;">:type</span> 'string
  <span style="color: #8EBCBB;">:group</span> 'zetteldeft)
</pre>
</div>

<p>
If you use a <code>"%Y%m%d%H%M"</code> format for note naming, you might want to set the regular expression to <code>"20[0-9]\\{10\\}"</code> so that it matches any string starting with <code>20</code> followed by 10 other digits.
</p>
</div>
</div>

<div id="outline-container-org5220adb" class="outline-5">
<h5 id="org5220adb"><span class="section-number-5">2.2.2.4</span> <code>zd-link-indicator</code> prepends ID links</h5>
<div class="outline-text-5" id="text-2-2-2-4">
<p>
To make it easier to distinguish links to zetteldeft notes, the ID can be prepended with a symbol.
By default, this is set to <code>§</code>, but it can be changed (or nil).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defcustom</span> <span style="color: #dac6d6;">zd-link-indicator</span> <span style="color: #A2BF8A;">"&#167;"</span>
  <span style="color: #78808f;">"String to indicate zetteldeft links.</span>
<span style="color: #78808f;">String prepended to IDs to easily identify them as links to zetteldeft notes.</span>
<span style="color: #78808f;">This variable should be a string containing only one character."</span>
  <span style="color: #8EBCBB;">:type</span> 'string
  <span style="color: #8EBCBB;">:group</span> 'zetteldeft)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b94c60" class="outline-5">
<h5 id="org6b94c60"><span class="section-number-5">2.2.2.5</span> <code>zd-lift-id</code> filters the ID from a string</h5>
<div class="outline-text-5" id="text-2-2-2-5">
<p>
Return the zetteldeft ID from any string.
</p>

<p>
Searches with a temporary buffer, from the end of the string backwards (hence the <code>-1</code> argument), which implies that the last zetteldeft string is returned.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-lift-id</span> (str)
  <span style="color: #78808f;">"Extract the zetteldeft ID from STR with the regular expression stored in `</span><span style="color: #B58DAE;">zd-id-regex</span><span style="color: #78808f;">'."</span>
  (<span style="color: #80A0C2;">with-temp-buffer</span>
    (insert str)
    (<span style="color: #80A0C2;">when</span> (re-search-forward zd-id-regex nil t -1)
      (match-string 0))))
</pre>
</div>

<p>
Or are there better ways than working <code>with-temp-buffer</code>?
</p>

<p>
Here is a little test.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(zd-lift-id <span style="color: #A2BF8A;">"2018-11-09-1934-12 Some text (1989) - testing (2000 p. 12-25)"</span>)
</pre>
</div>

<pre class="example">
2018-11-09-1934
</pre>
</div>
</div>

<div id="outline-container-org47f8bfd" class="outline-5">
<h5 id="org47f8bfd"><span class="section-number-5">2.2.2.6</span> <code>zd-tag-regex</code> for finding tags</h5>
<div class="outline-text-5" id="text-2-2-2-6">
<p>
This regular expression indicates what tags can look like.
</p>

<p>
By default, tags start with a <code>#</code> or <code>@</code> and contain least one or more lower case letters.
Dashes are allowed.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defcustom</span> <span style="color: #dac6d6;">zd-tag-regex</span> <span style="color: #A2BF8A;">"[#@][a-z-]+"</span>
  <span style="color: #78808f;">"Regular expression for zetteldeft tags."</span>
  <span style="color: #8EBCBB;">:type</span> 'string
  <span style="color: #8EBCBB;">:group</span> 'zetteldeft)
</pre>
</div>

<p>
Note that this regular expression does not handle hashtags used in, for example, urls.
</p>
</div>
</div>
</div>

<div id="outline-container-org744a030" class="outline-4">
<h4 id="org744a030"><span class="section-number-4">2.2.3</span> Finding &amp; linking files from minibuffer</h4>
<div class="outline-text-4" id="text-2-2-3">
</div>
<div id="outline-container-org06aa848" class="outline-5">
<h5 id="org06aa848"><span class="section-number-5">2.2.3.1</span> <code>zd-find-file</code> opens file from minibuffer</h5>
<div class="outline-text-5" id="text-2-2-3-1">
<p>
Select file from the deft folder from the minibuffer.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-find-file</span> (file)
  <span style="color: #78808f;">"Open deft file FILE."</span>
  (<span style="color: #80A0C2;">interactive</span>
    (list (completing-read <span style="color: #A2BF8A;">"Deft find file: "</span>
           (deft-find-all-files-no-prefix))))
  (deft-find-file file))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e515f4" class="outline-5">
<h5 id="org2e515f4"><span class="section-number-5">2.2.3.2</span> <code>zd-find-file-id-insert</code> inserts file id</h5>
<div class="outline-text-5" id="text-2-2-3-2">
<p>
Select file from minibuffer and insert its link, prepended by <code>§</code> (or <code>zd-link-indicator</code> to be precise).
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-find-file-id-insert</span> (file)
  <span style="color: #78808f;">"Find deft file FILE and insert a link."</span>
  (<span style="color: #80A0C2;">interactive</span> (list
    (completing-read <span style="color: #A2BF8A;">"File to insert id from: "</span>
      (deft-find-all-files-no-prefix))))
  (insert (concat zd-link-indicator (zd-lift-id file))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org38d21e8" class="outline-5">
<h5 id="org38d21e8"><span class="section-number-5">2.2.3.3</span> <code>zd-find-file-full-title-insert</code> inserts id and title</h5>
<div class="outline-text-5" id="text-2-2-3-3">
<p>
Select file from minibuffer and insert its link, prepended by <code>§</code> (or <code>zd-link-indicator</code>).
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-find-file-full-title-insert</span> (file)
  <span style="color: #78808f;">"Find deft file FILE and insert a link with title."</span>
  (<span style="color: #80A0C2;">interactive</span> (list
    (completing-read <span style="color: #A2BF8A;">"File to insert full title from: "</span>
      (deft-find-all-files-no-prefix))))
  (insert (concat zd-link-indicator (file-name-base file))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8ca0ddd" class="outline-4">
<h4 id="org8ca0ddd"><span class="section-number-4">2.2.4</span> New file creation</h4>
<div class="outline-text-4" id="text-2-2-4">
</div>
<div id="outline-container-org52c30de" class="outline-5">
<h5 id="org52c30de"><span class="section-number-5">2.2.4.1</span> <code>zd-new-file</code> creates new file</h5>
<div class="outline-text-5" id="text-2-2-4-1">
<p>
Create new file with filename as <code>zd-id-format</code> and a string.
</p>

<p>
Either provide a name as argument, or enter one in the mini-buffer.
A title is automatically added to the file, unless an additioanl parameter is given.
When <code>evil</code> is used, enter the insert state as well.
The full name is added to the kill ring.
Note that the file is only actually created upon save.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-new-file</span> (str <span style="color: #ECCC87;">&amp;optional</span> empty)
  <span style="color: #78808f;">"Create a new deft file.</span>
<span style="color: #78808f;">Filename is `</span><span style="color: #B58DAE;">zd-id-format</span><span style="color: #78808f;">' appended by STR.</span>
<span style="color: #78808f;">No file extension needed.</span>

<span style="color: #78808f;">The title is inserted in `</span><span style="color: #B58DAE;">org-mode</span><span style="color: #78808f;">' format (unless EMPTY is true)</span>
<span style="color: #78808f;">and the file name (without extension) is added to the kill ring.</span>
<span style="color: #78808f;">When `</span><span style="color: #B58DAE;">evil</span><span style="color: #78808f;">' is loaded, enter instert state."</span>
  (<span style="color: #80A0C2;">interactive</span> (list (read-string <span style="color: #A2BF8A;">"name: "</span>)))
  (<span style="color: #80A0C2;">let*</span> ((zdId (zd-generate-id))
         (zdName (concat zdId <span style="color: #A2BF8A;">" "</span> str)))
  (deft-new-file-named zdName)
  (kill-new zdName)
  (<span style="color: #80A0C2;">unless</span> empty (zd-insert-org-title))
  (save-buffer)
  (<span style="color: #80A0C2;">when</span> (<span style="color: #80A0C2;">featurep</span> '<span style="color: #B58DAE;">evil</span>) (evil-insert-state))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge0e8447" class="outline-5">
<h5 id="orge0e8447"><span class="section-number-5">2.2.4.2</span> <code>zd-new-file-and-link</code> inserts generated id</h5>
<div class="outline-text-5" id="text-2-2-4-2">
<p>
Generate an id, append a name, and generate a new file based on id and link.
</p>

<p>
Either provide a name as argument, or enter one in the mini-buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-new-file-and-link</span> (str)
  <span style="color: #78808f;">"Insert generated id with `</span><span style="color: #B58DAE;">zd-id-format</span><span style="color: #78808f;">' appended with STR.</span>
<span style="color: #78808f;">Creates new deft file with id and STR as name."</span>
  (<span style="color: #80A0C2;">interactive</span> (list (read-string <span style="color: #A2BF8A;">"name: "</span>)))
  (insert zd-link-indicator (zd-generate-id) <span style="color: #A2BF8A;">" "</span> str)
  (zd-new-file str))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8cad1db" class="outline-4">
<h4 id="org8cad1db"><span class="section-number-4">2.2.5</span> Moving around with <code>avy</code></h4>
<div class="outline-text-4" id="text-2-2-5">
</div>
<div id="outline-container-org46d21be" class="outline-5">
<h5 id="org46d21be"><span class="section-number-5">2.2.5.1</span> <code>zd-avy-tag-search</code></h5>
<div class="outline-text-5" id="text-2-2-5-1">
<p>
Use avy to jump to a tag and search for it.
</p>

<p>
The search term should include the <code>#</code> as tag identifier, so it&rsquo;s as easy as jumping to the <code>#</code> and running <code>zd-search-at-point</code>.
</p>

<p>
Avy uses <code>zd-tag-regex</code> as a regular expression.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-avy-tag-search</span> ()
  <span style="color: #78808f;">"Call on avy to jump to a tag.</span>
<span style="color: #78808f;">Tags are filtered with `</span><span style="color: #B58DAE;">zd-tag-regex</span><span style="color: #78808f;">'."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (<span style="color: #80A0C2;">save-excursion</span>
    (avy-jump zd-tag-regex)
    (zd-search-at-point)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a4fcc4" class="outline-5">
<h5 id="org6a4fcc4"><span class="section-number-5">2.2.5.2</span> <code>zd-avy-link-search</code></h5>
<div class="outline-text-5" id="text-2-2-5-2">
<p>
Use avy to jump to a link search for its ID in deft.
</p>

<p>
Jumps to a link identifier (i.e. <code>zd-link-indicator</code>, <code>§</code> by default) and searches for the ID found.
Note that this will not work when <code>zd-link-indicator</code> is set to nil.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-avy-link-search</span> ()
  <span style="color: #78808f;">"Use `</span><span style="color: #B58DAE;">avy</span><span style="color: #78808f;">' to perform a deft search on a zetteldeft link.</span>
<span style="color: #78808f;">Links are found via `</span><span style="color: #B58DAE;">zd-link-indicator</span><span style="color: #78808f;">'.</span>
<span style="color: #78808f;">Opens immediately if there is only one result."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (<span style="color: #80A0C2;">unless</span> zd-link-indicator
    (<span style="color: #ECCC87;">user-error</span> <span style="color: #A2BF8A;">"Zetteldeft avy functions won't work when `</span><span style="color: #B58DAE;">zd-link-indicator</span><span style="color: #A2BF8A;">' is nil"</span>))
  (<span style="color: #80A0C2;">save-excursion</span>
    (avy-goto-char (string-to-char zd-link-indicator))
    (zd-search-global (zd-lift-id (zd-get-thing-at-point)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3763e5e" class="outline-5">
<h5 id="org3763e5e"><span class="section-number-5">2.2.5.3</span> <code>zd-avy-file-search</code></h5>
<div class="outline-text-5" id="text-2-2-5-3">
<p>
Use avy to jump to a link and find the corresponding file.
Since the ID should be unique, there should be only one result.
That file is then opend (in another window if requested).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-avy-file-search</span> (<span style="color: #ECCC87;">&amp;optional</span> otherWindow)
 <span style="color: #78808f;">"Use `</span><span style="color: #B58DAE;">avy</span><span style="color: #78808f;">' to follow a zetteldeft link.</span>
<span style="color: #78808f;">Links are found via `</span><span style="color: #B58DAE;">zd-link-indicator</span><span style="color: #78808f;">'</span>
<span style="color: #78808f;">Open that file (in another window if OTHERWINDOW)."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (<span style="color: #80A0C2;">unless</span> zd-link-indicator
    (<span style="color: #ECCC87;">user-error</span> <span style="color: #A2BF8A;">"Zetteldeft avy functions won't work when `</span><span style="color: #B58DAE;">zd-link-indicator</span><span style="color: #A2BF8A;">' is nil"</span>))
  (<span style="color: #80A0C2;">save-excursion</span>
    (avy-goto-char (string-to-char zd-link-indicator))
    (zd-search-filename (zd-lift-id (zd-get-thing-at-point)) otherWindow)))
</pre>
</div>

<p>
Let&rsquo;s also define a function to open a file in another window.
Selection of the window occurs via <code>ace-window</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-avy-file-search-ace-window</span> ()
  <span style="color: #78808f;">"Use `</span><span style="color: #B58DAE;">avy</span><span style="color: #78808f;">' to follow a zetteldeft link in another window.</span>
<span style="color: #78808f;">When there is only one search result, as there should be,</span>
<span style="color: #78808f;">open that file in a window selected through `</span><span style="color: #B58DAE;">ace-window</span><span style="color: #78808f;">'."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (<span style="color: #80A0C2;">unless</span> zd-link-indicator
    (<span style="color: #ECCC87;">user-error</span> <span style="color: #A2BF8A;">"Zetteldeft avy functions won't work when `</span><span style="color: #B58DAE;">zd-link-indicator</span><span style="color: #A2BF8A;">' is nil"</span>))
  (<span style="color: #80A0C2;">require</span> '<span style="color: #B58DAE;">ace-window</span>)
  (<span style="color: #80A0C2;">save-excursion</span>
    (avy-goto-char (string-to-char zd-link-indicator))
    (<span style="color: #80A0C2;">let</span> ((ID (zd-lift-id (zd-get-thing-at-point))))
      (select-window (aw-select <span style="color: #A2BF8A;">"Select window..."</span>))
      (zd-search-filename ID))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfe5106f" class="outline-4">
<h4 id="orgfe5106f"><span class="section-number-4">2.2.6</span> Utility functions</h4>
<div class="outline-text-4" id="text-2-2-6">
</div>
<div id="outline-container-orge2e0740" class="outline-5">
<h5 id="orge2e0740"><span class="section-number-5">2.2.6.1</span> Deft new search</h5>
<div class="outline-text-5" id="text-2-2-6-1">
<p>
The following function launches deft, clears the filter and enters <code>evil-insert-state</code> (when evil is used).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-deft-new-search</span> ()
  <span style="color: #78808f;">"Launch deft, clear filter and enter insert state."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (deft)
  (deft-filter-clear)
  (<span style="color: #80A0C2;">when</span> (<span style="color: #80A0C2;">featurep</span> '<span style="color: #B58DAE;">evil</span>) (evil-insert-state)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org86ad499" class="outline-5">
<h5 id="org86ad499"><span class="section-number-5">2.2.6.2</span> <code>zd--check</code> checks if file is part of zetteldeft</h5>
<div class="outline-text-5" id="text-2-2-6-2">
<p>
A quick but necessary check to see whether the provided file is part of the deft directory.
</p>

<p>
To achieve this, first check whether the buffer is visiting a file.
When that is the case, take the path of the file the buffer is currently visiting, and check whether the <code>deft-directory</code> is part of that.
Signal a user error if it is not.
</p>

<p>
The <code>file-truename</code> is there to make sure that <code>deft-directory</code> is first expanded to an absolute path before comparing it to the file name of the current buffer (which is already an absolute path).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd--check</span> ()
  <span style="color: #78808f;">"Check if the currently visited file is in `</span><span style="color: #B58DAE;">zetteldeft</span><span style="color: #78808f;">' territory:</span>
<span style="color: #78808f;">whether it has `</span><span style="color: #B58DAE;">deft-directory</span><span style="color: #78808f;">' somewhere in its path."</span>
  (<span style="color: #80A0C2;">unless</span> (buffer-file-name)
    (<span style="color: #ECCC87;">user-error</span> <span style="color: #A2BF8A;">"Buffer not visiting a file"</span>))
  (<span style="color: #80A0C2;">unless</span> (string-match-p
            (regexp-quote (file-truename deft-directory))
            (buffer-file-name))
    (<span style="color: #ECCC87;">user-error</span> <span style="color: #A2BF8A;">"Not in zetteldeft territory"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d8d12e" class="outline-5">
<h5 id="org2d8d12e"><span class="section-number-5">2.2.6.3</span> <code>zd-file-rename</code> renames visited file</h5>
<div class="outline-text-5" id="text-2-2-6-3">
<p>
Rename the current file.
Based on the function <code>deft-rename-file</code> with only minor changes in the way <code>old-filename</code> is set: from current buffer rather than from <code>deft</code> search buffer.
</p>

<p>
Probably requires some more testing.
Anyway, best to use this only when visiting a file in the deft directory.
</p>

<p>
The function also updates the <code>#+title:</code> at the top of the buffer, if any is present.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-file-rename</span> ()
  <span style="color: #78808f;">"Rename the current file via the deft function. Use this on files in the deft-directory."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (zd--check)
    (<span style="color: #80A0C2;">let</span> ((old-filename (buffer-file-name))
          (deft-dir (file-name-as-directory deft-directory))
          new-filename old-name new-name)
      (<span style="color: #80A0C2;">when</span> old-filename
        (<span style="color: #80A0C2;">setq</span> old-name (deft-base-filename old-filename))
        (<span style="color: #80A0C2;">setq</span> new-name (read-string
                        (concat <span style="color: #A2BF8A;">"Rename "</span> old-name <span style="color: #A2BF8A;">" to (without extension): "</span>)
                        old-name))
        (<span style="color: #80A0C2;">setq</span> new-filename
              (concat deft-dir new-name <span style="color: #A2BF8A;">"."</span> deft-default-extension))
        (rename-file old-filename new-filename)
        (deft-update-visiting-buffers old-filename new-filename)
        (zd-update-title-in-file)
        (deft-refresh))))
</pre>
</div>

<p>
To update the title of the currently visited file, the following function is used.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-update-title-in-file</span> ()
  <span style="color: #78808f;">"Update the #+TITLE in the current file, if present."</span>
  (<span style="color: #80A0C2;">save-excursion</span>
    (<span style="color: #80A0C2;">let</span> ((zd-string-after-title <span style="color: #A2BF8A;">""</span>))
      (goto-char (point-min))
      (<span style="color: #80A0C2;">when</span> (search-forward <span style="color: #A2BF8A;">"#+title:"</span> nil t)
        (delete-region (line-beginning-position) (line-end-position))
        (zd-insert-org-title)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee321c0" class="outline-5">
<h5 id="orgee321c0"><span class="section-number-5">2.2.6.4</span> <code>zd-lift-file-title</code> returns file title from path</h5>
<div class="outline-text-5" id="text-2-2-6-4">
<p>
Returns only the file title from a file, removing path, extension, and link ID.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-lift-file-title</span> (zdFile)
  <span style="color: #78808f;">"Return the title of a zetteldeft note.</span>
<span style="color: #78808f;">ZDFILE should be a full path to a note."</span>
  (<span style="color: #80A0C2;">let</span> ((baseName (file-name-base zdFile)))
    (replace-regexp-in-string
     <span style="color: #A2BF8A;">"[0-9]\\{2,\\}-[0-9-]+[[:space:]]"</span>
     <span style="color: #A2BF8A;">""</span> baseName)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6383c8c" class="outline-5">
<h5 id="org6383c8c"><span class="section-number-5">2.2.6.5</span> <code>zd-insert-org-title</code> inserts file title in org-mode</h5>
<div class="outline-text-5" id="text-2-2-6-5">
<p>
Easily insert the title of the current file in <code>org-mode</code> syntax, i.e. as a <code>#+title:</code> line.
</p>

<p>
The code gets the base of the buffer file name, takes from it the file title (i.e. strips the link id at the beginning), and inserts the remaining string.
</p>

<p>
Below the title, an additional template string is inserted automatically.
This string, variable <code>zd-string-after-title</code>, can be customized and is empty by default.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-insert-org-title</span> ()
  <span style="color: #78808f;">"Insert filename of current file as org syntax."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (zd--check)
  (insert
    <span style="color: #A2BF8A;">"#+title: "</span>
    (zd-lift-file-title (file-name-base (buffer-file-name)))
    zd-string-after-title))
</pre>
</div>

<p>
Customize the string to be inserted below the title.
Used when generating a new file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defcustom</span> <span style="color: #dac6d6;">zd-string-after-title</span> <span style="color: #A2BF8A;">""</span>
  <span style="color: #78808f;">"String inserted below title when `</span><span style="color: #B58DAE;">zd-insert-org-title</span><span style="color: #78808f;">' is called.</span>
<span style="color: #78808f;">Empty by default.</span>
<span style="color: #78808f;">Don't forget to add `</span><span style="color: #B58DAE;">\\n</span><span style="color: #78808f;">' at the beginning to start a new line."</span>
  <span style="color: #8EBCBB;">:type</span> 'string
  <span style="color: #8EBCBB;">:group</span> 'zetteldeft)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6f9ba9" class="outline-5">
<h5 id="orgc6f9ba9"><span class="section-number-5">2.2.6.6</span> <code>zd-count-words</code> counts total number of words</h5>
<div class="outline-text-5" id="text-2-2-6-6">
<p>
To count the total number of words, lets loop over all the files and count words in each.
The total is printed in the minibuffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-count-words</span> ()
  <span style="color: #78808f;">"Prints total number of words and notes in the minibuffer."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (<span style="color: #80A0C2;">let</span> ((numWords 0))
    (<span style="color: #80A0C2;">dolist</span> (deftFile deft-all-files)
      (<span style="color: #80A0C2;">with-temp-buffer</span>
        (insert-file-contents deftFile)
        (<span style="color: #80A0C2;">setq</span> numWords (+ numWords (count-words (point-min) (point-max))))))
    (message <span style="color: #A2BF8A;">"Your zettelkasten contains %s notes with %s words in total."</span> (length deft-all-files) numWords)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf59cbb7" class="outline-5">
<h5 id="orgf59cbb7"><span class="section-number-5">2.2.6.7</span> <code>zd-copy-id-current-file</code> copies id in filename</h5>
<div class="outline-text-5" id="text-2-2-6-7">
<p>
Add the ID from the current file to the kill ring.
</p>

<p>
Steps:
</p>
<ol class="org-ol">
<li>Get the filename from the buffer</li>
<li>Strip the ID from it.</li>
<li>Prepend the ID with <code>zd-link-indicator</code> to create a full link.</li>
<li>Result can be empty string when no id is detected in the filename.</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-copy-id-current-file</span> ()
  <span style="color: #78808f;">"Add the id from the filename the buffer is currently visiting to the kill ring."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (zd--check)
  (<span style="color: #80A0C2;">let</span> ((ID (concat zd-link-indicator
                    (zd-lift-id (file-name-base (buffer-file-name))))))
    (kill-new ID)
    (message <span style="color: #A2BF8A;">"%s"</span> ID)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb7d47be" class="outline-5">
<h5 id="orgb7d47be"><span class="section-number-5">2.2.6.8</span> <code>zd-id-to-full-title</code> returns title from ID</h5>
<div class="outline-text-5" id="text-2-2-6-8">
<p>
Convert a zetteldeft ID into its full title.
</p>

<p>
The ID should lead to only one title, obviously, so an error is thrown when this is not the case.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-id-to-full-title</span> (zdID)
  <span style="color: #78808f;">"Return full title from given zetteldeft ID ZDID.</span>
<span style="color: #78808f;">Throws an error when either none or multiple files are found."</span>
  (<span style="color: #80A0C2;">let</span> ((deft-filter-only-filenames t))
    (deft-filter zdID t))
  (<span style="color: #80A0C2;">unless</span> (eq (length deft-current-files) 1)
    (<span style="color: #ECCC87;">user-error</span> <span style="color: #A2BF8A;">"ID Error. Either no or multiple zetteldeft files found with ID %s"</span> zdID))
  (file-name-base (car deft-current-files)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org0feb1d9" class="outline-3">
<h3 id="org0feb1d9"><span class="section-number-3">2.3</span> Listing all tags</h3>
<div class="outline-text-3" id="text-2-3">
<p>
<code>zd-all-tags</code> puts all tags in <code>zd-tag-list</code> and returns them.
</p>

<p>
Use <code>zd-tag-buffer</code> to create a buffer with all tags.
</p>
</div>

<div id="outline-container-orgcf040fd" class="outline-4">
<h4 id="orgcf040fd"><span class="section-number-4">2.3.1</span> <code>zd-all-tags</code> returns them all</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
Extracting tags with <code>zd-extract-tags</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-all-tags</span> ()
  <span style="color: #78808f;">"Return a list of all the tags found in zetteldeft files."</span>
  (<span style="color: #80A0C2;">setq</span> zd-tag-list (list))
  (<span style="color: #80A0C2;">dolist</span> (deftFile deft-all-files)
    (zd-extract-tags deftFile))
  zd-tag-list)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2bd7d47" class="outline-4">
<h4 id="org2bd7d47"><span class="section-number-4">2.3.2</span> <code>zd-tag-buffer</code> puts all tags in a buffer</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
The name of the buffer we&rsquo;ll be using:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">setq</span> zd-tag-buffer-name <span style="color: #A2BF8A;">"*zd-tag-buffer*"</span>)
</pre>
</div>

<p>
And some code to create that buffer.
</p>

<p>
Move to the <code>zd-tag-buffer-name</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-tag-buffer</span> ()
  <span style="color: #78808f;">"Switch to the *zd-tag-buffer* and list tags."</span>
  (<span style="color: #80A0C2;">interactive</span>)
  (switch-to-buffer zd-tag-buffer-name)
  (erase-buffer)
  (<span style="color: #80A0C2;">dolist</span> (zdTag (zd-all-tags))
    (insert (format <span style="color: #A2BF8A;">"%s \n"</span> zdTag)))
  (<span style="color: #80A0C2;">unless</span> (eq major-mode 'org-mode) (org-mode))
  (sort-lines nil (point-min) (point-max)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org50bfad7" class="outline-4">
<h4 id="org50bfad7"><span class="section-number-4">2.3.3</span> Tag extracting functions</h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
Some utility functions to achieve all of this.
</p>
</div>

<div id="outline-container-org565457e" class="outline-5">
<h5 id="org565457e"><span class="section-number-5">2.3.3.1</span> <code>zd-tag-format</code> adjusts the tag finding regex</h5>
<div class="outline-text-5" id="text-2-3-3-1">
<p>
The regular expression used to filter out tags, <code>zd-tag-regex</code> works, but doesn&rsquo;t filter strictly enough.
Hashtags used in URLs are also found, for example.
</p>

<p>
That&rsquo;s why we can make the existing regex more precise by stating that tags should be positioned either be at the beginning of a new line, or preceded by a space.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">setq</span> zd-tag-format (concat <span style="color: #A2BF8A;">"</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">(</span><span style="color: #A2BF8A;">^</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">|</span><span style="color: #A2BF8A;">\s</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">)</span><span style="color: #A2BF8A;">"</span> zd-tag-regex))
</pre>
</div>
</div>
</div>

<div id="outline-container-org51ce174" class="outline-5">
<h5 id="org51ce174"><span class="section-number-5">2.3.3.2</span> <code>zd-extract-tags</code> from a file</h5>
<div class="outline-text-5" id="text-2-3-3-2">
<p>
Open a given file in a temporary buffer.
Loop a search for the tag regexp.
When a tag is found, remove any whitespace from it and add it to the <code>zd-tag-list</code> if it isn&rsquo;t there already.
Delete the found tag and search again.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-extract-tags</span> (deftFile)
  <span style="color: #78808f;">"Find all tags in DEFTFILE and add them to `</span><span style="color: #B58DAE;">zd-tag-list</span><span style="color: #78808f;">'."</span>
  (<span style="color: #80A0C2;">with-temp-buffer</span>
    (insert-file-contents deftFile)
    (<span style="color: #80A0C2;">while</span> (re-search-forward zd-tag-format nil t)
      (<span style="color: #80A0C2;">let</span> ((foundTag (replace-regexp-in-string <span style="color: #A2BF8A;">" "</span> <span style="color: #A2BF8A;">""</span> (match-string 0))))
        <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Add found tag to zd-tag-list if it isn't there already</span>
        (<span style="color: #80A0C2;">unless</span> (member foundTag zd-tag-list)
          (<span style="color: #80A0C2;">push</span> foundTag zd-tag-list)))
      <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Remove found tag from buffer</span>
      (delete-region (point) (re-search-backward zd-tag-format)))))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org20a534a" class="outline-3">
<h3 id="org20a534a"><span class="section-number-3">2.4</span> Gathering notes</h3>
<div class="outline-text-3" id="text-2-4">
<p>

</p>

<p>
In this section:
</p>
<div id="text-table-of-contents">
<ul>
<li><a href="#org527b8f2">2.4.1. On &ldquo;gathering notes&rdquo;</a></li>
<li><a href="#org158956a">2.4.2. List of links</a>
<ul>
<li><a href="#org258c5ec">2.4.2.1. <code>zd-insert-list-links</code> generates list with tagged files</a></li>
<li><a href="#org98b1464">2.4.2.2. <code>zd-insert-list-links-missing</code> generates list with new links</a></li>
<li><a href="#org8d63bbb">2.4.2.3. <code>zd-list-entry-file-link</code> includes a file link as list entry</a></li>
</ul>
</li>
<li><a href="#org945c99a">2.4.3. Compiling a single <code>org</code></a>
<ul>
<li><a href="#org6095a4c">2.4.3.1. Idea and example</a></li>
<li><a href="#org92a0372">2.4.3.2. <code>zd-org-search-include</code> generates <code>#+INCLUDE</code> syntax</a></li>
<li><a href="#orgc34f3ba">2.4.3.3. <code>zd-org-search-insert</code> generates titles &amp; file content</a></li>
</ul>
</li>
<li><a href="#orgeefa6c7">2.4.4. Helper functions</a>
<ul>
<li><a href="#orgb5ec77d">2.4.4.1. <code>zd-insert-file-contents</code> returns the contents of a file</a></li>
<li><a href="#org3602024">2.4.4.2. <code>zd-org-include-file</code> includes a file in <code>org</code> format</a></li>
<li><a href="#org14844d5">2.4.4.3. <code>zd-org-insert-file</code> inserts a files content</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org527b8f2" class="outline-4">
<h4 id="org527b8f2"><span class="section-number-4">2.4.1</span> On &ldquo;gathering notes&rdquo;</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
Sometimes you want to easily gather all notes with a certain tag or search term.
Say you want to quickly generate a list of links to all files including the tag <code>#zetteldeft</code>.
</p>

<p>
The following functions do that for you.
There are three of them, each either taking a search term as argument or prompting for one:
</p>
<ol class="org-ol">
<li><code>zd-insert-list-links</code> inserts a simple list of notes which contain the search term, spelling out the full filename for each note (including ID).</li>
<li><code>zd-org-search-include</code> generates <code>org-mode</code> syntax to <code>#+INCLUDE</code> the files below a header with their title.</li>
<li><code>zd-org-search-insert</code> inserts the contents of all of these notes below their respective titles.</li>
</ol>

<p>
More documentation can be found below.
</p>
</div>
</div>

<div id="outline-container-org158956a" class="outline-4">
<h4 id="org158956a"><span class="section-number-4">2.4.2</span> List of links</h4>
<div class="outline-text-4" id="text-2-4-2">
</div>
<div id="outline-container-org258c5ec" class="outline-5">
<h5 id="org258c5ec"><span class="section-number-5">2.4.2.1</span> <code>zd-insert-list-links</code> generates list with tagged files</h5>
<div class="outline-text-5" id="text-2-4-2-1">
<p>
Creates and inserts a list with links to all files with selected search term.
</p>

<p>
The code gets a list of files that contain the search string, runs through said list and inserts a link for each entry.
</p>

<p>
When called from a note within zetteldeft, exclude the note itself from the generated list.
This is necessary so that when called from an <code>org</code> code block within a note, the note itself is not included (since it will be found by <code>deft</code>, as the search string will be part of that note).
To achieve this, get the full file name of the current buffer, and remove it from the search results if its found there.
The <code>when</code> part is there so that this deletion is not attempted if the current buffer is not visiting a file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-insert-list-links</span> (zdSrch)
  <span style="color: #78808f;">"Search for ZDSRCH and insert a list of zetteldeft links to all results."</span>
  (<span style="color: #80A0C2;">interactive</span> (list (read-string <span style="color: #A2BF8A;">"search string: "</span>)))
  (<span style="color: #80A0C2;">let</span> ((zdResults (zd-get-file-list zdSrch))
        (zdThisNote (buffer-file-name)))
    (<span style="color: #80A0C2;">when</span> zdThisNote (<span style="color: #80A0C2;">setq</span> zdResults (delete zdThisNote zdResults)))
    (<span style="color: #80A0C2;">dolist</span> (zdFile zdResults)
      (zd-list-entry-file-link zdFile))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org98b1464" class="outline-5">
<h5 id="org98b1464"><span class="section-number-5">2.4.2.2</span> <code>zd-insert-list-links-missing</code> generates list with new links</h5>
<div class="outline-text-5" id="text-2-4-2-2">
<p>
Does the same as the above function, but only inserts IDs that aren&rsquo;t already present in the current file.
In contrast with <code>zd-insert-list-links</code>, this function can only be used from within a zetteldeft note.
</p>

<p>
This is especially handy when you want to check wheter all notes with a certain tag are linked to, or simply to list notes with a specific tag that are not linked to yet.
Similar to the function above, filter out ID of the current note.
In contrast to the function above, this one works with IDs rather than full paths.
</p>

<p>
Another fundamental <b>shortcoming</b> of this piece of code, is that after it is executed, the note now includes the previously missing ID links, which in turn means that on the next run <i>no</i> links will be included&#x2026;
The most immediate solution is for the user to be wary of this, remove any previously inserted links, save the buffer and refresh the deft cache with <code>deft-refresh</code> before calling this function.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-insert-list-links-missing</span> (zdSrch)
  <span style="color: #78808f;">"Insert a list of links to all deft files with a search string ZDSRCH.</span>
<span style="color: #78808f;">In contrast to `</span><span style="color: #B58DAE;">zd-insert-list-links</span><span style="color: #78808f;">' only include links not yet present</span>
<span style="color: #78808f;">in the current file.</span>
<span style="color: #78808f;">Can only be called from a file in the zetteldeft directory."</span>
  (<span style="color: #80A0C2;">interactive</span> (list (read-string <span style="color: #A2BF8A;">"search string: "</span>)))
  (zd--check)
  (<span style="color: #80A0C2;">let</span> (zdThisID zdCurrentIDs zdFoundIDs zdFinalIDs)
    (<span style="color: #80A0C2;">setq</span> zdCurrentIDs (zd-extract-links (buffer-file-name)))
    <span style="color: #6f7787;">; </span><span style="color: #6f7787;">filter IDs from search results</span>
    (<span style="color: #80A0C2;">dolist</span> (zdFile (zd-get-file-list zdSrch))
      (<span style="color: #80A0C2;">push</span> (zd-lift-id zdFile) zdFoundIDs))
    <span style="color: #6f7787;">; </span><span style="color: #6f7787;">create new list with unique ids</span>
    (<span style="color: #80A0C2;">dolist</span> (zdID zdFoundIDs)
      (<span style="color: #80A0C2;">unless</span> (member zdID zdCurrentIDs)
        (<span style="color: #80A0C2;">push</span> zdID zdFinalIDs)))
    <span style="color: #6f7787;">; </span><span style="color: #6f7787;">remove the ID of the current buffer from said list</span>
    (<span style="color: #80A0C2;">setq</span> zdThisID (zd-lift-id (file-name-base (buffer-file-name))))
    (<span style="color: #80A0C2;">setq</span> zdFinalIDs (delete zdThisID zdFinalIDs))
    <span style="color: #6f7787;">; </span><span style="color: #6f7787;">finally find full title for each ID and insert it</span>
    (<span style="color: #80A0C2;">if</span> zdFinalIDs
        (<span style="color: #80A0C2;">dolist</span> (zdID zdFinalIDs)
          (<span style="color: #80A0C2;">setq</span> zdID (zd-id-to-full-title zdID))
          (insert <span style="color: #A2BF8A;">" - "</span> (concat zd-link-indicator zdID <span style="color: #A2BF8A;">"\n"</span>)))
      <span style="color: #6f7787;">; </span><span style="color: #6f7787;">unless the list is empty, then insert a message</span>
      (insert (format zd-list-links-missing-message zdSrch)))))
</pre>
</div>

<p>
When no missing links are found, i.e. all the notes with the provided strings are already linked to in the current note, a message is printed instead.
</p>

<p>
To be able to customize this message, include a <code>defcustom</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defcustom</span> <span style="color: #dac6d6;">zd-list-links-missing-message</span>
  <span style="color: #A2BF8A;">"   No missing links with search term =%s= found\n"</span>
  <span style="color: #78808f;">"Message to insert when no missing links are found</span>
<span style="color: #78808f;">by `</span><span style="color: #B58DAE;">zd-insert-list-links-missing</span><span style="color: #78808f;">'.</span>
<span style="color: #78808f;">%s will be replaced by the search term provided to</span>
<span style="color: #78808f;">that function."</span>
  <span style="color: #8EBCBB;">:type</span> 'string
  <span style="color: #8EBCBB;">:group</span> 'zetteldeft)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d63bbb" class="outline-5">
<h5 id="org8d63bbb"><span class="section-number-5">2.4.2.3</span> <code>zd-list-entry-file-link</code> includes a file link as list entry</h5>
<div class="outline-text-5" id="text-2-4-2-3">
<p>
Inserts for given file a link id and title as a list entry.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-list-entry-file-link</span> (zdFile)
  <span style="color: #78808f;">"Insert ZDFILE as list entry."</span>
  (insert <span style="color: #A2BF8A;">" - "</span> (concat zd-link-indicator (file-name-base zdFile)) <span style="color: #A2BF8A;">"\n"</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org945c99a" class="outline-4">
<h4 id="org945c99a"><span class="section-number-4">2.4.3</span> Compiling a single <code>org</code></h4>
<div class="outline-text-4" id="text-2-4-3">
</div>
<div id="outline-container-org6095a4c" class="outline-5">
<h5 id="org6095a4c"><span class="section-number-5">2.4.3.1</span> Idea and example</h5>
<div class="outline-text-5" id="text-2-4-3-1">
</div>
<ol class="org-ol">
<li><a id="org23d9d07"></a>Including notes with given search term<br>
<div class="outline-text-6" id="text-2-4-3-1-1">
<p>
The following explains what <code>zd-org-search-include</code> does, but the concept is more or less the same for <code>zd-org-search-insert</code>.
</p>

<p>
For each of the notes with the provided search term, it inserts a heading, a line with <code>#+INCLUDE</code> and the full path to the relevant notes.
This results in a single file that can be easily exported.
</p>

<p>
The only function meant for use on the users end, is <code>zd-org-search-include</code>.
</p>

<p>
For example,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(zd-org-search-include <span style="color: #A2BF8A;">"#export"</span>)
</pre>
</div>

<p>
inserts necessary code to include all files containing the tag <code>#export</code>.
The results would look like the following:
</p>

<div class="org-src-container">
<pre class="src src-org">\* First file title
<span style="color: #78808f;">#+INCLUDE: "/path/to/2018-07-13-2210 First file title.org"</span>

\* File two
<span style="color: #78808f;">#+INCLUDE: "/path/to/2018-07-13-2223 File two.org"</span>
</pre>
</div>

<p>
All functions are documented below.
</p>
</div>
</li>

<li><a id="orgddb6ab7"></a>Semi-automated example<br>
<div class="outline-text-6" id="text-2-4-3-1-2">
<p>
You could, for example, add the following code to a document and execute (or evaluate) it from within <code>org-mode</code>.
Add it under a &ldquo;comment&rdquo; type heading to prevent it from being exported itself, like so: <code>* COMMENT Code</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">let</span> (frst)
  (<span style="color: #80A0C2;">save-excursion</span>
    <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Move to next heading</span>
    (outline-next-heading)
    (<span style="color: #80A0C2;">setq</span> frst (point))
    <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Delete everything after</span>
    (delete-region frst (point-max))
    <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Include the files</span>
    (zd-org-search-include <span style="color: #A2BF8A;">"#tag"</span>)
    <span style="color: #6f7787;">; </span><span style="color: #6f7787;">Sort these entries alphabetically (set mark to use a region)</span>
<span style="color: #6f7787;">;   </span><span style="color: #6f7787;">(goto-char frst) (set-mark (point-max))</span>
<span style="color: #6f7787;">;   </span><span style="color: #6f7787;">(org-sort-entries nil ?a)</span>
  ))
</pre>
</div>

<p>
The code deletes everything after the current header and inserts all notes with <code>#tag</code> in them.
</p>

<p>
In order to also sort the entries alphabetically, uncomment the last two lines.
</p>

<p>
A final caveat: don&rsquo;t put the file with the above code in you <code>deft</code> folder, or it will attempt to include itself (since it has <code>#tag</code> in it).
</p>
</div>
</li>

<li><a id="orgc437d76"></a>Issues &amp; things to note<br>
<div class="outline-text-6" id="text-2-4-3-1-3">
<p>
Before we look at the functions, a note on limitations of the current implementation.
</p>

<ol class="org-ol">
<li><b>Over-enthousiastic inclusion</b>
Sometimes, a tag appears in a file without the need for it to be included.
For example, a file with a list of all tags will also include the tag one wants.
In the future, this might be resolved by filtering, for example with <a href="http://ergoemacs.org/emacs/elisp_filter_list.html">http://ergoemacs.org/emacs/elisp_filter_list.html</a>.</li>

<li><b>Inclusion from second line onwards</b>
Currently, the <code>#+INCLUDE</code> lines only include from the second line onwards.
This is a work-around to prevent <code>#+TITLE</code> lines from being included (and messing up the title on <code>org-export</code>.
To change this, edit the inserted strings in the <code>zd-org-include-file</code> function.</li>

<li><b>Sorting</b>
The files included are unsorted, or rather: sorted as <code>deft</code> provides the results.
Attempts at sorting by title are included in <code>zd-get-file-list</code>, but not working properly.
As a solution, use <code>org-sort</code> manually after running <code>zd-org-search-include</code>.</li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-org92a0372" class="outline-5">
<h5 id="org92a0372"><span class="section-number-5">2.4.3.2</span> <code>zd-org-search-include</code> generates <code>#+INCLUDE</code> syntax</h5>
<div class="outline-text-5" id="text-2-4-3-2">
<p>
Asks user for a search string and inserts headers and <code>#+INCLUDE</code> code for all files with said tag.
When used on <code>#tag</code>, make sure to include the <code>#</code> manually.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-org-search-include</span> (zdSrch)
  <span style="color: #78808f;">"Insert `</span><span style="color: #B58DAE;">org-mode</span><span style="color: #78808f;">' syntax to include all files containing ZDSRCH.</span>
<span style="color: #78808f;">Prompt for search string when called interactively."</span>
  (<span style="color: #80A0C2;">interactive</span> (list (read-string <span style="color: #A2BF8A;">"tag (include the #): "</span>)))
  (<span style="color: #80A0C2;">dolist</span> (zdFile (zd-get-file-list zdSrch))
    (zd-org-include-file zdFile)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc34f3ba" class="outline-5">
<h5 id="orgc34f3ba"><span class="section-number-5">2.4.3.3</span> <code>zd-org-search-insert</code> generates titles &amp; file content</h5>
<div class="outline-text-5" id="text-2-4-3-3">
<p>
Very similar to the previous function, but rather than writing syntax to include files, insert their contents directly.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-org-search-insert</span> (zdSrch)
  <span style="color: #78808f;">"Insert the contents of all files containing ZDSRCH.</span>
<span style="color: #78808f;">Files are separated by `</span><span style="color: #B58DAE;">org-mode</span><span style="color: #78808f;">' headers with corresponding titles.</span>
<span style="color: #78808f;">Prompt for search string when called interactively."</span>
  (<span style="color: #80A0C2;">interactive</span> (list (read-string <span style="color: #A2BF8A;">"Search term: "</span>)))
  (<span style="color: #80A0C2;">dolist</span> (zdFile (zd-get-file-list zdSrch))
    (zd-org-insert-file zdFile)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeefa6c7" class="outline-4">
<h4 id="orgeefa6c7"><span class="section-number-4">2.4.4</span> Helper functions</h4>
<div class="outline-text-4" id="text-2-4-4">
</div>
<div id="outline-container-orgb5ec77d" class="outline-5">
<h5 id="orgb5ec77d"><span class="section-number-5">2.4.4.1</span> <code>zd-insert-file-contents</code> returns the contents of a file</h5>
<div class="outline-text-5" id="text-2-4-4-1">
<p>
Returns the contents of a file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-file-contents</span> (zdFile <span style="color: #ECCC87;">&amp;optional</span> removeLines)
  <span style="color: #78808f;">"Insert file contents of a zetteldeft note.</span>
<span style="color: #78808f;">ZDFILE should be a full path to a note.</span>

<span style="color: #78808f;">Optional: leave out first REMOVELINES lines."</span>
  (<span style="color: #80A0C2;">with-temp-buffer</span>
    (insert-file-contents zdFile)
    (<span style="color: #80A0C2;">when</span> removeLines
      (kill-whole-line removeLines))
    (buffer-string)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3602024" class="outline-5">
<h5 id="org3602024"><span class="section-number-5">2.4.4.2</span> <code>zd-org-include-file</code> includes a file in <code>org</code> format</h5>
<div class="outline-text-5" id="text-2-4-4-2">
<p>
Inserts the title as a new header, with the <code>#+INCLUDE</code> line below.
Includes only from the second line onward, so that any <code>#+TITLE</code> lines are omitted.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-org-include-file</span> (zdFile)
  <span style="color: #78808f;">"Insert code to include org file ZDFILE."</span>
  (insert
    <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Insert org-mode title</span>
    <span style="color: #A2BF8A;">"* "</span> (zd-lift-file-title zdFile) <span style="color: #A2BF8A;">"\n"</span>
    <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Insert #+INCLUDE: "file.org" :lines 2-</span>
    <span style="color: #A2BF8A;">"#+INCLUDE: \""</span> zdFile <span style="color: #A2BF8A;">"\" :lines \"2-\"\n\n"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org14844d5" class="outline-5">
<h5 id="org14844d5"><span class="section-number-5">2.4.4.3</span> <code>zd-org-insert-file</code> inserts a files content</h5>
<div class="outline-text-5" id="text-2-4-4-3">
<p>
For a file, insert its title and contents (without first 3 lines).
</p>

<p>
Even better would be: without any of the lines starting with <code>#</code> at the beginning of the file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-org-insert-file</span> (zdFile)
  <span style="color: #78808f;">"Insert title and contents of ZDFILE."</span>
  (insert
    <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Insert org-mode title</span>
    <span style="color: #A2BF8A;">"\n* "</span> (zd-lift-file-title zdFile) <span style="color: #A2BF8A;">"\n\n"</span>
    <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Insert file contents (without the first 3 lines)</span>
    (zd-file-contents zdFile 3)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org1c73f6a" class="outline-3">
<h3 id="org1c73f6a"><span class="section-number-3">2.5</span> Creating visuals</h3>
<div class="outline-text-3" id="text-2-5">
<p>

</p>

<p>
In this section:
</p>
<div id="text-table-of-contents">
<ul>
<li><a href="#org4773369">2.5.1. Introducing graphs</a></li>
<li><a href="#org1c0b266">2.5.2. Graph functions</a>
<ul>
<li><a href="#org9dd961c">2.5.2.1. <code>zd-org-graph-search</code> creates graph from search string</a></li>
<li><a href="#orgaceff09">2.5.2.2. <code>zd-org-graph-note</code> creates graph from note</a></li>
</ul>
</li>
<li><a href="#org1673f4c">2.5.3. Building blocks</a>
<ul>
<li><a href="#org9a5bc2d">2.5.3.1. <code>zd-graph-syntax-begin</code> provides opening syntax</a></li>
<li><a href="#org54a30de">2.5.3.2. <code>zd-graph-syntax-end</code> provides closing syntax</a></li>
<li><a href="#orgb3937ce">2.5.3.3. <code>zd-extract-links</code> pulls links from a file</a></li>
<li><a href="#org4464d95">2.5.3.4. <code>zd-graph-insert-links</code> inserts graphviz links</a></li>
<li><a href="#org7912324">2.5.3.5. <code>zd-graph-insert-title</code> inserts graphviz title line</a></li>
<li><a href="#org58b21e9">2.5.3.6. <code>zd-graph-store-link</code> stores provided notes</a></li>
<li><a href="#org03b3cde">2.5.3.7. <code>zd-graph-insert-additional-links</code> inserts stored links</a></li>
<li><a href="#org4690b23">2.5.3.8. <code>zd-graph-insert-all-titles</code> inserts all stored titles</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org4773369" class="outline-4">
<h4 id="org4773369"><span class="section-number-4">2.5.1</span> Introducing graphs</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
Linking notes together in plain text is fun, but sometimes you want to visualize which notes are connected.
</p>

<p>
The following functions attempt to provide said functionallity, but are in a very early stage of development.
They generate an org source block for <code>graphviz</code>, which can then be executed to generate a pdf.
</p>

<p>
A brief introduction:
</p>
<ul class="org-ul">
<li><code>zd-org-graph-search</code> creates a graph with all the notes containing a provided string.</li>
<li><code>zd-org-graph-note</code> creates a graph that starts at a note, connects all notes linked to it, and all notes linked to those. In other words, it looks two levels deep.</li>
</ul>


<p>
The resulting graph looks something like this:
</p>


<figure>
<img src="./img/zd-graph.jpg" alt="zd-graph.jpg">

</figure>

<p>
It&rsquo;s worth noting, again, that this is very provisional.
</p>
</div>
</div>

<div id="outline-container-org1c0b266" class="outline-4">
<h4 id="org1c0b266"><span class="section-number-4">2.5.2</span> Graph functions</h4>
<div class="outline-text-4" id="text-2-5-2">
</div>
<div id="outline-container-org9dd961c" class="outline-5">
<h5 id="org9dd961c"><span class="section-number-5">2.5.2.1</span> <code>zd-org-graph-search</code> creates graph from search string</h5>
<div class="outline-text-5" id="text-2-5-2-1">
<p>
An org code block with <code>graphviz</code> code for a <code>graph.pdf</code>.
</p>

<p>
Find all notes with the provided search term.
Loop over this list, and insert title and links for each one.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-org-graph-search</span> (str)
  <span style="color: #78808f;">"Insert org source block for graph with zd search results.</span>
<span style="color: #78808f;">STR should be the search the resulting notes of which should be included in the graph."</span>
  (<span style="color: #80A0C2;">interactive</span> (list (read-string <span style="color: #A2BF8A;">"search string: "</span>)))
  (<span style="color: #80A0C2;">setq</span> zd-graph--links (list))
  (<span style="color: #80A0C2;">let</span> ((zdList (zd-get-file-list str)))
    (insert zd-graph-syntax-begin)
    (insert <span style="color: #A2BF8A;">"\n  // links\n"</span>)
    (<span style="color: #80A0C2;">dolist</span> (oneFile zdList)
      (insert <span style="color: #A2BF8A;">"\n"</span>)
      (zd-graph-insert-links oneFile))
    (zd-graph-insert-all-titles))
  (insert zd-graph-syntax-end))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaceff09" class="outline-5">
<h5 id="orgaceff09"><span class="section-number-5">2.5.2.2</span> <code>zd-org-graph-note</code> creates graph from note</h5>
<div class="outline-text-5" id="text-2-5-2-2">
<p>
Insert an org source code block for a graphviz presentation of a note and its connections.
</p>

<p>
When links are added, they are also stored in <code>zd-graph--links</code> which is later used to insert titles.
</p>

<p>
When called interactively, select a file from the completion interface.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-org-graph-note</span> (deftFile)
  <span style="color: #78808f;">"Create a graph starting from note DEFTFILE."</span>
  (<span style="color: #80A0C2;">interactive</span> (list
    (completing-read <span style="color: #A2BF8A;">"Note to start graph from: "</span>
      (deft-find-all-files))))
  (<span style="color: #80A0C2;">setq</span> zd-graph--links (list))
  (insert zd-graph-syntax-begin)
  (insert <span style="color: #A2BF8A;">"\n  // base note and links \n"</span>)
  (zd-graph-insert-links deftFile)
  (zd-graph-insert-additional-links)
  (zd-graph-insert-all-titles)
  (insert zd-graph-syntax-end))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1673f4c" class="outline-4">
<h4 id="org1673f4c"><span class="section-number-4">2.5.3</span> Building blocks</h4>
<div class="outline-text-4" id="text-2-5-3">
</div>
<div id="outline-container-org9a5bc2d" class="outline-5">
<h5 id="org9a5bc2d"><span class="section-number-5">2.5.3.1</span> <code>zd-graph-syntax-begin</code> provides opening syntax</h5>
<div class="outline-text-5" id="text-2-5-3-1">
<p>
Within graphviz, I advise to use <code>fdp</code>, <code>twopi</code> (which overlaps more) or <code>circo</code> as layouts.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defcustom</span> <span style="color: #dac6d6;">zd-graph-syntax-begin</span>
  <span style="color: #A2BF8A;">"#+BEGIN_SRC dot :file ./graph.pdf :cmdline -Kfdp -Tpdf</span>
<span style="color: #A2BF8A;">  \n graph {\n"</span>
  <span style="color: #78808f;">"Syntax to be included at the start of the zetteldeft graph."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org54a30de" class="outline-5">
<h5 id="org54a30de"><span class="section-number-5">2.5.3.2</span> <code>zd-graph-syntax-end</code> provides closing syntax</h5>
<div class="outline-text-5" id="text-2-5-3-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defcustom</span> <span style="color: #dac6d6;">zd-graph-syntax-end</span>
  <span style="color: #A2BF8A;">"} \n#+END_SRC\n"</span>
  <span style="color: #78808f;">"Syntax to be included at the end of the zetteldeft graph."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3937ce" class="outline-5">
<h5 id="orgb3937ce"><span class="section-number-5">2.5.3.3</span> <code>zd-extract-links</code> pulls links from a file</h5>
<div class="outline-text-5" id="text-2-5-3-3">
<p>
Very similar to the <code>zd-extract-tags</code> function, but returns links instead of storing them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-extract-links</span> (deftFile)
  <span style="color: #78808f;">"Find all links in DEFTFILE and return a list."</span>
  (<span style="color: #80A0C2;">let</span> ((zdLinks (list)))
    (<span style="color: #80A0C2;">with-temp-buffer</span>
      (insert-file-contents deftFile)
      (<span style="color: #80A0C2;">while</span> (re-search-forward zd-id-regex nil t)
        (<span style="color: #80A0C2;">let</span> ((foundTag (replace-regexp-in-string <span style="color: #A2BF8A;">" "</span> <span style="color: #A2BF8A;">""</span> (match-string 0))))
          <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Add found tag to zdLinks if it isn't there already</span>
          (<span style="color: #80A0C2;">unless</span> (member foundTag zdLinks)
            (<span style="color: #80A0C2;">push</span> foundTag zdLinks)))
        <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Remove found tag from buffer</span>
        (delete-region (point) (re-search-backward zd-id-regex))))
   zdLinks))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4464d95" class="outline-5">
<h5 id="org4464d95"><span class="section-number-5">2.5.3.4</span> <code>zd-graph-insert-links</code> inserts graphviz links</h5>
<div class="outline-text-5" id="text-2-5-3-4">
<p>
Insert the sanitized ID from the file, followed by an arrow and all of the links.
</p>

<p>
Store both the deft file provided and any found files in <code>zd-graph--links</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-graph-insert-links</span> (deftFile)
  <span style="color: #78808f;">"Insert links in DEFTFILE in dot graph syntax on a single line.</span>
<span style="color: #78808f;">Any inserted ID is also stored in `</span><span style="color: #B58DAE;">zd-graph--links</span><span style="color: #78808f;">'."</span>
  (insert <span style="color: #A2BF8A;">"  \""</span>
          (zd-lift-id deftFile)
          <span style="color: #A2BF8A;">"\" -- {"</span>)
  (<span style="color: #80A0C2;">dolist</span> (oneLink (zd-extract-links deftFile))
    (zd-graph-store-link oneLink t)
    (insert <span style="color: #A2BF8A;">"\""</span> oneLink <span style="color: #A2BF8A;">"\" "</span>))
  (insert <span style="color: #A2BF8A;">"}\n"</span>)
  (zd-graph-store-link deftFile))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7912324" class="outline-5">
<h5 id="org7912324"><span class="section-number-5">2.5.3.5</span> <code>zd-graph-insert-title</code> inserts graphviz title line</h5>
<div class="outline-text-5" id="text-2-5-3-5">
<p>
Titles have to be inserted in the correct <code>graphviz</code> format, like so:
</p>

<div class="org-src-container">
<pre class="src src-dot">B [label = <span style="color: #A2BF8A;">"Node B"</span>]
</pre>
</div>

<p>
The following function should achieve that.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-graph-insert-title</span> (deftFile)
  <span style="color: #78808f;">"Insert the DEFTFILE title definition in a one line dot graph format."</span>
  (<span style="color: #80A0C2;">let</span> ((zdTitle (replace-regexp-in-string <span style="color: #A2BF8A;">"\""</span> <span style="color: #A2BF8A;">""</span> (zd-lift-file-title deftFile)))
        (zdId    (zd-lift-id deftFile)))
    (insert <span style="color: #A2BF8A;">"  \""</span> zdId <span style="color: #A2BF8A;">"\""</span>
            <span style="color: #A2BF8A;">" [label = \""</span> zdTitle <span style="color: #A2BF8A;">" ("</span> zd-link-indicator zdId <span style="color: #A2BF8A;">")\""</span>)
    (insert <span style="color: #A2BF8A;">"]"</span> <span style="color: #A2BF8A;">"\n"</span>))
  (zd-graph-store-link deftFile))
</pre>
</div>

<p>
The title is taken from the file string and any additional quotes removed.
</p>
</div>
</div>

<div id="outline-container-org58b21e9" class="outline-5">
<h5 id="org58b21e9"><span class="section-number-5">2.5.3.6</span> <code>zd-graph-store-link</code> stores provided notes</h5>
<div class="outline-text-5" id="text-2-5-3-6">
<p>
For future reference, linked files are stored in <code>zd-graph--links</code>.
This function facilitates that process.
</p>

<p>
Provide a link to a file to store it.
Simply providing an ID works too, if you provide the second argument as true.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-graph-store-link</span> (deftFile <span style="color: #ECCC87;">&amp;optional</span> idToFile)
  <span style="color: #78808f;">"Push DEFTFILE to zd-graph--links unless it's already there.</span>
<span style="color: #78808f;">When IDTOFILE is non-nil, DEFTFILE is considered an id</span>
<span style="color: #78808f;">and the the function first looks for the corresponding file."</span>
  (<span style="color: #80A0C2;">when</span> idToFile
    (<span style="color: #80A0C2;">let</span> ((deft-filter-only-filenames t))
      (<span style="color: #80A0C2;">progn</span>
        (deft-filter deftFile t)
        (<span style="color: #80A0C2;">setq</span> deftFile (car deft-current-files)))))
  (<span style="color: #80A0C2;">unless</span> (member deftFile zd-graph--links)
    (<span style="color: #80A0C2;">push</span> deftFile zd-graph--links)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org03b3cde" class="outline-5">
<h5 id="org03b3cde"><span class="section-number-5">2.5.3.7</span> <code>zd-graph-insert-additional-links</code> inserts stored links</h5>
<div class="outline-text-5" id="text-2-5-3-7">
<p>
Insert links stored in the <code>zd-graph--links</code> list.
Except the first list item, as this is considered the base file already included.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-graph-insert-additional-links</span> ()
  <span style="color: #78808f;">"Insert rest of `</span><span style="color: #B58DAE;">zd-graph--links</span><span style="color: #78808f;">'."</span>
  (<span style="color: #80A0C2;">setq</span> zd-graph--links (cdr zd-graph--links))
  (<span style="color: #80A0C2;">dolist</span> (oneFile zd-graph--links)
    (zd-graph-insert-links oneFile)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4690b23" class="outline-5">
<h5 id="org4690b23"><span class="section-number-5">2.5.3.8</span> <code>zd-graph-insert-all-titles</code> inserts all stored titles</h5>
<div class="outline-text-5" id="text-2-5-3-8">
<p>
Insert all titles stored in <code>zd-graph--links</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">zd-graph-insert-all-titles</span> ()
  <span style="color: #78808f;">"Insert all graphviz title lines for all links stored in `</span><span style="color: #B58DAE;">zd-graph--links</span><span style="color: #78808f;">'."</span>
  (insert <span style="color: #A2BF8A;">"\n  // titles \n"</span>)
  (<span style="color: #80A0C2;">dolist</span> (oneLink zd-graph--links)
    <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Sometimes, a 'nil' list item is present. Ignore those.</span>
    (<span style="color: #80A0C2;">when</span> oneLink
      (zd-graph-insert-title oneLink))))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org2c61072" class="outline-3">
<h3 id="org2c61072"><span class="section-number-3">2.6</span> Aesthetics</h3>
<div class="outline-text-3" id="text-2-6">
</div>
<div id="outline-container-org75977dc" class="outline-4">
<h4 id="org75977dc"><span class="section-number-4">2.6.1</span> Highlighting zetteldeft links</h4>
<div class="outline-text-4" id="text-2-6-1">
<p>
To highlight zetteldeft links, let&rsquo;s add a <code>font-lock</code> keyword to <code>org-mode</code>.
</p>

<p>
The regex used for highlighting is the <code>zd-id-regex</code> prepended by <code>zd-link-indicator</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(font-lock-add-keywords 'org-mode
  `((,(concat zd-link-indicator zd-id-regex) . font-lock-warning-face)))
</pre>
</div>

<p>
For some reason, highlighting is not working in org comments.
</p>
</div>
</div>
</div>

<div id="outline-container-org494fe17" class="outline-3">
<h3 id="org494fe17"><span class="section-number-3">2.7</span> End of package</h3>
<div class="outline-text-3" id="text-2-7">
<p>
That&rsquo;s all folks!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">provide</span> '<span style="color: #B58DAE;">zetteldeft</span>)
<span style="color: #6f7787;">;;; </span><span style="color: #6f7787;">zetteldeft.el ends here</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge32b46c" class="outline-2">
<h2 id="orge32b46c"><span class="section-number-2">3</span> Suggested setup</h2>
<div class="outline-text-2" id="text-3">
<p>
The following assumes <code>deft</code> is loaded manually in your dotfile, it merely configures the package.
</p>

<p>
None of these code blocks are tangled into the <code>.el</code> file, they are here merely as a guide.
</p>
</div>

<div id="outline-container-orgb52f86a" class="outline-3">
<h3 id="orgb52f86a"><span class="section-number-3">3.1</span> Suggested <code>zeteldeft</code> keybindings</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org135d2f5" class="outline-4">
<h4 id="org135d2f5"><span class="section-number-4">3.1.1</span> Keybindings with <code>general</code></h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
To call <code>zetteldeft</code> functions from anywhere behind a leader key such as <code>SPC</code>, I recommend <code>general.el</code> with the following setup.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(general-define-key
  <span style="color: #8EBCBB;">:prefix</span> <span style="color: #A2BF8A;">"SPC"</span>
  <span style="color: #8EBCBB;">:non-normal-prefix</span> <span style="color: #A2BF8A;">"C-SPC"</span>
  <span style="color: #8EBCBB;">:states</span> '(normal visual motion emacs)
  <span style="color: #8EBCBB;">:keymaps</span> 'override
  <span style="color: #A2BF8A;">"d"</span>  '(nil <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"deft"</span>)
  <span style="color: #A2BF8A;">"dd"</span> '(deft <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"deft"</span>)
  <span style="color: #A2BF8A;">"dD"</span> '(zd-deft-new-search <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"new search"</span>)
  <span style="color: #A2BF8A;">"dR"</span> '(deft-refresh <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"refresh"</span>)
  <span style="color: #A2BF8A;">"ds"</span> '(zd-search-at-point <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"search at point"</span>)
  <span style="color: #A2BF8A;">"dc"</span> '(zd-search-current-id <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"search current id"</span>)
  <span style="color: #A2BF8A;">"df"</span> '(zd-avy-file-search <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"avy file search"</span>)
  <span style="color: #A2BF8A;">"dF"</span> '(zd-avy-file-search-ace-window <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"avy file other window"</span>)
  <span style="color: #A2BF8A;">"dl"</span> '(zd-avy-link-search <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"avy link search"</span>)
  <span style="color: #A2BF8A;">"dt"</span> '(zd-avy-tag-search <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"avy tag search"</span>)
  <span style="color: #A2BF8A;">"dT"</span> '(zd-tag-buffer <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"tag list"</span>)
  <span style="color: #A2BF8A;">"di"</span> '(zd-find-file-id-insert <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"insert id"</span>)
  <span style="color: #A2BF8A;">"dI"</span> '(zd-find-file-full-title-insert <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"insert full title"</span>)
  <span style="color: #A2BF8A;">"do"</span> '(zd-find-file <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"find file"</span>)
  <span style="color: #A2BF8A;">"dn"</span> '(zd-new-file <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"new file"</span>)
  <span style="color: #A2BF8A;">"dN"</span> '(zd-new-file-and-link <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"new file &amp; link"</span>)
  <span style="color: #A2BF8A;">"dr"</span> '(zd-file-rename <span style="color: #8EBCBB;">:wk</span> <span style="color: #A2BF8A;">"rename"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga735e64" class="outline-4">
<h4 id="orga735e64"><span class="section-number-4">3.1.2</span> Spacemacs keybindings</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
Suggested keybindings for <code>spacemacs</code>.
</p>

<p>
These can be called from anywhere behind <code>SPC d</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Prefix</span>
(spacemacs/declare-prefix <span style="color: #A2BF8A;">"d"</span> <span style="color: #A2BF8A;">"deft"</span>)
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">Launch deft</span>
(spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dd"</span> 'deft)
(spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dD"</span> 'zd-deft-new-search)
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">SEARCH</span>
 <span style="color: #6f7787;">; </span><span style="color: #6f7787;">Search thing at point</span>
   (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"ds"</span> 'zd-search-at-point)
 <span style="color: #6f7787;">; </span><span style="color: #6f7787;">Search current file id</span>
   (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dc"</span> 'zd-search-current-id)
 <span style="color: #6f7787;">; </span><span style="color: #6f7787;">Jump &amp; search with avy </span>
 <span style="color: #6f7787;">;  </span><span style="color: #6f7787;">search link as filename</span>
    (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"df"</span> 'zd-avy-file-search)
    (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dF"</span> 'zd-avy-file-search-ace-window)
 <span style="color: #6f7787;">;  </span><span style="color: #6f7787;">search link as contents</span>
    (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dl"</span> 'zd-avy-link-search)
 <span style="color: #6f7787;">;  </span><span style="color: #6f7787;">search tag as contents</span>
    (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dt"</span> 'zd-avy-tag-search)
 <span style="color: #6f7787;">;  </span><span style="color: #6f7787;">find all tags</span>
    (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dT"</span> 'zd-tag-buffer)
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">LINKS</span>
 <span style="color: #6f7787;">; </span><span style="color: #6f7787;">Insert link from filename</span>
   (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"di"</span> 'zd-find-file-id-insert)
 <span style="color: #6f7787;">; </span><span style="color: #6f7787;">Insert link with full filename</span>
   (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dI"</span> 'zd-find-file-full-title-insert)
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">FILES</span>
 <span style="color: #6f7787;">; </span><span style="color: #6f7787;">Open file</span>
   (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"do"</span> 'zd-find-file)
 <span style="color: #6f7787;">; </span><span style="color: #6f7787;">Create new file</span>
   (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dn"</span> 'zd-new-file)
   (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dN"</span> 'zd-new-file-and-link)
 <span style="color: #6f7787;">; </span><span style="color: #6f7787;">Rename file</span>
   (spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dr"</span> 'zd-file-rename)
<span style="color: #6f7787;">;; </span><span style="color: #6f7787;">UTILITIES</span>
(spacemacs/set-leader-keys <span style="color: #A2BF8A;">"dR"</span> 'deft-refresh)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5f8dcfa" class="outline-3">
<h3 id="org5f8dcfa"><span class="section-number-3">3.2</span> Suggested <code>deft</code> setup</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-orgfb3d697" class="outline-4">
<h4 id="orgfb3d697"><span class="section-number-4">3.2.1</span> Notes &amp; extensions</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
Note extensions are <code>md</code>, <code>txt</code> and <code>org</code>.
First of this list is the default for new notes.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">setq</span> deft-extensions '(<span style="color: #A2BF8A;">"org"</span> <span style="color: #A2BF8A;">"md"</span> <span style="color: #A2BF8A;">"txt"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c854c3" class="outline-4">
<h4 id="org5c854c3"><span class="section-number-4">3.2.2</span> Set <code>deft-directory</code></h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Search the deft directory recursively, to include subdirectories.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">setq</span> deft-directory (concat org-directory <span style="color: #A2BF8A;">"/notes/zetteldeft"</span>))
(<span style="color: #80A0C2;">setq</span> deft-recursive t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org457030c" class="outline-4">
<h4 id="org457030c"><span class="section-number-4">3.2.3</span> Additional <code>deft</code> functions</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Some personal additions.
</p>

<p>
A small function to open a file in the other window and shifting focus to it.
That final part is what the <code>t</code> argument does.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">efls/deft-open-other</span> ()
 (<span style="color: #80A0C2;">interactive</span>)
 (deft-open-file-other-window t))
</pre>
</div>

<p>
Let&rsquo;s add another function, to simply preview in the other window, i.e. not switch focus to it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">defun</span> <span style="color: #8EBCBB;">efls/deft-open-preview</span> ()
 (<span style="color: #80A0C2;">interactive</span>)
 (deft-open-file-other-window))
</pre>
</div>


<p>
To select results from the item list without leaving the <code>insert</code> state, I add the following keys.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">with-eval-after-load</span> 'deft
  (define-key deft-mode-map
    (kbd <span style="color: #A2BF8A;">"&lt;tab&gt;"</span>) 'efls/deft-open-preview)
  (define-key deft-mode-map
    (kbd <span style="color: #A2BF8A;">"&lt;s-return&gt;"</span>) 'efls/deft-open-other)
  (define-key deft-mode-map
    (kbd <span style="color: #A2BF8A;">"s-j"</span>) 'evil-next-line)
  (define-key deft-mode-map (kbd <span style="color: #A2BF8A;">"s-k"</span>) 'evil-previous-line))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0afaf3b" class="outline-4">
<h4 id="org0afaf3b"><span class="section-number-4">3.2.4</span> Ignore more <code>org-mode</code> metadata</h4>
<div class="outline-text-4" id="text-3-2-4">
<p>
I tend to write <code>org-mode</code> titles with <code>#+title:</code> (i.e., uncapitalized). Also other <code>org-mode</code> code at the beginning is written in lower case.
</p>

<p>
In order to filter these from the deft summary, let&rsquo;s alter the regular expression:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #80A0C2;">setq</span> deft-strip-summary-regexp
 (concat <span style="color: #A2BF8A;">"</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">(</span><span style="color: #A2BF8A;">"</span>
         <span style="color: #A2BF8A;">"[\n\t]"</span> <span style="color: #6f7787;">;; </span><span style="color: #6f7787;">blank</span>
         <span style="color: #A2BF8A;">"</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">|</span><span style="color: #A2BF8A;">^#\\+[a-zA-Z_]+:.*$"</span> <span style="color: #6f7787;">;;</span><span style="color: #6f7787;">org-mode metadata</span>
         <span style="color: #A2BF8A;">"</span><span style="color: #80A0C2; font-weight: bold;">\\</span><span style="color: #80A0C2; font-weight: bold;">)</span><span style="color: #A2BF8A;">"</span>))
</pre>
</div>

<p>
Its original value was <code>\\([\n ]\\|^#\\+[[:upper:]_]+:.*$\\)</code>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf491785" class="outline-2">
<h2 id="orgf491785"><span class="section-number-2">4</span> Brainstorm</h2>
<div class="outline-text-2" id="text-4">
<p>
Some ideas for the future.
</p>

<ul class="org-ul">
<li>Export HTML with clickeable links between notes.</li>
<li>Export markdown through <code>pandoc</code>.</li>
<li>Create a minor mode to higlight links &amp; tags and display clickeable links.</li>
<li>Saved searches, somewhere easily accessible.</li>
</ul>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
For those not yet familiar: <b>deft</b> is a note manager within <code>emacs</code>, for easily searching and retrieving plain text notes.
It is inspired by the popular Notational Velocity.
Check out <a href="https://jblevins.org/projects/deft/">jblevins.org/projects/deft/</a> and <a href="http://notational.net">notational.net</a>.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class='author'>Author: EFLS</p>

    <p class='date'>Modified: 2019-02-28 Thu 21:33</p>

    <p class='creator'><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.1 (<a href="https://orgmode.org">Org</a> mode 9.2.1)</p>
</div>
</body>
</html>
