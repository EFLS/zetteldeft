<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-07-17 Tue 20:28 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zetteldeft</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="EFLS" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel='stylesheet' href='style.css' type='text/css'/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Zetteldeft</h1>

<p>
This document contains all the source code to a set of functions for <code>emacs</code> which aim to extend the <code>deft</code> package and turn it into a (very very) basic Zettelkasten note-taking system.
</p>

<p>
Check out the github <a href="https://github.com/EFLS/zetteldeft">repository</a> to get the source.
Read on for an introduction and some documentation.
</p>

<p>
Latest additions:
</p>
<ul class="org-ul">
<li><b>17 July</b>: Insert note title with <code>zd-insert-org-title</code>.</li>
<li><b>16 July</b>: Compile a single <code>org</code> that includes tagged files with <code>zd-org-include-tag</code>.</li>
<li><b>16 July</b>: Highlight zetteldeft links in <code>org-mode</code>.</li>
</ul>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgcccc5ff">1. What?</a>
<ul>
<li><a href="#orgadb8162">1.1. A Zettelkasten system for <code>emacs</code> based on <code>deft</code></a></li>
<li><a href="#org98cf59b">1.2. Basic concepts</a></li>
<li><a href="#org1b24c44">1.3. Basic functions</a></li>
<li><a href="#org2cc29de">1.4. How to use this source</a></li>
</ul>
</li>
<li><a href="#orgc4a775f">2. <code>deft</code> setup</a>
<ul>
<li><a href="#orgb764524">2.1. Set <code>deft-directory</code></a></li>
<li><a href="#org3301c50">2.2. Notes &amp; extensions</a></li>
<li><a href="#org6049f3c">2.3. Ignore more <code>org-mode</code> metadata</a></li>
</ul>
</li>
<li><a href="#org18e207f">3. <code>zetteldeft</code> functions</a>
<ul>
<li><a href="#orgb8d88c5">3.1. Search functions</a></li>
<li><a href="#org3b12c78">3.2. IDs</a></li>
<li><a href="#org9491294">3.3. Finding &amp; linking files from minibuffer</a></li>
<li><a href="#orge992ca4">3.4. New file creation</a></li>
<li><a href="#org853a9f3">3.5. Functions with <code>avy</code></a></li>
<li><a href="#org82dc15c">3.6. Utility functions</a></li>
</ul>
</li>
<li><a href="#org75595b9">4. Compiling a single <code>org</code> from <code>tags</code></a>
<ul>
<li><a href="#org619a534">4.1. Idea: including notes with given tag</a></li>
<li><a href="#orgf1048d6">4.2. Issues &amp; things to note</a></li>
<li><a href="#orga9c964c">4.3. <code>zd-org-include-tag</code> generates <code>#+INCLUDE</code> code</a></li>
<li><a href="#org0ae1970">4.4. <code>zd-org-include-tagged-files</code> includes files with tag</a></li>
<li><a href="#orga6da3f1">4.5. <code>zd-get-file-list</code> returns file list on search</a></li>
<li><a href="#orgd4442b9">4.6. <code>zd-lift-file-title</code> returns file title from path</a></li>
<li><a href="#org795c58e">4.7. <code>zd-org-include-file</code> includes a file in <code>org</code> format</a></li>
</ul>
</li>
<li><a href="#org37e1090">5. Aesthetics</a>
<ul>
<li><a href="#org5fe3548">5.1. Highlighting zetteldeft links</a></li>
</ul>
</li>
<li><a href="#org1e30df5">6. Keybindings</a>
<ul>
<li><a href="#org0530a25">6.1. Additional <code>deft</code> keybindings</a></li>
<li><a href="#orge583da4">6.2. Some <code>zetteldeft</code> specifics</a></li>
</ul>
</li>
<li><a href="#orgcb9b495">7. Brainstorm</a>
<ul>
<li><a href="#org871a970">7.1. Saved searches</a></li>
<li><a href="#orgbcdd033">7.2. Generate list of tags</a></li>
<li><a href="#org205db88">7.3. HTML export</a></li>
<li><a href="#orgde99e4e">7.4. Markdown export</a></li>
<li><a href="#org51ad6ab">7.5. Templates</a></li>
<li><a href="#org2a177e0">7.6. Minor mode</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgcccc5ff" class="outline-2">
<h2 id="orgcccc5ff"><span class="section-number-2">1</span> What?</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgadb8162" class="outline-3">
<h3 id="orgadb8162"><span class="section-number-3">1.1</span> A Zettelkasten system for <code>emacs</code> based on <code>deft</code></h3>
<div class="outline-text-3" id="text-1-1">
<p>
This is my feeble attempt at recreating a Zettelkasten environment by extending the excellent <code>deft</code> package in <code>emacs</code>.<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>
I call it <b>zetteldeft</b>.
It is inspired by the <i>The Archive</i> app. For this and more on the Zettelkasten way of taking notes, see <a href="https://zettelkasten.de">zettelkasten.de</a>. They have a forum for discussion on both software and the specifics of the Zettelkasten philosophy.
</p>

<p>
The code that follows is created and maintained for my personal use, shared here in hope that it can benefit others as well.
I'd be happy to learn how you use it and expand upon it.
</p>

<p>
It is very much WIP and I'm fairly new to <code>elisp</code>, so it might contain some stupid code.
</p>

<p>
Anyway, here we go.
</p>
</div>
</div>

<div id="outline-container-org98cf59b" class="outline-3">
<h3 id="org98cf59b"><span class="section-number-3">1.2</span> Basic concepts</h3>
<div class="outline-text-3" id="text-1-2">
<p>
<b>Notes</b> reside in the <code>deft-directory</code>.
Notes are written in <code>org-mode</code> (although this can be changed easily).
</p>

<p>
The filename of a note starts with a unique <b>id</b> based on the time and the date, for example: <code>2018-07-09-2115 This is a note.org</code>.
</p>

<p>
This unique id can be used to <b>link</b> notes together.
A link is indicated by a <code>§</code> character, followed by the id.
For example: <code>§2018-07-08-2115</code> should link to the file above.
A link can appear anywhere in the text.
</p>

<p>
When searching <code>deft</code> with the <b>id</b> as a filter, you'll find both the original note (with the id in its name) and all the notes that link to this note (with the id in its body). Do so with <code>zd-search-current-id</code> and <code>zd-avy-link-search</code> respectively
</p>

<p>
Notes can contain <b>tags</b>, prepended with a <code>#</code>.
This is a tag: <code>#tag</code>.
Tags make it easy to retrieve notes. They can appear anywhere in the note, but I'd suggest putting them somewhere at the top.
</p>

<p>
Call up a <code>deft</code> search on both tags and links with <code>zd-search-at-point</code>.
To jump to a tag or link and search it, use <code>zd-avy-tag-search</code> and <code>zd-avy-link-search</code> respectively.
To open a note from a link, use <code>zd-avy-file-search</code>.
</p>
</div>
</div>

<div id="outline-container-org1b24c44" class="outline-3">
<h3 id="org1b24c44"><span class="section-number-3">1.3</span> Basic functions</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Some functions to get started.
I created more, but these should be enough to get you started.
Default keybindings are set at the bottom &#x2013; and meant for spacemacs.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">Use</th>
<th scope="col" class="org-left">Keybinding</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>zd-search-at-point</code></td>
<td class="org-left">Search for thing at point</td>
<td class="org-left"><code>SPC d s</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-search-current-id</code></td>
<td class="org-left">Search for id of current file</td>
<td class="org-left"><code>SPC d c</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-file-search</code></td>
<td class="org-left">Select <code>§</code> id and open linked file</td>
<td class="org-left"><code>SPC d f</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-link-search</code></td>
<td class="org-left">Select <code>§</code> id and search for it</td>
<td class="org-left"><code>SPC d l</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-tag-search</code></td>
<td class="org-left">Select <code>#</code> tag and search for it</td>
<td class="org-left"><code>SPC d t</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-new-file</code></td>
<td class="org-left">Create new note and open</td>
<td class="org-left"><code>SPC d n</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-new-file-and-link</code></td>
<td class="org-left">Create new note and insert <code>§</code> id</td>
<td class="org-left"><code>SPC d N</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-find-file-id-insert</code></td>
<td class="org-left">Pick a note and insert its <code>§</code> id</td>
<td class="org-left"><code>SPC d i</code></td>
</tr>
</tbody>
</table>

<p>
More details documented below.
</p>
</div>
</div>

<div id="outline-container-org2cc29de" class="outline-3">
<h3 id="org2cc29de"><span class="section-number-3">1.4</span> How to use this source</h3>
<div class="outline-text-3" id="text-1-4">
<p>
This set of commands requires:
</p>
<ul class="org-ul">
<li><code>deft</code>, obviously</li>
<li><code>avy</code> comes in handy to jump &amp; search (see the final set of functions)</li>
</ul>

<p>
From the github repository, either
</p>
<ul class="org-ul">
<li>download the <code>org-file</code> and <code>org-tangle</code> it yourself. It should contain everything.</li>
<li>or download the <code>zetteldeft.el</code> file.</li>
</ul>

<p>
Whichever way you go, load the <code>.el</code> file in emacs with
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span>load <span style="color: #2d9574;">"/path/to/zetteldeft.el"</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
and you're good to go!
</p>
</div>
</div>
</div>

<div id="outline-container-orgc4a775f" class="outline-2">
<h2 id="orgc4a775f"><span class="section-number-2">2</span> <code>deft</code> setup</h2>
<div class="outline-text-2" id="text-2">
<p>
The following assumes <code>deft</code> is loaded manually in your dotfile, it merely configures the package.
</p>
</div>

<div id="outline-container-orgb764524" class="outline-3">
<h3 id="orgb764524"><span class="section-number-3">2.1</span> Set <code>deft-directory</code></h3>
<div class="outline-text-3" id="text-2-1">
<p>
Search the deft directory recursively, to include subdirectories.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">setq</span> deft-directory <span style="color: #6c3163;">(</span>concat org-directory <span style="color: #2d9574;">"/notes/zetteldeft"</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">setq</span> deft-recursive t<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3301c50" class="outline-3">
<h3 id="org3301c50"><span class="section-number-3">2.2</span> Notes &amp; extensions</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Note extensions are <code>md</code>, <code>txt</code> and <code>org</code>.
First of this list is the default for new notes.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">setq</span> deft-extensions '<span style="color: #6c3163;">(</span><span style="color: #2d9574;">"org"</span> <span style="color: #2d9574;">"md"</span> <span style="color: #2d9574;">"txt"</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6049f3c" class="outline-3">
<h3 id="org6049f3c"><span class="section-number-3">2.3</span> Ignore more <code>org-mode</code> metadata</h3>
<div class="outline-text-3" id="text-2-3">
<p>
I tend to write <code>org-mode</code> titles with <code>#+title:</code> (i.e., uncapitalized). Also other <code>org-mode</code> code at the beginning is written in lower case.
</p>

<p>
In order to filter these from the deft summary, let's alter the regular expression:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">setq</span> deft-strip-summary-regexp
 <span style="color: #6c3163;">(</span>concat <span style="color: #2d9574;">"</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">(</span><span style="color: #2d9574;">"</span>
         <span style="color: #2d9574;">"[\n\t]"</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">blank</span>
         <span style="color: #2d9574;">"</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">|</span><span style="color: #2d9574;">^#\\+[a-zA-Z_]+:.*$"</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">;;</span><span style="color: #2aa1ae; background-color: #ecf3ec;">org-mode metadata</span>
         <span style="color: #2d9574;">"</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">)</span><span style="color: #2d9574;">"</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Its original value was <code>\\([\n ]\\|^#\\+[[:upper:]_]+:.*$\\)</code>.
</p>
</div>
</div>
</div>


<div id="outline-container-org18e207f" class="outline-2">
<h2 id="org18e207f"><span class="section-number-2">3</span> <code>zetteldeft</code> functions</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgb8d88c5" class="outline-3">
<h3 id="orgb8d88c5"><span class="section-number-3">3.1</span> Search functions</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org2320697" class="outline-4">
<h4 id="org2320697"><span class="section-number-4">3.1.1</span> <code>zd-get-thing-at-point</code> returns string</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Returns the thing at point as string.
</p>

<p>
Tries to get, in the following order:
</p>
<ul class="org-ul">
<li>links between <code>[[</code></li>
<li>hashtags: <code>§</code>, <code>#</code> or <code>@</code></li>
<li>words</li>
</ul>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft's <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-get-thing-at-point</span> <span style="color: #6c3163;">()</span>
<span style="color: #2aa1ae;">"Return the thing at point, which can be a link, tag or word."</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">require</span> '<span style="color: #4e3163;">thingatpt</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let*</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>link-re <span style="color: #2d9574;">"\\[\\[</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">(</span><span style="color: #2d9574;">[</span><span style="color: #4e3163;">^</span><span style="color: #2d9574;">]]+</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">)</span><span style="color: #2d9574;">\\]\\]"</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>htag-re <span style="color: #2d9574;">"</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">(</span><span style="color: #2d9574;">[&#167;#@][[:alnum:]_-]+</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">)</span><span style="color: #2d9574;">"</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span>
    <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>thing-at-point-looking-at link-re<span style="color: #b1951d;">)</span>
      <span style="color: #b1951d;">(</span>match-string-no-properties <span style="color: #4e3163;">1</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
     <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>thing-at-point-looking-at htag-re<span style="color: #b1951d;">)</span>
      <span style="color: #b1951d;">(</span>match-string-no-properties <span style="color: #4e3163;">1</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
     <span style="color: #67b11d;">(</span>t <span style="color: #b1951d;">(</span>thing-at-point 'word t<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
  <span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0874cc4" class="outline-4">
<h4 id="org0874cc4"><span class="section-number-4">3.1.2</span> <code>zd-search-at-point</code> thing at point</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
Search the thing at point.
Note that calling <code>zd-search-at-point</code> on a <code>§</code> link includes <code>§</code> in the filter string.
</p>


<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft's <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-search-at-point</span> <span style="color: #6c3163;">()</span>
<span style="color: #2aa1ae;">"Search deft with thing-at-point as filter.</span>
<span style="color: #2aa1ae;">Thing can be a double-bracketed link, a hashtag, or a word."</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>string <span style="color: #b1951d;">(</span>zd-get-thing-at-point<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> string
       <span style="color: #67b11d;">(</span>zd-search-global string t<span style="color: #67b11d;">)</span>
     <span style="color: #67b11d;">(</span><span style="color: #dc752f; background-color: #fbf8ef;">user-error</span> <span style="color: #2d9574;">"No search term at point"</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d7e19b" class="outline-4">
<h4 id="org2d7e19b"><span class="section-number-4">3.1.3</span> <code>zd-search-global</code> for string</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
Search with deft for given string.
If there is only one result, that file is opened, unless additional argument is true.
</p>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft's <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-search-global</span> <span style="color: #6c3163;">(</span>str <span style="color: #ba2f59; font-weight: bold;">&amp;optional</span> dntOpn<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Search deft with STR as filter.</span>
<span style="color: #2aa1ae;">If there is only one result, open that file (unless DNTOPN is true)."</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Sanitize the filter string</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">setq</span> str <span style="color: #2d9574;">(</span>replace-regexp-in-string <span style="color: #2d9574;">"[[:space:]\n]+"</span> <span style="color: #2d9574;">" "</span> str<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Call deft search on the filter string</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>deft-incremental-search t<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>deft<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>deft-filter str t<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">If there is a single match, open the file</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">unless</span> dntOpn
   <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">when</span> <span style="color: #67b11d;">(</span>eq <span style="color: #b1951d;">(</span>length deft-current-files<span style="color: #b1951d;">)</span> <span style="color: #4e3163;">1</span><span style="color: #67b11d;">)</span>
     <span style="color: #67b11d;">(</span>deft-open-file <span style="color: #b1951d;">(</span>car deft-current-files<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org377b563" class="outline-4">
<h4 id="org377b563"><span class="section-number-4">3.1.4</span> <code>zd-search-filename</code> for string</h4>
<div class="outline-text-4" id="text-3-1-4">
<p>
Deft search on filename.
If there is only one result, open that file.
</p>

<p>
Incremental search is turned off, and the filter is set to filenames only.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-search-filename</span> <span style="color: #6c3163;">(</span>str<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Search for deft files with string STR in filename.</span>
<span style="color: #2aa1ae;">Open if there is only one result."</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Sanitize the filter string</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">setq</span> str <span style="color: #2d9574;">(</span>replace-regexp-in-string <span style="color: #2d9574;">"[[:space:]\n]+"</span> <span style="color: #2d9574;">" "</span> str<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Call deft search on the filter string</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>deft-filter-only-filenames t<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>deft<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>deft-filter str t<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">If there is a single match, open the file</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">when</span> <span style="color: #2d9574;">(</span>eq <span style="color: #67b11d;">(</span>length deft-current-files<span style="color: #67b11d;">)</span> <span style="color: #4e3163;">1</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>deft-open-file <span style="color: #67b11d;">(</span>car deft-current-files<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org666f84a" class="outline-4">
<h4 id="org666f84a"><span class="section-number-4">3.1.5</span> <code>zd-search-current-id</code> searches current id</h4>
<div class="outline-text-4" id="text-3-1-5">
<p>
Deft search on the id of the current file.
</p>

<p>
Result is not opened automaticaly.
</p>

<p>
This function is useful to easily see which notes link to the current file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-search-current-id</span> <span style="color: #6c3163;">()</span>
<span style="color: #2aa1ae;">"Search deft with the id of the current file as filter.</span>
<span style="color: #2aa1ae;">Open if there is only one result."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>zd-search-global <span style="color: #2d9574;">(</span>zd-id-current-file<span style="color: #2d9574;">)</span> t<span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3b12c78" class="outline-3">
<h3 id="org3b12c78"><span class="section-number-3">3.2</span> IDs</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org0bdd75c" class="outline-4">
<h4 id="org0bdd75c"><span class="section-number-4">3.2.1</span> Basics for IDs</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
String format when generating ids.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defcustom</span> <span style="color: #715ab1;">zd-id-format</span> <span style="color: #2d9574;">"%Y-%m-%d-%H%M"</span>
  <span style="color: #2aa1ae;">"Format used when generating zetteldeft IDs."</span>
  <span style="color: #3a81c3;">:type</span> 'string
  <span style="color: #3a81c3;">:group</span> 'zetteldeft
<span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
While we're at it, lets tell deft to create new files with this new format.
For good measure: I'd advise creating new notes in the <code>zetteldeft</code> system with <code>zd-new-file</code> or <code>zd-new-file-and-link</code>. See below.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">setq</span> deft-new-file-format zd-id-format<span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Here is a function to generate an id string in said format.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-generate-id</span> <span style="color: #6c3163;">()</span>
 <span style="color: #2aa1ae;">"Generates an id in `</span><span style="color: #4e3163;">zd-id-format</span><span style="color: #2aa1ae;">'."</span>
 <span style="color: #6c3163;">(</span>format-time-string zd-id-format<span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge566567" class="outline-4">
<h4 id="orge566567"><span class="section-number-4">3.2.2</span> <code>zd-id-insert</code> inserts id</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
A helper function to insert a generated id.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-id-insert</span> <span style="color: #6c3163;">()</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
 <span style="color: #2d9574;">"Inserts an id in `</span><span style="color: #4e3163;">zd-id-format</span><span style="color: #2d9574;">'."</span>
 <span style="color: #6c3163;">(</span>insert <span style="color: #2d9574;">(</span>zd-generate-id<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">" "</span><span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebc9746" class="outline-4">
<h4 id="orgebc9746"><span class="section-number-4">3.2.3</span> <code>zd-id-sanitized</code> cleans ids</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Returns the string stripped from everything that is not a number or a <code>-</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-id-sanitized</span> <span style="color: #6c3163;">(</span>str<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Strip STRING from everything that is not a number or a dash."</span>
 <span style="color: #6c3163;">(</span>replace-regexp-in-string <span style="color: #2d9574;">"[</span><span style="color: #4e3163;">^</span><span style="color: #2d9574;">(0-9)-]+"</span> <span style="color: #2d9574;">""</span> str<span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Potential shortcomming: any numbers <i>after</i> the id are not stripped.
Problematic when stripping the id from a filename, for example.
</p>

<p>
The following regular expression should work better: <code>[0-9-]\\{2,\\}-[0-9-]+</code> (but cannot be used with <code>replace-regexp-in-string</code> function). Something to fix.
</p>
</div>
</div>

<div id="outline-container-org1394372" class="outline-4">
<h4 id="org1394372"><span class="section-number-4">3.2.4</span> <code>zd-file-id-stripped</code> strips file id from string</h4>
<div class="outline-text-4" id="text-3-2-4">
<p>
Attempts to strip the file id from a string.
</p>

<p>
This requires a <b>fix</b>, or better yet, a reimplementation. Too crude at the moment.
</p>

<p>
First, take only 17 first characters from the input string.
Next, omit anything that is not a digit or a dash.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-file-id-stripped</span> <span style="color: #6c3163;">(</span>file<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Returns file id stripped from given filename FILE."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>file <span style="color: #b1951d;">(</span>substring file <span style="color: #4e3163;">0</span> <span style="color: #4e3163;">16</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>zd-id-sanitized file<span style="color: #2d9574;">)</span>
<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org5d6e823" class="outline-4">
<h4 id="org5d6e823"><span class="section-number-4">3.2.5</span> <code>zd-id-current-file</code> returns id in filename</h4>
<div class="outline-text-4" id="text-3-2-5">
<p>
Return the id from the filename the buffer is currently visiting.
</p>

<p>
Requires <b>fix</b>: filenames with numbers in it are not fully stripped.
</p>

<p>
Steps:
</p>
<ol class="org-ol">
<li>Get the filename from the buffer</li>
<li>Strip the ID from it.</li>
<li>Result can be empty string when no id is detected in the filename.</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-id-current-file</span> <span style="color: #6c3163;">()</span>
<span style="color: #2aa1ae;">"Return the id from the filename the buffer is currently visiting."</span>
 <span style="color: #6c3163;">(</span>zd-file-id-stripped <span style="color: #2d9574;">(</span>file-name-base <span style="color: #67b11d;">(</span>buffer-file-name<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5054dfd" class="outline-4">
<h4 id="org5054dfd"><span class="section-number-4">3.2.6</span> <code>zd-copy-id-current-file</code> copies id in filename</h4>
<div class="outline-text-4" id="text-3-2-6">
<p>
Add the ID from the current file to the kill ring.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-copy-id-current-file</span> <span style="color: #6c3163;">()</span>
<span style="color: #2aa1ae;">"Add the id from the filename the buffer is currently visiting to the kill ring."</span>
<span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>kill-new <span style="color: #2d9574;">(</span>zd-id-current-file<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9491294" class="outline-3">
<h3 id="org9491294"><span class="section-number-3">3.3</span> Finding &amp; linking files from minibuffer</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-orgbd1e510" class="outline-4">
<h4 id="orgbd1e510"><span class="section-number-4">3.3.1</span> <code>zd-find-file</code> opens file from minibuffer</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
Select file from the deft folder from the minibuffer.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-find-file</span> <span style="color: #6c3163;">(</span>file<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Open deft file FILE."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span>
  <span style="color: #2d9574;">(</span>list <span style="color: #67b11d;">(</span>completing-read <span style="color: #2d9574;">"Deft find file: "</span>
        <span style="color: #b1951d;">(</span>deft-find-all-files-no-prefix<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>deft-find-file file<span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge44cea7" class="outline-4">
<h4 id="orge44cea7"><span class="section-number-4">3.3.2</span> <code>zd-find-file-id-copy</code> copies file id</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
Select file from minibuffer and add its link id to kill ring.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-find-file-id-copy</span> <span style="color: #6c3163;">(</span>file<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Find deft file FILE and add its id to the kill ring."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span> <span style="color: #2d9574;">(</span>list
        <span style="color: #67b11d;">(</span>completing-read <span style="color: #2d9574;">"File to copy id from: "</span>
        <span style="color: #b1951d;">(</span>deft-find-all-files-no-prefix<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>kill-new <span style="color: #2d9574;">(</span>concat <span style="color: #2d9574;">"&#167;"</span> <span style="color: #67b11d;">(</span>zd-file-id-stripped file<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5797c91" class="outline-4">
<h4 id="org5797c91"><span class="section-number-4">3.3.3</span> <code>zd-find-file-id-insert</code> inserts file id</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
Select file from minibuffer and insert its link, prepended by <code>§</code>.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-find-file-id-insert</span> <span style="color: #6c3163;">(</span>file<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Find deft file FILE and insert its link id, prepended by &#167;."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span> <span style="color: #2d9574;">(</span>list
        <span style="color: #67b11d;">(</span>completing-read <span style="color: #2d9574;">"File to insert id from: "</span>
        <span style="color: #b1951d;">(</span>deft-find-all-files-no-prefix<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>insert <span style="color: #2d9574;">(</span>concat <span style="color: #2d9574;">"&#167;"</span> <span style="color: #67b11d;">(</span>zd-file-id-stripped file<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org93d4aa7" class="outline-4">
<h4 id="org93d4aa7"><span class="section-number-4">3.3.4</span> <code>zd-find-file-full-title-insert</code> inserts full file title</h4>
<div class="outline-text-4" id="text-3-3-4">
<p>
Select file from minibuffer and insert its link, prepended by <code>§</code>.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-find-file-full-title-insert</span> <span style="color: #6c3163;">(</span>file<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Find deft file FILE and insert its link id with title, prepended by &#167;."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span> <span style="color: #2d9574;">(</span>list
        <span style="color: #67b11d;">(</span>completing-read <span style="color: #2d9574;">"File to insert id from: "</span>
        <span style="color: #b1951d;">(</span>deft-find-all-files-no-prefix<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>insert <span style="color: #2d9574;">(</span>concat <span style="color: #2d9574;">"&#167;"</span> <span style="color: #67b11d;">(</span>file-name-base file<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge992ca4" class="outline-3">
<h3 id="orge992ca4"><span class="section-number-3">3.4</span> New file creation</h3>
<div class="outline-text-3" id="text-3-4">
</div>
<div id="outline-container-orgf9be3a6" class="outline-4">
<h4 id="orgf9be3a6"><span class="section-number-4">3.4.1</span> <code>zd-new-file</code> creates new file</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
Create new file with filename as <code>zd-id-format</code> and a string.
</p>

<p>
Either provide a name as argument, or enter one in the mini-buffer.
A title is automatically added to the file, unless an additioanl parameter is given.
When <code>evil</code> is used, enter the insert state as well.
The full name is added to the kill ring.
Note that the file is only actually created upon save.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-new-file</span> <span style="color: #6c3163;">(</span>str <span style="color: #ba2f59; font-weight: bold;">&amp;optional</span> empty<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Create a new deft file. Filename is `</span><span style="color: #4e3163;">zd-id-format</span><span style="color: #2aa1ae;">' appended by STR. No extension needed.</span>

<span style="color: #2aa1ae;">After creating, the title is inserted in org-mode format (unless EMPTY is true) and the full file name is added to the kill ring."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span> <span style="color: #2d9574;">(</span>list <span style="color: #67b11d;">(</span>read-string <span style="color: #2d9574;">"name: "</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let*</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>zdId <span style="color: #b1951d;">(</span>zd-generate-id<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
        <span style="color: #67b11d;">(</span>zdName <span style="color: #b1951d;">(</span>concat zdId <span style="color: #2d9574;">" "</span> str<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
 <span style="color: #2d9574;">(</span>deft-new-file-named zdName<span style="color: #2d9574;">)</span>
 <span style="color: #2d9574;">(</span>kill-new zdName<span style="color: #2d9574;">)</span>
 <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">unless</span> empty <span style="color: #67b11d;">(</span>zd-insert-org-title<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
 <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">when</span> <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">featurep</span> '<span style="color: #4e3163;">evil</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>evil-insert-state<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org16ae2b9" class="outline-4">
<h4 id="org16ae2b9"><span class="section-number-4">3.4.2</span> <code>zd-new-file-and-link</code> inserts generated id</h4>
<div class="outline-text-4" id="text-3-4-2">
<p>
Generate an id, append a name, and generate a new file based on id and link.
</p>

<p>
Either provide a name as argument, or enter one in the mini-buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-new-file-and-link</span> <span style="color: #6c3163;">(</span>str<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Inserts generated id with `</span><span style="color: #4e3163;">zd-id-format</span><span style="color: #2aa1ae;">' appended with STR.</span>
<span style="color: #2aa1ae;">Creates new deft file with id and STR as name."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span> <span style="color: #2d9574;">(</span>list <span style="color: #67b11d;">(</span>read-string <span style="color: #2d9574;">"name: "</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>insert <span style="color: #2d9574;">"&#167;"</span> <span style="color: #2d9574;">(</span>zd-generate-id<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">" "</span> str<span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>zd-new-file str<span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org853a9f3" class="outline-3">
<h3 id="org853a9f3"><span class="section-number-3">3.5</span> Functions with <code>avy</code></h3>
<div class="outline-text-3" id="text-3-5">
</div>
<div id="outline-container-org98859df" class="outline-4">
<h4 id="org98859df"><span class="section-number-4">3.5.1</span> <code>zd-avy-tag-search</code></h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
Use avy to jump to a tag and search for it.
</p>

<p>
The search term should include the <code>#</code> as tag identifier, so it's as easy as jumping to the <code>#</code> and running <code>zd-search-at-point</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-avy-tag-search</span> <span style="color: #6c3163;">()</span>
<span style="color: #2aa1ae;">"Call on avy to jump and search tags indicated with #."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">save-excursion</span>
  <span style="color: #2d9574;">(</span>avy-goto-char ?#<span style="color: #2d9574;">)</span>
  <span style="color: #2d9574;">(</span>zd-search-at-point<span style="color: #2d9574;">)</span>
<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5070419" class="outline-4">
<h4 id="org5070419"><span class="section-number-4">3.5.2</span> <code>zd-avy-link-search</code></h4>
<div class="outline-text-4" id="text-3-5-2">
<p>
Use avy to jump to an id and search for it.
</p>

<p>
Jumps to the <code>§</code> identifier and searches for the thing at point &#x2013; excluding the <code>§</code> character.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-avy-link-search</span> <span style="color: #6c3163;">()</span>
<span style="color: #2aa1ae;">"Call on avy to jump and search link ids indicated with &#167;.</span>
<span style="color: #2aa1ae;">Opens immediately if there is only one result."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">save-excursion</span>
  <span style="color: #2d9574;">(</span>avy-goto-char ?&#167;<span style="color: #2d9574;">)</span>
  <span style="color: #2d9574;">(</span>zd-search-global <span style="color: #67b11d;">(</span>zd-id-sanitized <span style="color: #b1951d;">(</span>zd-get-thing-at-point<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org68de9b4" class="outline-4">
<h4 id="org68de9b4"><span class="section-number-4">3.5.3</span> <code>zd-avy-file-search</code></h4>
<div class="outline-text-4" id="text-3-5-3">
<p>
Use avy to jump to an id and find the corresponding file.
There should be only one result, as the id should be unique.
</p>

<p>
Jump to a <code>§</code> with <code>avy</code>, get the thing at point.
If it is non-nil, search it after sanitizing.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-avy-file-search</span> <span style="color: #6c3163;">()</span>
<span style="color: #2aa1ae;">"Call on avy to jump to link ids indicated with &#167; and use it to search for filenames."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">save-excursion</span>
  <span style="color: #2d9574;">(</span>avy-goto-char ?&#167;<span style="color: #2d9574;">)</span>
  <span style="color: #2d9574;">(</span>zd-search-filename <span style="color: #67b11d;">(</span>zd-id-sanitized <span style="color: #b1951d;">(</span>zd-get-thing-at-point<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org82dc15c" class="outline-3">
<h3 id="org82dc15c"><span class="section-number-3">3.6</span> Utility functions</h3>
<div class="outline-text-3" id="text-3-6">
</div>
<div id="outline-container-org0947835" class="outline-4">
<h4 id="org0947835"><span class="section-number-4">3.6.1</span> Deft new search</h4>
<div class="outline-text-4" id="text-3-6-1">
<p>
The following function launches deft, clears the filter and enters <code>evil-insert-state</code> (when evil is used).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-deft-new-search</span> <span style="color: #6c3163;">()</span>
<span style="color: #2aa1ae;">"Launch deft, clear filter and enter insert state."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>deft<span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>deft-filter-clear<span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">when</span> <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">featurep</span> '<span style="color: #4e3163;">evil</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span>evil-insert-state<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f45370" class="outline-4">
<h4 id="org9f45370"><span class="section-number-4">3.6.2</span> <code>zd-file-rename</code> renames visited file</h4>
<div class="outline-text-4" id="text-3-6-2">
<p>
Rename the current file.
Based on the function <code>deft-rename-file</code> with only minor changes in the way <code>old-filename</code> is set: from current buffer rather than from <code>deft</code> search buffer.
</p>

<p>
Probably requires some more testing.
Anyway, best to use this only when visiting a file in the deft directory.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-file-rename</span> <span style="color: #6c3163;">()</span>
<span style="color: #2aa1ae;">"Rename the current file via the deft function. Use this on files in the deft-directory."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>old-filename <span style="color: #b1951d;">(</span>buffer-file-name<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
        <span style="color: #67b11d;">(</span>deft-dir <span style="color: #b1951d;">(</span>file-name-as-directory deft-directory<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
        new-filename old-name new-name<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">when</span> old-filename
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">setq</span> old-name <span style="color: #b1951d;">(</span>deft-base-filename old-filename<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">setq</span> new-name <span style="color: #b1951d;">(</span>read-string
                      <span style="color: #3a81c3;">(</span>concat <span style="color: #2d9574;">"Rename "</span> old-name <span style="color: #2d9574;">" to (without extension): "</span><span style="color: #3a81c3;">)</span>
                      old-name<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">setq</span> new-filename
            <span style="color: #b1951d;">(</span>concat deft-dir new-name <span style="color: #2d9574;">"."</span> deft-default-extension<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>rename-file old-filename new-filename<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>deft-update-visiting-buffers old-filename new-filename<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>deft-refresh<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0394a95" class="outline-4">
<h4 id="org0394a95"><span class="section-number-4">3.6.3</span> <code>zd-insert-org-title</code> inserts file title in org-mode</h4>
<div class="outline-text-4" id="text-3-6-3">
<p>
Easily insert the title of the current file in <code>org-mode</code> syntax, i.e. as a <code>#+title:</code> line.
</p>

<p>
The code gets the base of the buffer file name, takes from it the file title (i.e. strips the link id at the beginning), and inserts the remaining string.
</p>

<p>
Below the title, an additional template string is inserted automatically.
This string, variable <code>zd-string-below-title</code>, can be customized and is empty by default.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-insert-org-title</span> <span style="color: #6c3163;">()</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>insert
   <span style="color: #2d9574;">"#+title: "</span>
   <span style="color: #2d9574;">(</span>zd-lift-file-title <span style="color: #67b11d;">(</span>file-name-base <span style="color: #b1951d;">(</span>buffer-file-name<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">"\n"</span>
   zd-string-below-title
   <span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Customize the string to be inserted below the title.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defcustom</span> <span style="color: #715ab1;">zd-string-below-title</span> <span style="color: #2d9574;">""</span>
  <span style="color: #2aa1ae;">"String inserted below title when `</span><span style="color: #4e3163;">zd-insert-org-title</span><span style="color: #2aa1ae;">' is called. Empty by default."</span>
  <span style="color: #3a81c3;">:type</span> 'string
  <span style="color: #3a81c3;">:group</span> 'zetteldeft
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org75595b9" class="outline-2">
<h2 id="org75595b9"><span class="section-number-2">4</span> Compiling a single <code>org</code> from <code>tags</code></h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org619a534" class="outline-3">
<h3 id="org619a534"><span class="section-number-3">4.1</span> Idea: including notes with given tag</h3>
<div class="outline-text-3" id="text-4-1">
<p>
The following functions generate <code>org</code> code to include files with a specific <code>#tag</code> (or search word in general).
</p>

<p>
For each of the notes with the <code>#tag</code>, it inserts a heading, a line with <code>#+INCLUDE</code> and the full path to the relevant notes.
This results in a single file that can be easily exported.
</p>

<p>
The only function meant for use on the users end, is <code>zd-org-include-tag</code>.
</p>

<p>
For example,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span>zd-org-include-tagged-files <span style="color: #2d9574;">"#export"</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
inserts necessary code to include all files containing the tag <code>#export</code>.
The results could look like the following:
</p>

<div class="org-src-container">
<pre class="src src-org">\* First file title
<span style="color: #da8b55;">#+INCLUDE: "/path/to/2018-07-13-2210 First file title.org"</span>

\* File two
<span style="color: #da8b55;">#+INCLUDE: "/path/to/2018-07-13-2223 File two.org"</span>
</pre>
</div>

<p>
All functions are documented below.
</p>
</div>
</div>

<div id="outline-container-orgf1048d6" class="outline-3">
<h3 id="orgf1048d6"><span class="section-number-3">4.2</span> Issues &amp; things to note</h3>
<div class="outline-text-3" id="text-4-2">
<p>
But first, a note on limitations of the current implementation.
</p>
</div>

<div id="outline-container-orgc7b1690" class="outline-4">
<h4 id="orgc7b1690"><span class="section-number-4">4.2.1</span> Over-enthousiastic inclusion</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
Sometimes, a tag appears in a file without the need for it to be included.
For example, a file with a list of all tags will also include the tag one wants.
</p>

<p>
In the future, this might be resolved by filtering, for example with <a href="http://ergoemacs.org/emacs/elisp_filter_list.html">http://ergoemacs.org/emacs/elisp_filter_list.html</a>.
</p>
</div>
</div>

<div id="outline-container-org3127658" class="outline-4">
<h4 id="org3127658"><span class="section-number-4">4.2.2</span> Inclusion from second line onwards</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
Currently, the <code>#+INCLUDE</code> lines only include from the second line onwards.
</p>

<p>
This is a work-around to prevent <code>#+TITLE</code> lines from being included (and messing up the title on <code>org-export</code>.
</p>

<p>
To change this, edit the inserted strings in the <code>zd-org-include-file</code> function.
</p>
</div>
</div>

<div id="outline-container-org0cd5f28" class="outline-4">
<h4 id="org0cd5f28"><span class="section-number-4">4.2.3</span> Sorting</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
The files included are unsorted, or rather: sorted as <code>deft</code> provides the results.
</p>

<p>
Attempts at sorting by title are included in <code>zd-get-file-list</code>, but not working properly.
</p>

<p>
As a solution, use <code>org-sort</code> manually after running <code>zd-org-include-tag</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-orga9c964c" class="outline-3">
<h3 id="orga9c964c"><span class="section-number-3">4.3</span> <code>zd-org-include-tag</code> generates <code>#+INCLUDE</code> code</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Asks user for a <code>#tag</code> name and inserts headers and <code>#+INCLUDE</code> code for all files with said tag.
Can be used on general search item as well.
When used on <code>#tag</code>, make sure to include the <code>#</code> manually.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-org-include-tag</span> <span style="color: #6c3163;">(</span>zdTag<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Inserts at point org-mode code to include all files with the selected tag. Include the # manually in the prompt."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span> <span style="color: #2d9574;">(</span>list <span style="color: #67b11d;">(</span>read-string <span style="color: #2d9574;">"tag (include the #): "</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>zd-org-include-tagged-files zdTag<span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ae1970" class="outline-3">
<h3 id="org0ae1970"><span class="section-number-3">4.4</span> <code>zd-org-include-tagged-files</code> includes files with tag</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Inserts <code>org-mode</code> code at point to include the notes with a specific search item.
</p>

<p>
The code first gets a list of files that contain the search item, and inserts the necessary code for each file in that list.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-org-include-tagged-files</span> <span style="color: #6c3163;">(</span>srch<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Inserts files with contain SRCH."</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">dolist</span> <span style="color: #2d9574;">(</span>zdFile <span style="color: #67b11d;">(</span>zd-get-file-list srch<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
  <span style="color: #2d9574;">(</span>zd-org-include-file zdFile<span style="color: #2d9574;">)</span>
 <span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6da3f1" class="outline-3">
<h3 id="orga6da3f1"><span class="section-number-3">4.5</span> <code>zd-get-file-list</code> returns file list on search</h3>
<div class="outline-text-3" id="text-4-5">
<p>
Get a list of the files with given search string.
</p>

<p>
List should be sorted by title of file, i.e. by link id with newest on top.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-get-file-list</span> <span style="color: #6c3163;">(</span>srch<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Returns a list of files with the search item SRCH."</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>deft-current-sort-method 'title<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>deft-filter srch t<span style="color: #2d9574;">)</span>
   deft-current-files
<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd4442b9" class="outline-3">
<h3 id="orgd4442b9"><span class="section-number-3">4.6</span> <code>zd-lift-file-title</code> returns file title from path</h3>
<div class="outline-text-3" id="text-4-6">
<p>
Returns only the file title from a file, removing path, extension, and link ID.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-lift-file-title</span> <span style="color: #6c3163;">(</span>zdFile<span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>baseName <span style="color: #b1951d;">(</span>file-name-base zdFile<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>replace-regexp-in-string
    <span style="color: #2d9574;">"[0-9]\\{2,\\}-[0-9-]+[[:space:]]"</span>
    <span style="color: #2d9574;">""</span> baseName<span style="color: #2d9574;">)</span>
<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org795c58e" class="outline-3">
<h3 id="org795c58e"><span class="section-number-3">4.7</span> <code>zd-org-include-file</code> includes a file in <code>org</code> format</h3>
<div class="outline-text-3" id="text-4-7">
<p>
Inserts the title as a new header, with the <code>#+INCLUDE</code> line below.
Includes only from the second line onward, so that any <code>#+TITLE</code> lines are omitted.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">zd-org-include-file</span> <span style="color: #6c3163;">(</span>zdFile<span style="color: #6c3163;">)</span>
<span style="color: #2aa1ae;">"Insert code to include org-file zdFile."</span>
 <span style="color: #6c3163;">(</span>insert
   <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Insert org-mode title</span>
   <span style="color: #2d9574;">"\n* "</span> <span style="color: #2d9574;">(</span>zd-lift-file-title zdFile<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">"\n"</span>
   <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Insert #+INCLUDE: "file.org" :lines 2-</span>
   <span style="color: #2d9574;">"#+INCLUDE: \""</span> zdFile <span style="color: #2d9574;">"\" :lines \"2-\"\n"</span>
 <span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org37e1090" class="outline-2">
<h2 id="org37e1090"><span class="section-number-2">5</span> Aesthetics</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org5fe3548" class="outline-3">
<h3 id="org5fe3548"><span class="section-number-3">5.1</span> Highlighting zetteldeft links</h3>
<div class="outline-text-3" id="text-5-1">
<p>
To highlight zetteldeft links, let's add a <code>font-lock</code> keyword to <code>org-mode</code>.
</p>

<p>
Currently, the regexp to find links is hardcoded.
</p>

<p>
Highlighting not working in comments.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span>font-lock-add-keywords 'org-mode '<span style="color: #6c3163;">(</span>
  <span style="color: #2d9574;">(</span><span style="color: #2d9574;">"&#167;[0-9]\\{2,\\}-[0-9-]+"</span> . font-lock-warning-face<span style="color: #2d9574;">)</span>
  <span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1e30df5" class="outline-2">
<h2 id="org1e30df5"><span class="section-number-2">6</span> Keybindings</h2>
<div class="outline-text-2" id="text-6">
<p>
Note: This setup is for <code>spacemacs</code>.
</p>
</div>

<div id="outline-container-org0530a25" class="outline-3">
<h3 id="org0530a25"><span class="section-number-3">6.1</span> Additional <code>deft</code> keybindings</h3>
<div class="outline-text-3" id="text-6-1">
<p>
Deft specific keybindings behind the <code>,</code> prefix.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">with-eval-after-load</span> 'deft
  <span style="color: #6c3163;">(</span>define-key spacemacs-deft-mode-map-prefix
    <span style="color: #2d9574;">"o"</span> 'efls/deft-open<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>define-key spacemacs-deft-mode-map-prefix
    <span style="color: #2d9574;">[</span>?\t<span style="color: #2d9574;">]</span> 'efls/deft-open-preview<span style="color: #6c3163;">)</span>
 <span style="color: #3a81c3;">)</span>
</pre>
</div>


<p>
A small function to open a file in the other window and shifting focus to it.
That final part is what the <code>t</code> argument does.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">efls/deft-open-other</span> <span style="color: #6c3163;">()</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>deft-open-file-other-window t<span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Let's add another function, to simply preview in the other window, i.e. not switch focus to it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defun</span> <span style="color: #6c3163; font-weight: bold;">efls/deft-open-preview</span> <span style="color: #6c3163;">()</span>
 <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">interactive</span><span style="color: #6c3163;">)</span>
 <span style="color: #6c3163;">(</span>deft-open-file-other-window<span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>


<p>
To select results from the item list without leaving the <code>insert</code> state, I add the following keys.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">with-eval-after-load</span> 'deft
  <span style="color: #6c3163;">(</span>define-key deft-mode-map
    <span style="color: #2d9574;">(</span>kbd <span style="color: #2d9574;">"&lt;tab&gt;"</span><span style="color: #2d9574;">)</span> 'efls/deft-open-preview<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>define-key deft-mode-map
    <span style="color: #2d9574;">(</span>kbd <span style="color: #2d9574;">"&lt;s-return&gt;"</span><span style="color: #2d9574;">)</span> 'efls/deft-open-other<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>define-key deft-mode-map
    <span style="color: #2d9574;">(</span>kbd <span style="color: #2d9574;">"s-j"</span><span style="color: #2d9574;">)</span> 'evil-next-line<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>define-key deft-mode-map
    <span style="color: #2d9574;">(</span>kbd <span style="color: #2d9574;">"s-k"</span><span style="color: #2d9574;">)</span> 'evil-previous-line<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>define-key deft-mode-map
    <span style="color: #2d9574;">(</span>kbd <span style="color: #2d9574;">"s-i"</span><span style="color: #2d9574;">)</span> 'efls/deft-open-other<span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orge583da4" class="outline-3">
<h3 id="orge583da4"><span class="section-number-3">6.2</span> Some <code>zetteldeft</code> specifics</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Can be called from any mode.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Prefix</span>
<span style="color: #3a81c3;">(</span>spacemacs/declare-prefix <span style="color: #2d9574;">"d"</span> <span style="color: #2d9574;">"deft"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Launch deft</span>
<span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"dd"</span> 'deft<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"dD"</span> 'zd-deft-new-search<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">SEARCH</span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Search thing at point</span>
   <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"ds"</span> 'zd-search-at-point<span style="color: #3a81c3;">)</span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Search current file id</span>
   <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"dc"</span> 'zd-search-current-id<span style="color: #3a81c3;">)</span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Jump &amp; search with avy </span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">search link as filename</span>
    <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"df"</span> 'zd-avy-file-search<span style="color: #3a81c3;">)</span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">search link as contents</span>
    <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"dl"</span> 'zd-avy-link-search<span style="color: #3a81c3;">)</span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">search tag as contents</span>
    <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"dt"</span> 'zd-avy-tag-search<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">LINKS</span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Insert link from filename</span>
   <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"di"</span> 'zd-find-file-id-insert<span style="color: #3a81c3;">)</span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Insert link with full filename</span>
   <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"dI"</span> 'zd-find-file-full-title-insert<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">FILES</span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Open file</span>
   <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"do"</span> 'zd-find-file<span style="color: #3a81c3;">)</span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Create new file</span>
   <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"dn"</span> 'zd-new-file<span style="color: #3a81c3;">)</span>
   <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"dN"</span> 'zd-new-file-and-link<span style="color: #3a81c3;">)</span>
 <span style="color: #2aa1ae; background-color: #ecf3ec;">; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Rename file</span>
   <span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"dr"</span> 'zd-file-rename<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">UTILITIES</span>
<span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"dR"</span> 'deft-refresh<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgcb9b495" class="outline-2">
<h2 id="orgcb9b495"><span class="section-number-2">7</span> Brainstorm</h2>
<div class="outline-text-2" id="text-7">
<p>
Some ideas for the future.
</p>
</div>

<div id="outline-container-org871a970" class="outline-3">
<h3 id="org871a970"><span class="section-number-3">7.1</span> Saved searches</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Create a list of saved searches, somewhere easily accessible.
</p>
</div>
</div>

<div id="outline-container-orgbcdd033" class="outline-3">
<h3 id="orgbcdd033"><span class="section-number-3">7.2</span> Generate list of tags</h3>
<div class="outline-text-3" id="text-7-2">
<p>
Auto-generate a list of tags.
</p>

<p>
Might exceed my elisp-fu.
</p>
</div>
</div>

<div id="outline-container-org205db88" class="outline-3">
<h3 id="org205db88"><span class="section-number-3">7.3</span> HTML export</h3>
<div class="outline-text-3" id="text-7-3">
<p>
Export HTML pages with clickeable links between notes.
</p>
</div>
</div>

<div id="outline-container-orgde99e4e" class="outline-3">
<h3 id="orgde99e4e"><span class="section-number-3">7.4</span> Markdown export</h3>
<div class="outline-text-3" id="text-7-4">
<p>
Export markdown through <code>pandoc</code>.
</p>
</div>
</div>

<div id="outline-container-org51ad6ab" class="outline-3">
<h3 id="org51ad6ab"><span class="section-number-3">7.5</span> Templates</h3>
<div class="outline-text-3" id="text-7-5">
<p>
A system for note templates.
</p>
</div>
</div>

<div id="outline-container-org2a177e0" class="outline-3">
<h3 id="org2a177e0"><span class="section-number-3">7.6</span> Minor mode</h3>
<div class="outline-text-3" id="text-7-6">
<p>
Create a minor mode on top of org-mode with some niceties:
</p>
<ul class="org-ul">
<li>higlight links &amp; tags</li>
<li>clickeable links</li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
For those not yet familiar: <b>deft</b> is a note manager within <code>emacs</code>, for easily searching and retreiving plain text notes.
It is inspired by the popular Notational Velocity.
Check out <a href="https://jblevins.org/projects/deft/">jblevins.org/projects/deft/</a> and <a href="http://notational.net">notational.net</a>.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: EFLS</p>
<p class="date">Created: 2018-07-17 Tue 20:28</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
