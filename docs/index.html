<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-11-14 Wed 23:10 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Zetteldeft</title>
<meta name="generator" content="Org mode">
<meta name="author" content="EFLS">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel='stylesheet' href='style.css' type='text/css'/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">Zetteldeft</h1>
</header>
<p>
This document contains all the source code to a set of functions for <code>emacs</code> which aim to extend the <code>deft</code> package and turn it into a (very very) basic Zettelkasten note-taking system.
</p>

<p>
Check out the github <a href="https://github.com/EFLS/zetteldeft">repository</a> to get the source.
Read on for an introduction and some documentation.
</p>

<p>
Latest additions:
</p>
<ul class="org-ul">
<li><b>13 Nov</b>: functions to create <code>graphviz</code> added.</li>
<li><b>4 Nov</b>: <code>zd-all-tags</code> and <code>zd-tag-buffer</code> find all tags</li>
<li><b>24 Oct</b>: <code>zd-avy-file-search-other-window</code> follows an ID link and opens file in other window</li>
<li><b>21 Oct</b>: <code>zetteldeft</code> is now a package.</li>
<li><b>10 Oct</b>: Insert contents of files with given search term with <code>zd-org-search-insert</code>.</li>
<li><b>24 Sep</b>: Count the total number of words in your zetteldeft with <code>zd-count-words</code>.</li>
<li><b>18 July</b>: Include a list of links with <code>zd-insert-list-links</code>, or a list of files with <code>zd-org-search-include</code>.</li>
</ul>

<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0f30bc8">1. What?</a>
<ul>
<li><a href="#org353bd60">1.1. A Zettelkasten system for <code>emacs</code> based on <code>deft</code></a></li>
<li><a href="#orge856cac">1.2. How to use this source</a></li>
<li><a href="#org334ab98">1.3. Basic concepts</a></li>
<li><a href="#orgb860f45">1.4. Basic actions</a></li>
<li><a href="#org5a195c9">1.5. An overview</a></li>
</ul>
</li>
<li><a href="#orgd98fd84">2. The <code>zetteldeft</code> package</a>
<ul>
<li><a href="#orga8dcb25">2.1. Package preparation</a></li>
<li><a href="#org9175cfa">2.2. Basic <code>zetteldeft</code> functions</a></li>
<li><a href="#orgea4eccf">2.3. Listing all tags</a></li>
<li><a href="#orgf46f2fb">2.4. Gathering notes</a></li>
<li><a href="#orge5e772f">2.5. Creating visuals</a></li>
<li><a href="#org43feb05">2.6. Aesthetics</a></li>
<li><a href="#orgc144599">2.7. End of package</a></li>
</ul>
</li>
<li><a href="#org4cbf40d">3. Suggested setup</a>
<ul>
<li><a href="#org94436da">3.1. Suggested <code>zeteldeft</code> keybindings</a></li>
<li><a href="#orgee8e305">3.2. Suggested <code>deft</code> setup</a></li>
</ul>
</li>
<li><a href="#org4b8c9fb">4. Brainstorm</a>
<ul>
<li><a href="#orgec5f9d7">4.1. Saved searches</a></li>
<li><a href="#orgcd9bc7a">4.2. Generate list of tags</a></li>
<li><a href="#orgc787107">4.3. HTML export</a></li>
<li><a href="#orgde80bb7">4.4. Markdown export</a></li>
<li><a href="#org97003a1">4.5. Templates</a></li>
<li><a href="#org80d020b">4.6. Minor mode</a></li>
</ul>
</li>
</ul>
</div>
</nav>

<div id="outline-container-org0f30bc8" class="outline-2">
<h2 id="org0f30bc8"><span class="section-number-2">1</span> What?</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org353bd60" class="outline-3">
<h3 id="org353bd60"><span class="section-number-3">1.1</span> A Zettelkasten system for <code>emacs</code> based on <code>deft</code></h3>
<div class="outline-text-3" id="text-1-1">
<p>
This is my feeble attempt at recreating a Zettelkasten environment by extending the excellent <code>deft</code> package in <code>emacs</code>.<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>
I call it <b>zetteldeft</b>.
</p>

<p>
It is inspired by the <i>The Archive</i> app. For this and more on the Zettelkasten way of taking notes, see <a href="https://zettelkasten.de">zettelkasten.de</a>. They have a forum for discussion on both software and the specifics of the Zettelkasten philosophy.
</p>

<p>
The code that follows is created and maintained for my personal use, shared here in hope that it can benefit others as well.
I&rsquo;d be happy to learn how you use it and expand upon it.
</p>

<p>
It is very much WIP and I&rsquo;m fairly new to <code>elisp</code>, so it might contain some stupid code.
</p>

<p>
Anyway, here we go.
</p>
</div>
</div>

<div id="outline-container-orge856cac" class="outline-3">
<h3 id="orge856cac"><span class="section-number-3">1.2</span> How to use this source</h3>
<div class="outline-text-3" id="text-1-2">
<p>
This package requires:
</p>
<ul class="org-ul">
<li><code>deft</code>, obviously</li>
<li><code>avy</code> to jump &amp; search</li>
</ul>

<p>
From the github repository, either
</p>
<ul class="org-ul">
<li>download the <code>org-file</code> and <code>org-tangle</code> it yourself. It should contain everything.</li>
<li>or download the <code>zetteldeft.el</code> file.</li>
</ul>

<p>
Whichever way you go, load up the package by adding the package to your load path and requiring:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'load-path <span style="color: #98be65;">"~/path/to/folder/"</span>))
(<span style="color: #51afef;">require</span> '<span style="color: #a9a1e1;">zetteldeft</span>)
</pre>
</div>

<p>
Or, if you use <code>use-package</code>, do something like:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">use-package</span> <span style="color: #a9a1e1;">zetteldeft</span>
  <span style="color: #c678dd;">:load-path</span> <span style="color: #98be65;">"~/git/zetteldeft/"</span>
  <span style="color: #c678dd;">:after</span> deft)
</pre>
</div>

<p>
and you&rsquo;re good to go!
Well, not quite. First you must read on about the basics of <code>zetteldeft</code>.
</p>
</div>
</div>

<div id="outline-container-org334ab98" class="outline-3">
<h3 id="org334ab98"><span class="section-number-3">1.3</span> Basic concepts</h3>
<div class="outline-text-3" id="text-1-3">
<p>
<b>Notes</b> reside in the <code>deft-directory</code>.
Notes are written in <code>org-mode</code> syntax (although most functions should work in <code>markdown</code> as well).
</p>

<p>
The filename of a note starts with a unique <b>id</b> based on the time and the date, for example: <code>2018-07-09-2115 This is a note.org</code>.
</p>

<p>
This unique id can be used to <b>link</b> notes together.
A link is indicated by a <code>§</code> character, followed by the id.
For example: <code>§2018-07-09-2115</code> should link to the file above.
A link can appear anywhere in the text.
</p>

<p>
When searching <code>deft</code> with the <b>id</b> as a filter, you&rsquo;ll find both the original note (with the id in its name) and all the notes that link to this note (with the id in its body). Do so with <code>zd-search-current-id</code> and <code>zd-avy-link-search</code> respectively
</p>

<p>
Notes can contain <b>tags</b> in plain text: words prepended with a <code>#</code>.
This is a tag: <code>#tag</code>.
Tags make it easy to retrieve notes. They can appear anywhere in the note, but I&rsquo;d suggest putting them somewhere at the top.
</p>
</div>
</div>

<div id="outline-container-orgb860f45" class="outline-3">
<h3 id="orgb860f45"><span class="section-number-3">1.4</span> Basic actions</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Create a note with <code>zd-new-file</code> and provide a name.
</p>

<p>
Insert links to other notes: use <code>zd-find-file-id-insert</code> and select a file from the list.
With <code>zd-find-file-full-title-insert</code>, you guessed it, the note&rsquo;s title is included as well.
To branch out from a current note and link to a new one, use <code>zd-new-file-and-link</code>.
</p>

<p>
To search for a tag or anything else under cursor, use <code>zd-search-at-point</code>.
Combined with the power of <code>avy</code> to jump to any character on screen, use these to jump and search in one go: <code>zd-avy-link-search</code> and <code>zd-avy-tag-search</code>.
</p>

<p>
To open the note behind a link, use <code>zd-avy-file-search</code>.
</p>
</div>
</div>

<div id="outline-container-org5a195c9" class="outline-3">
<h3 id="org5a195c9"><span class="section-number-3">1.5</span> An overview</h3>
<div class="outline-text-3" id="text-1-5">
<p>
While there are more functions, these should be enough to get you started.
Default keybindings are suggested at the bottom of this document.
Here is an overview.
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">Use</th>
<th scope="col" class="org-left">Keybinding</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>zd-new-file</code></td>
<td class="org-left">Create new note and open</td>
<td class="org-left"><code>SPC d n</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-new-file-and-link</code></td>
<td class="org-left">Create new note and insert <code>§</code> id</td>
<td class="org-left"><code>SPC d N</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-find-file-id-insert</code></td>
<td class="org-left">Pick a note and insert its <code>§</code> id</td>
<td class="org-left"><code>SPC d i</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-search-at-point</code></td>
<td class="org-left">Search for thing at point</td>
<td class="org-left"><code>SPC d s</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-file-search</code></td>
<td class="org-left">Select <code>§</code> id and open linked file</td>
<td class="org-left"><code>SPC d f</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-link-search</code></td>
<td class="org-left">Select <code>§</code> id and search for it</td>
<td class="org-left"><code>SPC d l</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-avy-tag-search</code></td>
<td class="org-left">Select <code>#</code> tag and search for it</td>
<td class="org-left"><code>SPC d t</code></td>
</tr>

<tr>
<td class="org-left"><code>zd-search-current-id</code></td>
<td class="org-left">Search for id of current file</td>
<td class="org-left"><code>SPC d c</code></td>
</tr>
</tbody>
</table>

<p>
More details documented below.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd98fd84" class="outline-2">
<h2 id="orgd98fd84"><span class="section-number-2">2</span> The <code>zetteldeft</code> package</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orga8dcb25" class="outline-3">
<h3 id="orga8dcb25"><span class="section-number-3">2.1</span> Package preparation</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The required preamble and some other initial settings.
To know how this package works, please skip right past this to the next section.
</p>
</div>

<div id="outline-container-org1480a9a" class="outline-4">
<h4 id="org1480a9a"><span class="section-number-4">2.1.1</span> Preamble</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
Some declaration.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">zetteldeft.el --- a simple package                     -*- lexical-binding: t; -*-</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Copyright (C) 2018  EFLS</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Author: EFLS &lt;email&gt;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Keywords: deft zettelkasten zetteldeft</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Version: 0.0.1</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">the Free Software Foundation, either version 3 of the License, or</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">(at your option) any later version.</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">GNU General Public License for more details.</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">You should have received a copy of the GNU General Public License</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">along with this program.  If not, see <a href="http://www.gnu.org/licenses/">&lt;http://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Commentary:</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Zetteldeft: turn deft into a zettelkasten writing system to create linked notes.</span>

<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">Code:</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge41bb54" class="outline-4">
<h4 id="orge41bb54"><span class="section-number-4">2.1.2</span> Requirements</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
<code>deft</code> is required, obviously, and <code>avy</code> is needed for some utility functions.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">require</span> '<span style="color: #a9a1e1;">deft</span>)

(<span style="color: #51afef;">unless</span> (package-installed-p 'avy)
  (<span style="color: #ECBE7B;">user-error</span> 'zetteldeft <span style="color: #98be65;">"Avy not installed, required for zd-avy-* functions."</span>))
(<span style="color: #51afef;">require</span> '<span style="color: #a9a1e1;">avy</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9ac32c" class="outline-4">
<h4 id="orgf9ac32c"><span class="section-number-4">2.1.3</span> Customization</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
For easy but minor customization options.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defgroup</span> <span style="color: #ECBE7B;">zetteldeft</span> nil
  <span style="color: #83898d;">"A zettelkasten on top of deft."</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9175cfa" class="outline-3">
<h3 id="org9175cfa"><span class="section-number-3">2.2</span> Basic <code>zetteldeft</code> functions</h3>
<div class="outline-text-3" id="text-2-2">
<p>
In this section:
</p>
<div id="text-table-of-contents">
<ul>
<li><a href="#org599efaa">2.2.1. Search functions</a>
<ul>
<li><a href="#org452e330">2.2.1.1. <code>zd-get-thing-at-point</code> returns string</a></li>
<li><a href="#orgb15fa03">2.2.1.2. <code>zd-search-at-point</code> thing at point</a></li>
<li><a href="#orgf80123c">2.2.1.3. <code>zd-search-global</code> for string</a></li>
<li><a href="#orgfc5a94d">2.2.1.4. <code>zd-search-filename</code> for string</a></li>
<li><a href="#org7cde587">2.2.1.5. <code>zd-search-current-id</code> searches current id</a></li>
<li><a href="#org94b5ec2">2.2.1.6. <code>zd-get-file-list</code> returns file list with search term</a></li>
</ul>
</li>
<li><a href="#orge37a527">2.2.2. IDs</a>
<ul>
<li><a href="#org15d0cef">2.2.2.1. <code>zd-id-format</code> for generating ID strings</a></li>
<li><a href="#orgd2e0f27">2.2.2.2. <code>zd-id-regex</code> for finding IDs</a></li>
<li><a href="#org25160be">2.2.2.3. <code>zd-lift-id</code> filters the ID from a string</a></li>
</ul>
</li>
<li><a href="#org0cdc85d">2.2.3. Finding &amp; linking files from minibuffer</a>
<ul>
<li><a href="#org3c63957">2.2.3.1. <code>zd-find-file</code> opens file from minibuffer</a></li>
<li><a href="#orga2a50be">2.2.3.2. <code>zd-find-file-id-insert</code> inserts file id</a></li>
<li><a href="#orgdf1d6cd">2.2.3.3. <code>zd-find-file-full-title-insert</code> inserts id and title</a></li>
</ul>
</li>
<li><a href="#orgedf3fa3">2.2.4. New file creation</a>
<ul>
<li><a href="#org1b08f1c">2.2.4.1. <code>zd-new-file</code> creates new file</a></li>
<li><a href="#org347ff4c">2.2.4.2. <code>zd-new-file-and-link</code> inserts generated id</a></li>
</ul>
</li>
<li><a href="#org75b4a6e">2.2.5. Moving around with <code>avy</code></a>
<ul>
<li><a href="#org1850a1d">2.2.5.1. <code>zd-avy-tag-search</code></a></li>
<li><a href="#org064c897">2.2.5.2. <code>zd-avy-link-search</code></a></li>
<li><a href="#org5a01681">2.2.5.3. <code>zd-avy-file-search</code></a></li>
</ul>
</li>
<li><a href="#orgd23c500">2.2.6. Utility functions</a>
<ul>
<li><a href="#org4699cae">2.2.6.1. Deft new search</a></li>
<li><a href="#orgdbe8b61">2.2.6.2. <code>zd--check</code> checks if file is part of zetteldeft</a></li>
<li><a href="#org42c4626">2.2.6.3. <code>zd-file-rename</code> renames visited file</a></li>
<li><a href="#org26e8752">2.2.6.4. <code>zd-lift-file-title</code> returns file title from path</a></li>
<li><a href="#org16c4aad">2.2.6.5. <code>zd-insert-org-title</code> inserts file title in org-mode</a></li>
<li><a href="#org447e089">2.2.6.6. <code>zd-count-words</code> counts total number of words</a></li>
<li><a href="#org69c43f1">2.2.6.7. <code>zd-copy-id-current-file</code> copies id in filename</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org599efaa" class="outline-4">
<h4 id="org599efaa"><span class="section-number-4">2.2.1</span> Search functions</h4>
<div class="outline-text-4" id="text-2-2-1">
</div>
<div id="outline-container-org452e330" class="outline-5">
<h5 id="org452e330"><span class="section-number-5">2.2.1.1</span> <code>zd-get-thing-at-point</code> returns string</h5>
<div class="outline-text-5" id="text-2-2-1-1">
<p>
Returns the thing at point as string.
</p>

<p>
Tries to get, in the following order:
</p>
<ul class="org-ul">
<li>links between <code>[[</code></li>
<li>hashtags: <code>§</code>, <code>#</code> or <code>@</code></li>
<li>words</li>
</ul>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft&rsquo;s <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-get-thing-at-point</span> ()
  <span style="color: #83898d;">"Return the thing at point, which can be a link, tag or word."</span>
  (<span style="color: #51afef;">require</span> '<span style="color: #a9a1e1;">thingatpt</span>)
  (<span style="color: #51afef;">let*</span> ((link-re <span style="color: #98be65;">"\\[\\[</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[</span><span style="color: #51afef; font-weight: bold;">^</span><span style="color: #98be65;">]]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\\]\\]"</span>)
         (htag-re <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">[&#167;#@][[:alnum:]_-]+</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span>))
   (<span style="color: #51afef;">cond</span>
    ((thing-at-point-looking-at link-re)
      (match-string-no-properties 1))
     ((thing-at-point-looking-at htag-re)
      (match-string-no-properties 1))
     (t (thing-at-point 'word t)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb15fa03" class="outline-5">
<h5 id="orgb15fa03"><span class="section-number-5">2.2.1.2</span> <code>zd-search-at-point</code> thing at point</h5>
<div class="outline-text-5" id="text-2-2-1-2">
<p>
Search the thing at point.
Note that calling <code>zd-search-at-point</code> on a <code>§</code> link includes <code>§</code> in the filter string.
</p>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft&rsquo;s <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-search-at-point</span> ()
  <span style="color: #83898d;">"Search deft with thing-at-point as filter.</span>
<span style="color: #83898d;">Thing can be a double-bracketed link, a hashtag, or a word."</span>
  (<span style="color: #51afef;">interactive</span>)
  (<span style="color: #51afef;">let</span> ((string (zd-get-thing-at-point)))
   (<span style="color: #51afef;">if</span> string
       (zd-search-global string t)
     (<span style="color: #ECBE7B;">user-error</span> <span style="color: #98be65;">"No search term at point"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf80123c" class="outline-5">
<h5 id="orgf80123c"><span class="section-number-5">2.2.1.3</span> <code>zd-search-global</code> for string</h5>
<div class="outline-text-5" id="text-2-2-1-3">
<p>
Search with deft for given string.
If there is only one result, that file is opened, unless additional argument is true.
</p>

<p>
Based on snippet suggested by <code>saf-dmitry</code> on deft&rsquo;s <a href="https://github.com/jrblevin/deft/issues/52#issuecomment-401766828">Github</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-search-global</span> (str <span style="color: #ECBE7B;">&amp;optional</span> dntOpn)
  <span style="color: #83898d;">"Search deft with STR as filter.</span>
<span style="color: #83898d;">If there is only one result, open that file (unless DNTOPN is true)."</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Sanitize the filter string</span>
  (<span style="color: #51afef;">setq</span> str (replace-regexp-in-string <span style="color: #98be65;">"[[:space:]\n]+"</span> <span style="color: #98be65;">" "</span> str))
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Call deft search on the filter string</span>
  (<span style="color: #51afef;">let</span> ((deft-incremental-search t))
   (deft)
   (deft-filter str t))
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">If there is a single match, open the file</span>
  (<span style="color: #51afef;">unless</span> dntOpn
   (<span style="color: #51afef;">when</span> (eq (length deft-current-files) 1)
     (deft-open-file (car deft-current-files)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc5a94d" class="outline-5">
<h5 id="orgfc5a94d"><span class="section-number-5">2.2.1.4</span> <code>zd-search-filename</code> for string</h5>
<div class="outline-text-5" id="text-2-2-1-4">
<p>
Deft search on filename.
If there is only one result, open that file.
</p>

<p>
Incremental search is turned off, and the filter is set to filenames only.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-search-filename</span> (thisStr <span style="color: #ECBE7B;">&amp;optional</span> otherWindow)
  <span style="color: #83898d;">"Search for deft files with string THISSTR in filename.</span>
<span style="color: #83898d;">Open if there is only one result (in another window if otherWindow is non-nill)."</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Sanitize the filter string</span>
  (<span style="color: #51afef;">setq</span> thisStr (replace-regexp-in-string <span style="color: #98be65;">"[[:space:]\n]+"</span> <span style="color: #98be65;">" "</span> thisStr))
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Call deft search on the filter string</span>
  (<span style="color: #51afef;">let</span> ((deft-filter-only-filenames t))
   (deft-filter thisStr t))
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">If there is a single match, open the file</span>
  (<span style="color: #51afef;">when</span> (eq (length deft-current-files) 1)
    (deft-open-file (car deft-current-files) otherWindow)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cde587" class="outline-5">
<h5 id="org7cde587"><span class="section-number-5">2.2.1.5</span> <code>zd-search-current-id</code> searches current id</h5>
<div class="outline-text-5" id="text-2-2-1-5">
<p>
Deft search on the id of the current file.
</p>

<p>
This function is useful to easily see which notes link to the current file.
</p>

<p>
Result is not opened automaticaly.
</p>

<p>
Steps:
</p>
<ol class="org-ol">
<li>Get the filename from the current buffer.</li>
<li>Lift the ID from it.</li>
<li>Search with resulting string.</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-search-current-id</span> ()
  <span style="color: #83898d;">"Search deft with the id of the current file as filter.</span>
<span style="color: #83898d;">Open if there is only one result."</span>
  (<span style="color: #51afef;">interactive</span>)
  (zd--check)
  (zd-search-global (zd-lift-id (file-name-base (buffer-file-name))) t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org94b5ec2" class="outline-5">
<h5 id="org94b5ec2"><span class="section-number-5">2.2.1.6</span> <code>zd-get-file-list</code> returns file list with search term</h5>
<div class="outline-text-5" id="text-2-2-1-6">
<p>
Get a list of the files with given search string.
</p>

<p>
To <b>fix</b>: sorting of results.
</p>

<p>
The code searches for the given string and returns <code>deft-current-files</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-get-file-list</span> (srch)
  <span style="color: #83898d;">"Returns a list of files with the search item SRCH."</span>
  (<span style="color: #51afef;">let</span> ((deft-current-sort-method 'title))
    (deft-filter srch t)
    deft-current-files))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge37a527" class="outline-4">
<h4 id="orge37a527"><span class="section-number-4">2.2.2</span> IDs</h4>
<div class="outline-text-4" id="text-2-2-2">
</div>
<div id="outline-container-org15d0cef" class="outline-5">
<h5 id="org15d0cef"><span class="section-number-5">2.2.2.1</span> <code>zd-id-format</code> for generating ID strings</h5>
<div class="outline-text-5" id="text-2-2-2-1">
<p>
String format when generating ids.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">zd-id-format</span> <span style="color: #98be65;">"%Y-%m-%d-%H%M"</span>
  <span style="color: #83898d;">"Format used when generating zetteldeft IDs.</span>
<span style="color: #83898d;">Be warned: the regexp to find these IDs is set separately."</span>
  <span style="color: #c678dd;">:type</span> 'string
  <span style="color: #c678dd;">:group</span> 'zetteldeft)
</pre>
</div>

<p>
While we&rsquo;re at it, lets tell deft to create new files with this new format.
For good measure: I advise creating new notes in the <code>zetteldeft</code> system with <code>zd-new-file</code> or <code>zd-new-file-and-link</code> as defined below.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">setq</span> deft-new-file-format zd-id-format)
</pre>
</div>

<p>
Here is the function to generate an ID string in said format.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-generate-id</span> ()
  <span style="color: #83898d;">"Generates an id in `</span><span style="color: #a9a1e1;">zd-id-format</span><span style="color: #83898d;">'."</span>
  (format-time-string zd-id-format))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2e0f27" class="outline-5">
<h5 id="orgd2e0f27"><span class="section-number-5">2.2.2.2</span> <code>zd-id-regex</code> for finding IDs</h5>
<div class="outline-text-5" id="text-2-2-2-2">
<p>
The regular expression used to search for zetteldeft IDs.
</p>

<p>
This dictates that a zetteldeft ID should consist of:
</p>
<ol class="org-ol">
<li>a series of exactly 4 numbers</li>
<li>followed by exactly 3 sets of a dash and two or more numbers</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">zd-id-regex</span> <span style="color: #98be65;">"[0-9]\\{4\\}</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">-[0-9]\\{2,\\}</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">\\{3\\}"</span>
  <span style="color: #83898d;">"The regex used to search for zetteldeft IDs."</span>
  <span style="color: #c678dd;">:type</span> 'string
  <span style="color: #c678dd;">:group</span> 'zetteldeft)
</pre>
</div>
</div>
</div>

<div id="outline-container-org25160be" class="outline-5">
<h5 id="org25160be"><span class="section-number-5">2.2.2.3</span> <code>zd-lift-id</code> filters the ID from a string</h5>
<div class="outline-text-5" id="text-2-2-2-3">
<p>
Return the zetteldeft ID from any string.
</p>

<p>
Searches with a temporary buffer, from the end of the string backwards (hence the <code>-1</code> argument), which implies that the last zetteldeft string is returned.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-lift-id</span> (str)
  <span style="color: #83898d;">"Extract the zetteldeft ID from STR with the regular expression stored in `</span><span style="color: #a9a1e1;">zd-id-regex</span><span style="color: #83898d;">'."</span>
  (<span style="color: #51afef;">with-temp-buffer</span>
    (insert str)
    (<span style="color: #51afef;">when</span> (re-search-forward zd-id-regex nil t -1)
      (match-string 0))))
</pre>
</div>

<p>
Or are there better ways than working <code>with-temp-buffer</code>?
</p>

<p>
Here is a little test.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(zd-lift-id <span style="color: #98be65;">"2018-11-09-1934-12 Some text (1989) - testing (2000 p. 12-25)"</span>)
</pre>
</div>

<pre class="example">
2018-11-09-1934

</pre>
</div>
</div>
</div>

<div id="outline-container-org0cdc85d" class="outline-4">
<h4 id="org0cdc85d"><span class="section-number-4">2.2.3</span> Finding &amp; linking files from minibuffer</h4>
<div class="outline-text-4" id="text-2-2-3">
</div>
<div id="outline-container-org3c63957" class="outline-5">
<h5 id="org3c63957"><span class="section-number-5">2.2.3.1</span> <code>zd-find-file</code> opens file from minibuffer</h5>
<div class="outline-text-5" id="text-2-2-3-1">
<p>
Select file from the deft folder from the minibuffer.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-find-file</span> (file)
  <span style="color: #83898d;">"Open deft file FILE."</span>
  (<span style="color: #51afef;">interactive</span>
    (list (completing-read <span style="color: #98be65;">"Deft find file: "</span>
           (deft-find-all-files-no-prefix))))
  (deft-find-file file))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga2a50be" class="outline-5">
<h5 id="orga2a50be"><span class="section-number-5">2.2.3.2</span> <code>zd-find-file-id-insert</code> inserts file id</h5>
<div class="outline-text-5" id="text-2-2-3-2">
<p>
Select file from minibuffer and insert its link, prepended by <code>§</code>.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-find-file-id-insert</span> (file)
  <span style="color: #83898d;">"Find deft file FILE and insert its link id, prepended by &#167;."</span>
  (<span style="color: #51afef;">interactive</span> (list
    (completing-read <span style="color: #98be65;">"File to insert id from: "</span>
      (deft-find-all-files-no-prefix))))
  (insert (concat <span style="color: #98be65;">"&#167;"</span> (zd-lift-id file))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf1d6cd" class="outline-5">
<h5 id="orgdf1d6cd"><span class="section-number-5">2.2.3.3</span> <code>zd-find-file-full-title-insert</code> inserts id and title</h5>
<div class="outline-text-5" id="text-2-2-3-3">
<p>
Select file from minibuffer and insert its link, prepended by <code>§</code>.
</p>

<p>
Based on <code>deft-find-file</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-find-file-full-title-insert</span> (file)
  <span style="color: #83898d;">"Find deft file FILE and insert its link id with title, prepended by &#167;."</span>
  (<span style="color: #51afef;">interactive</span> (list
    (completing-read <span style="color: #98be65;">"File to insert full title from: "</span>
      (deft-find-all-files-no-prefix))))
  (insert (concat <span style="color: #98be65;">"&#167;"</span> (file-name-base file))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgedf3fa3" class="outline-4">
<h4 id="orgedf3fa3"><span class="section-number-4">2.2.4</span> New file creation</h4>
<div class="outline-text-4" id="text-2-2-4">
</div>
<div id="outline-container-org1b08f1c" class="outline-5">
<h5 id="org1b08f1c"><span class="section-number-5">2.2.4.1</span> <code>zd-new-file</code> creates new file</h5>
<div class="outline-text-5" id="text-2-2-4-1">
<p>
Create new file with filename as <code>zd-id-format</code> and a string.
</p>

<p>
Either provide a name as argument, or enter one in the mini-buffer.
A title is automatically added to the file, unless an additioanl parameter is given.
When <code>evil</code> is used, enter the insert state as well.
The full name is added to the kill ring.
Note that the file is only actually created upon save.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-new-file</span> (str <span style="color: #ECBE7B;">&amp;optional</span> empty)
  <span style="color: #83898d;">"Create a new deft file. Filename is `</span><span style="color: #a9a1e1;">zd-id-format</span><span style="color: #83898d;">' appended by STR. No extension needed.</span>

<span style="color: #83898d;">After creating, the title is inserted in org-mode format (unless EMPTY is true) and the full file name is added to the kill ring."</span>
  (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"name: "</span>)))
  (<span style="color: #51afef;">let*</span> ((zdId (zd-generate-id))
         (zdName (concat zdId <span style="color: #98be65;">" "</span> str)))
  (deft-new-file-named zdName)
  (kill-new zdName)
  (<span style="color: #51afef;">unless</span> empty (zd-insert-org-title))
  (<span style="color: #51afef;">when</span> (<span style="color: #51afef;">featurep</span> '<span style="color: #a9a1e1;">evil</span>) (evil-insert-state))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org347ff4c" class="outline-5">
<h5 id="org347ff4c"><span class="section-number-5">2.2.4.2</span> <code>zd-new-file-and-link</code> inserts generated id</h5>
<div class="outline-text-5" id="text-2-2-4-2">
<p>
Generate an id, append a name, and generate a new file based on id and link.
</p>

<p>
Either provide a name as argument, or enter one in the mini-buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-new-file-and-link</span> (str)
  <span style="color: #83898d;">"Inserts generated id with `</span><span style="color: #a9a1e1;">zd-id-format</span><span style="color: #83898d;">' appended with STR.</span>
<span style="color: #83898d;">Creates new deft file with id and STR as name."</span>
  (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"name: "</span>)))
  (insert <span style="color: #98be65;">"&#167;"</span> (zd-generate-id) <span style="color: #98be65;">" "</span> str)
  (zd-new-file str))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org75b4a6e" class="outline-4">
<h4 id="org75b4a6e"><span class="section-number-4">2.2.5</span> Moving around with <code>avy</code></h4>
<div class="outline-text-4" id="text-2-2-5">
</div>
<div id="outline-container-org1850a1d" class="outline-5">
<h5 id="org1850a1d"><span class="section-number-5">2.2.5.1</span> <code>zd-avy-tag-search</code></h5>
<div class="outline-text-5" id="text-2-2-5-1">
<p>
Use avy to jump to a tag and search for it.
</p>

<p>
The search term should include the <code>#</code> as tag identifier, so it&rsquo;s as easy as jumping to the <code>#</code> and running <code>zd-search-at-point</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-avy-tag-search</span> ()
  <span style="color: #83898d;">"Call on avy to jump and search tags indicated with #."</span>
  (<span style="color: #51afef;">interactive</span>)
  (<span style="color: #51afef;">save-excursion</span>
   (avy-goto-char ?#)
   (zd-search-at-point)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org064c897" class="outline-5">
<h5 id="org064c897"><span class="section-number-5">2.2.5.2</span> <code>zd-avy-link-search</code></h5>
<div class="outline-text-5" id="text-2-2-5-2">
<p>
Use avy to jump to an id and search for it.
</p>

<p>
Jumps to the <code>§</code> identifier and searches for the thing at point &#x2013; excluding the <code>§</code> character.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-avy-link-search</span> ()
  <span style="color: #83898d;">"Call on avy to jump and search link ids indicated with &#167;.</span>
<span style="color: #83898d;">Opens immediately if there is only one result."</span>
  (<span style="color: #51afef;">interactive</span>)
  (<span style="color: #51afef;">save-excursion</span>
    (avy-goto-char ?&#167;)
    (zd-search-global (zd-lift-id (zd-get-thing-at-point)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a01681" class="outline-5">
<h5 id="org5a01681"><span class="section-number-5">2.2.5.3</span> <code>zd-avy-file-search</code></h5>
<div class="outline-text-5" id="text-2-2-5-3">
<p>
Select and follow an ID link to a file.
</p>

<p>
Use avy to jump to an id and find the corresponding file.
There should be only one result, as the id should be unique.
That file is then opend (in another window if requested).
</p>

<p>
Jump to a <code>§</code> with <code>avy</code>, get the thing at point.
If it is non-nil, search it after sanitizing.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-avy-file-search</span> (<span style="color: #ECBE7B;">&amp;optional</span> otherWindow)
 <span style="color: #83898d;">"Call on avy to jump to link ids indicated with &#167; and use it to search for filenames.</span>
<span style="color: #83898d;">Open that file (when it is the only search result, and in another window if OTHERWINDOW)."</span>
  (<span style="color: #51afef;">interactive</span>)
  (<span style="color: #51afef;">save-excursion</span>
    (avy-goto-char ?&#167;)
    (zd-search-filename (zd-lift-id (zd-get-thing-at-point)) otherWindow)))
</pre>
</div>

<p>
For easier access, let&rsquo;s define a function to open in the other window.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-avy-file-search-other-window</span> ()
  <span style="color: #83898d;">"Call on avy to jump to link ids indicated with &#167; and use it to search for filenames.</span>
<span style="color: #83898d;">Open that file in other window (when it is the only search result)."</span>
  (<span style="color: #51afef;">interactive</span>)
  (zd-avy-file-search t))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd23c500" class="outline-4">
<h4 id="orgd23c500"><span class="section-number-4">2.2.6</span> Utility functions</h4>
<div class="outline-text-4" id="text-2-2-6">
</div>
<div id="outline-container-org4699cae" class="outline-5">
<h5 id="org4699cae"><span class="section-number-5">2.2.6.1</span> Deft new search</h5>
<div class="outline-text-5" id="text-2-2-6-1">
<p>
The following function launches deft, clears the filter and enters <code>evil-insert-state</code> (when evil is used).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-deft-new-search</span> ()
  <span style="color: #83898d;">"Launch deft, clear filter and enter insert state."</span>
  (<span style="color: #51afef;">interactive</span>)
  (deft)
  (deft-filter-clear)
  (<span style="color: #51afef;">when</span> (<span style="color: #51afef;">featurep</span> '<span style="color: #a9a1e1;">evil</span>) (evil-insert-state)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdbe8b61" class="outline-5">
<h5 id="orgdbe8b61"><span class="section-number-5">2.2.6.2</span> <code>zd--check</code> checks if file is part of zetteldeft</h5>
<div class="outline-text-5" id="text-2-2-6-2">
<p>
A quick but necessary check to see whether the provided file is part of the deft directory.
</p>

<p>
To achieve this, take the directory of the current buffer file name and expand it to its absolute path.
Then check whether the <code>deft-directory</code> is part of that absolute path.
Signal a user error if it is not.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd--check</span> ()
  <span style="color: #83898d;">"Checks if the currently visited file is in `</span><span style="color: #a9a1e1;">zetteldeft</span><span style="color: #83898d;">' territory: whether it has `</span><span style="color: #a9a1e1;">deft-directory</span><span style="color: #83898d;">' somewhere in its path."</span>
  (<span style="color: #51afef;">unless</span> (string-match-p
            (regexp-quote deft-directory)
            (file-name-directory (buffer-file-name)))
    (<span style="color: #ECBE7B;">user-error</span> <span style="color: #98be65;">"Not in zetteldeft territory."</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org42c4626" class="outline-5">
<h5 id="org42c4626"><span class="section-number-5">2.2.6.3</span> <code>zd-file-rename</code> renames visited file</h5>
<div class="outline-text-5" id="text-2-2-6-3">
<p>
Rename the current file.
Based on the function <code>deft-rename-file</code> with only minor changes in the way <code>old-filename</code> is set: from current buffer rather than from <code>deft</code> search buffer.
</p>

<p>
Probably requires some more testing.
Anyway, best to use this only when visiting a file in the deft directory.
</p>

<p>
The function also updates the <code>#+title:</code> at the top of the buffer, if any is present.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-file-rename</span> ()
  <span style="color: #83898d;">"Rename the current file via the deft function. Use this on files in the deft-directory."</span>
  (<span style="color: #51afef;">interactive</span>)
  (zd--check)
    (<span style="color: #51afef;">let</span> ((old-filename (buffer-file-name))
          (deft-dir (file-name-as-directory deft-directory))
          new-filename old-name new-name)
      (<span style="color: #51afef;">when</span> old-filename
        (<span style="color: #51afef;">setq</span> old-name (deft-base-filename old-filename))
        (<span style="color: #51afef;">setq</span> new-name (read-string
                        (concat <span style="color: #98be65;">"Rename "</span> old-name <span style="color: #98be65;">" to (without extension): "</span>)
                        old-name))
        (<span style="color: #51afef;">setq</span> new-filename
              (concat deft-dir new-name <span style="color: #98be65;">"."</span> deft-default-extension))
        (rename-file old-filename new-filename)
        (deft-update-visiting-buffers old-filename new-filename)
        (zd-update-title-in-file)
        (deft-refresh))))
</pre>
</div>

<p>
To update the title of the currently visited file, the following function is used.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-update-title-in-file</span> ()
  <span style="color: #83898d;">"Update the #+TITLE in the current file, if present."</span>
  (<span style="color: #51afef;">save-excursion</span>
    (<span style="color: #51afef;">let</span> ((zd-string-after-title <span style="color: #98be65;">""</span>))
      (goto-char (point-min))
      (<span style="color: #51afef;">when</span> (search-forward <span style="color: #98be65;">"#+title:"</span> nil t)
        (delete-region (line-beginning-position) (line-end-position))
        (zd-insert-org-title)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org26e8752" class="outline-5">
<h5 id="org26e8752"><span class="section-number-5">2.2.6.4</span> <code>zd-lift-file-title</code> returns file title from path</h5>
<div class="outline-text-5" id="text-2-2-6-4">
<p>
Returns only the file title from a file, removing path, extension, and link ID.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-lift-file-title</span> (zdFile)
  <span style="color: #83898d;">"Returns the title of a zetteldeft note.</span>
<span style="color: #83898d;">ZDFILE should be a full path to a note."</span>
  (<span style="color: #51afef;">let</span> ((baseName (file-name-base zdFile)))
    (replace-regexp-in-string
     <span style="color: #98be65;">"[0-9]\\{2,\\}-[0-9-]+[[:space:]]"</span>
     <span style="color: #98be65;">""</span> baseName)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org16c4aad" class="outline-5">
<h5 id="org16c4aad"><span class="section-number-5">2.2.6.5</span> <code>zd-insert-org-title</code> inserts file title in org-mode</h5>
<div class="outline-text-5" id="text-2-2-6-5">
<p>
Easily insert the title of the current file in <code>org-mode</code> syntax, i.e. as a <code>#+title:</code> line.
</p>

<p>
The code gets the base of the buffer file name, takes from it the file title (i.e. strips the link id at the beginning), and inserts the remaining string.
</p>

<p>
Below the title, an additional template string is inserted automatically.
This string, variable <code>zd-string-after-title</code>, can be customized and is empty by default.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-insert-org-title</span> ()
  <span style="color: #83898d;">"Insert filename of current file as org syntax."</span>
  (<span style="color: #51afef;">interactive</span>)
  (zd--check)
  (insert
    <span style="color: #98be65;">"#+title: "</span>
    (zd-lift-file-title (file-name-base (buffer-file-name)))
    zd-string-after-title))
</pre>
</div>

<p>
Customize the string to be inserted below the title.
Used when generating a new file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">zd-string-after-title</span> <span style="color: #98be65;">""</span>
  <span style="color: #83898d;">"String inserted below title when `</span><span style="color: #a9a1e1;">zd-insert-org-title</span><span style="color: #83898d;">' is called.</span>
<span style="color: #83898d;">Empty by default.</span>
<span style="color: #83898d;">Don't forget to add `</span><span style="color: #a9a1e1;">\\n</span><span style="color: #83898d;">' at the beginning to start a new line."</span>
  <span style="color: #c678dd;">:type</span> 'string
  <span style="color: #c678dd;">:group</span> 'zetteldeft)
</pre>
</div>
</div>
</div>

<div id="outline-container-org447e089" class="outline-5">
<h5 id="org447e089"><span class="section-number-5">2.2.6.6</span> <code>zd-count-words</code> counts total number of words</h5>
<div class="outline-text-5" id="text-2-2-6-6">
<p>
To count the total number of words, lets loop over all the files and count words in each.
The total is printed in the minibuffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-count-words</span> ()
  <span style="color: #83898d;">"Prints total number of words and notes in the minibuffer."</span>
  (<span style="color: #51afef;">interactive</span>)
  (<span style="color: #51afef;">let</span> ((numWords 0))
    (<span style="color: #51afef;">dolist</span> (deftFile deft-all-files)
      (<span style="color: #51afef;">with-temp-buffer</span>
        (insert-file-contents deftFile)
        (<span style="color: #51afef;">setq</span> numWords (+ numWords (count-words (point-min) (point-max))))))
    (message <span style="color: #98be65;">"Your zettelkasten contains %s notes with %s words in total."</span> (length deft-all-files) numWords)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org69c43f1" class="outline-5">
<h5 id="org69c43f1"><span class="section-number-5">2.2.6.7</span> <code>zd-copy-id-current-file</code> copies id in filename</h5>
<div class="outline-text-5" id="text-2-2-6-7">
<p>
Add the ID from the current file to the kill ring.
</p>

<p>
Steps:
</p>
<ol class="org-ol">
<li>Get the filename from the buffer</li>
<li>Strip the ID from it.</li>
<li>Result can be empty string when no id is detected in the filename.</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-copy-id-current-file</span> ()
  <span style="color: #83898d;">"Add the id from the filename the buffer is currently visiting to the kill ring."</span>
  (<span style="color: #51afef;">interactive</span>)
  (zd--check)
  (<span style="color: #51afef;">let</span> ((ID (concat <span style="color: #98be65;">"&#167;"</span> (zd-lift-id (file-name-base (buffer-file-name))))))
    (kill-new ID)
    (message <span style="color: #98be65;">"%s"</span> ID)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgea4eccf" class="outline-3">
<h3 id="orgea4eccf"><span class="section-number-3">2.3</span> Listing all tags</h3>
<div class="outline-text-3" id="text-2-3">
<p>
<code>zd-all-tags</code> puts all tags in <code>zd-tag-list</code> and returns them.
</p>

<p>
Use <code>zd-tag-buffer</code> to create a buffer with all tags.
</p>
</div>

<div id="outline-container-org802bd88" class="outline-4">
<h4 id="org802bd88"><span class="section-number-4">2.3.1</span> <code>zd-all-tags</code> returns them all</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
Extracting tags with <code>zd-extract-tags</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-all-tags</span> ()
  <span style="color: #83898d;">"Return a list of all the tags found in zetteldeft files."</span>
  (<span style="color: #51afef;">setq</span> zd-tag-list (list))
  (<span style="color: #51afef;">dolist</span> (deftFile deft-all-files)
    (zd-extract-tags deftFile))
  zd-tag-list)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb336463" class="outline-4">
<h4 id="orgb336463"><span class="section-number-4">2.3.2</span> <code>zd-tag-buffer</code> puts all tags in a buffer</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
The name of the buffer we&rsquo;ll be using:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">setq</span> zd-tag-buffer-name <span style="color: #98be65;">"*zd-tag-buffer*"</span>)
</pre>
</div>

<p>
And some code to create that buffer.
</p>

<p>
Move to the <code>zd-tag-buffer-name</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-tag-buffer</span> ()
  <span style="color: #83898d;">"Switch to the *zd-tag-buffer* and list tags."</span>
  (<span style="color: #51afef;">interactive</span>)
  (switch-to-buffer zd-tag-buffer-name)
  (erase-buffer)
  (<span style="color: #51afef;">dolist</span> (zdTag (zd-all-tags))
    (insert (format <span style="color: #98be65;">"%s \n"</span> zdTag)))
  (<span style="color: #51afef;">unless</span> (eq major-mode 'org-mode) (org-mode))
  (sort-lines nil (point-min) (point-max)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1af50ef" class="outline-4">
<h4 id="org1af50ef"><span class="section-number-4">2.3.3</span> Tag extracting functions</h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
Some utility functions to achieve all of this.
</p>
</div>

<div id="outline-container-org9773f74" class="outline-5">
<h5 id="org9773f74"><span class="section-number-5">2.3.3.1</span> <code>zd-tag-format</code> provides the tag-finding regex</h5>
<div class="outline-text-5" id="text-2-3-3-1">
<p>
The regular expression used to filter out tags.
Tags start with a <code>#</code> or <code>@</code> and contain least one or more letters.
Dashes are allowed.
</p>

<p>
Tags should be positioned either be at the beginning of a new line, or preceded by a space.
This should help filter out hashtags used in URLs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">zd-tag-format</span> <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">^</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">\s</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">[#@][a-z-]+"</span>
  <span style="color: #83898d;">"Regular expression used to filter out tags."</span>
  <span style="color: #c678dd;">:type</span> 'string
  <span style="color: #c678dd;">:group</span> 'zetteldeft)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga8425f5" class="outline-5">
<h5 id="orga8425f5"><span class="section-number-5">2.3.3.2</span> <code>zd-extract-tags</code> from a file</h5>
<div class="outline-text-5" id="text-2-3-3-2">
<p>
Open a given file in a temporary buffer.
Loop a search for the tag regexp.
When a tag is found, remove any whitespace from it and add it to the <code>zd-tag-list</code> if it isn&rsquo;t there already.
Delete the found tag and search again.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-extract-tags</span> (deftFile)
  <span style="color: #83898d;">"Find all tags in DEFTFILE and add them to zd-tag-list"</span>
  (<span style="color: #51afef;">with-temp-buffer</span>
    (insert-file-contents deftFile)
    (<span style="color: #51afef;">while</span> (re-search-forward zd-tag-format nil t)
      (<span style="color: #51afef;">let</span> ((foundTag (replace-regexp-in-string <span style="color: #98be65;">" "</span> <span style="color: #98be65;">""</span> (match-string 0))))
        <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Add found tag to zd-tag-list if it isn't there already</span>
        (<span style="color: #51afef;">unless</span> (member foundTag zd-tag-list)
          (<span style="color: #51afef;">push</span> foundTag zd-tag-list)))
      <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Remove found tag from buffer</span>
      (delete-region (point) (re-search-backward zd-tag-format)))))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf46f2fb" class="outline-3">
<h3 id="orgf46f2fb"><span class="section-number-3">2.4</span> Gathering notes</h3>
<div class="outline-text-3" id="text-2-4">
<p>
In this section:
</p>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgae56195">2.4.1. On &ldquo;gathering notes&rdquo;</a></li>
<li><a href="#org775bd80">2.4.2. List of links</a>
<ul>
<li><a href="#org8c848e8">2.4.2.1. <code>zd-insert-list-links</code> generates list with tagged files</a></li>
<li><a href="#org398292b">2.4.2.2. <code>zd-list-entry-file-link</code> includes a file link as list entry</a></li>
</ul>
</li>
<li><a href="#org18f0f1b">2.4.3. Compiling a single <code>org</code></a>
<ul>
<li><a href="#org67dfb9d">2.4.3.1. Idea and example</a></li>
<li><a href="#org5375282">2.4.3.2. <code>zd-org-search-include</code> generates <code>#+INCLUDE</code> syntax</a></li>
<li><a href="#org3cebde0">2.4.3.3. <code>zd-org-search-insert</code> generates titles &amp; file content</a></li>
</ul>
</li>
<li><a href="#org7486de1">2.4.4. Helper functions</a>
<ul>
<li><a href="#org26b7083">2.4.4.1. <code>zd-insert-file-contents</code> returns the contents of a file</a></li>
<li><a href="#org01fecd8">2.4.4.2. <code>zd-org-include-file</code> includes a file in <code>org</code> format</a></li>
<li><a href="#org19991bc">2.4.4.3. <code>zd-org-insert-file</code> inserts a files content</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgae56195" class="outline-4">
<h4 id="orgae56195"><span class="section-number-4">2.4.1</span> On &ldquo;gathering notes&rdquo;</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
Sometimes you want to easily gather all notes with a certain tag or search term.
Say you want to quickly generate a list of links to all files including the tag <code>#zetteldeft</code>.
</p>

<p>
The following functions do that for you.
There are three of them, each either taking a search term as argument or prompting for one:
</p>
<ol class="org-ol">
<li><code>zd-insert-list-links</code> inserts a simple list of notes which contain the search term, spelling out the full filename for each note (including ID).</li>
<li><code>zd-org-search-include</code> generates <code>org-mode</code> syntax to <code>#+INCLUDE</code> the files below a header with their title.</li>
<li><code>zd-org-search-insert</code> inserts the contents of all of these notes below their respective titles.</li>
</ol>

<p>
More documentation can be found below.
</p>
</div>
</div>

<div id="outline-container-org775bd80" class="outline-4">
<h4 id="org775bd80"><span class="section-number-4">2.4.2</span> List of links</h4>
<div class="outline-text-4" id="text-2-4-2">
</div>
<div id="outline-container-org8c848e8" class="outline-5">
<h5 id="org8c848e8"><span class="section-number-5">2.4.2.1</span> <code>zd-insert-list-links</code> generates list with tagged files</h5>
<div class="outline-text-5" id="text-2-4-2-1">
<p>
Creates and inserts a list with links to all files with selected search term.
</p>

<p>
The code gets a list of files that contain the search string, runs through said list and inserts a link for each entry.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-insert-list-links</span> (zdSrch)
  <span style="color: #83898d;">"Inserts at point a list of links to all deft files with a search string ZDSRCH.</span>
<span style="color: #83898d;">When searching for a tag, include # manually in the search."</span>
  (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"search string: "</span>)))
  (<span style="color: #51afef;">dolist</span> (zdFile (zd-get-file-list zdSrch))
    (zd-list-entry-file-link zdFile)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org398292b" class="outline-5">
<h5 id="org398292b"><span class="section-number-5">2.4.2.2</span> <code>zd-list-entry-file-link</code> includes a file link as list entry</h5>
<div class="outline-text-5" id="text-2-4-2-2">
<p>
Inserts for given file a link id and title as a list entry.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-list-entry-file-link</span> (zdFile)
  <span style="color: #83898d;">"Insert ZDFILE as list entry."</span>
  (insert <span style="color: #98be65;">" - "</span> (concat <span style="color: #98be65;">"&#167;"</span> (file-name-base zdFile)) <span style="color: #98be65;">"\n"</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org18f0f1b" class="outline-4">
<h4 id="org18f0f1b"><span class="section-number-4">2.4.3</span> Compiling a single <code>org</code></h4>
<div class="outline-text-4" id="text-2-4-3">
</div>
<div id="outline-container-org67dfb9d" class="outline-5">
<h5 id="org67dfb9d"><span class="section-number-5">2.4.3.1</span> Idea and example</h5>
<div class="outline-text-5" id="text-2-4-3-1">
</div>
<ol class="org-ol">
<li><a id="org302f3df"></a>Including notes with given search term<br>
<div class="outline-text-6" id="text-2-4-3-1-1">
<p>
The following explains what <code>zd-org-search-include</code> does, but the concept is more or less the same for <code>zd-org-search-insert</code>.
</p>

<p>
For each of the notes with the provided search term, it inserts a heading, a line with <code>#+INCLUDE</code> and the full path to the relevant notes.
This results in a single file that can be easily exported.
</p>

<p>
The only function meant for use on the users end, is <code>zd-org-search-include</code>.
</p>

<p>
For example,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(zd-org-search-include <span style="color: #98be65;">"#export"</span>)
</pre>
</div>

<p>
inserts necessary code to include all files containing the tag <code>#export</code>.
The results would look like the following:
</p>

<div class="org-src-container">
<pre class="src src-org">\* First file title
<span style="color: #83898d;">#+INCLUDE: "/path/to/2018-07-13-2210 First file title.org"</span>

\* File two
<span style="color: #83898d;">#+INCLUDE: "/path/to/2018-07-13-2223 File two.org"</span>
</pre>
</div>

<p>
All functions are documented below.
</p>
</div>
</li>

<li><a id="org96b31ed"></a>Semi-automated example<br>
<div class="outline-text-6" id="text-2-4-3-1-2">
<p>
You could, for example, add the following code to a document and execute (or evaluate) it from within <code>org-mode</code>.
Add it under a &ldquo;comment&rdquo; type heading to prevent it from being exported itself, like so: <code>* COMMENT Code</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">let</span> (frst)
  (<span style="color: #51afef;">save-excursion</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Move to next heading</span>
    (outline-next-heading)
    (<span style="color: #51afef;">setq</span> frst (point))
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Delete everything after</span>
    (delete-region frst (point-max))
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Include the files</span>
    (zd-org-search-include <span style="color: #98be65;">"#tag"</span>)
    <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Sort these entries alphabetically (set mark to use a region)</span>
<span style="color: #5B6268;">;   </span><span style="color: #5B6268;">(goto-char frst) (set-mark (point-max))</span>
<span style="color: #5B6268;">;   </span><span style="color: #5B6268;">(org-sort-entries nil ?a)</span>
  ))
</pre>
</div>

<p>
The code deletes everything after the current header and inserts all notes with <code>#tag</code> in them.
</p>

<p>
In order to also sort the entries alphabetically, uncomment the last two lines.
</p>

<p>
A final caveat: don&rsquo;t put the file with the above code in you <code>deft</code> folder, or it will attempt to include itself (since it has <code>#tag</code> in it).
</p>
</div>
</li>

<li><a id="org97b0502"></a>Issues &amp; things to note<br>
<div class="outline-text-6" id="text-2-4-3-1-3">
<p>
Before we look at the functions, a note on limitations of the current implementation.
</p>

<ol class="org-ol">
<li><b>Over-enthousiastic inclusion</b>
Sometimes, a tag appears in a file without the need for it to be included.
For example, a file with a list of all tags will also include the tag one wants.
In the future, this might be resolved by filtering, for example with <a href="http://ergoemacs.org/emacs/elisp_filter_list.html">http://ergoemacs.org/emacs/elisp_filter_list.html</a>.</li>

<li><b>Inclusion from second line onwards</b>
Currently, the <code>#+INCLUDE</code> lines only include from the second line onwards.
This is a work-around to prevent <code>#+TITLE</code> lines from being included (and messing up the title on <code>org-export</code>.
To change this, edit the inserted strings in the <code>zd-org-include-file</code> function.</li>

<li><b>Sorting</b>
The files included are unsorted, or rather: sorted as <code>deft</code> provides the results.
Attempts at sorting by title are included in <code>zd-get-file-list</code>, but not working properly.
As a solution, use <code>org-sort</code> manually after running <code>zd-org-search-include</code>.</li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-org5375282" class="outline-5">
<h5 id="org5375282"><span class="section-number-5">2.4.3.2</span> <code>zd-org-search-include</code> generates <code>#+INCLUDE</code> syntax</h5>
<div class="outline-text-5" id="text-2-4-3-2">
<p>
Asks user for a search string and inserts headers and <code>#+INCLUDE</code> code for all files with said tag.
When used on <code>#tag</code>, make sure to include the <code>#</code> manually.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-org-search-include</span> (zdSrch)
  <span style="color: #83898d;">"Inserts at point org-mode code to include all files with the selected tag. Include the # manually in the prompt."</span>
  (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"tag (include the #): "</span>)))
  (<span style="color: #51afef;">dolist</span> (zdFile (zd-get-file-list zdSrch))
    (zd-org-include-file zdFile)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3cebde0" class="outline-5">
<h5 id="org3cebde0"><span class="section-number-5">2.4.3.3</span> <code>zd-org-search-insert</code> generates titles &amp; file content</h5>
<div class="outline-text-5" id="text-2-4-3-3">
<p>
Very similar to the previous function, but rather than writing syntax to include files, insert their contents directly.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-org-search-insert</span> (zdSrch)
  <span style="color: #83898d;">"Inserts at point all the content of the files with ZDSRCH. When looking for zetteldeft tags, include the # manually in the search."</span>
  (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"Search term: "</span>)))
  (<span style="color: #51afef;">dolist</span> (zdFile (zd-get-file-list zdSrch))
    (zd-org-insert-file zdFile)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7486de1" class="outline-4">
<h4 id="org7486de1"><span class="section-number-4">2.4.4</span> Helper functions</h4>
<div class="outline-text-4" id="text-2-4-4">
</div>
<div id="outline-container-org26b7083" class="outline-5">
<h5 id="org26b7083"><span class="section-number-5">2.4.4.1</span> <code>zd-insert-file-contents</code> returns the contents of a file</h5>
<div class="outline-text-5" id="text-2-4-4-1">
<p>
Returns the contents of a file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-file-contents</span> (zdFile <span style="color: #ECBE7B;">&amp;optional</span> removeLines)
  <span style="color: #83898d;">"Inserts file contents of a zetteldeft note.</span>
<span style="color: #83898d;">ZDFILE should be a full path to a note.</span>

<span style="color: #83898d;">Optional: leave out first REMOVELINES lines."</span>
  (<span style="color: #51afef;">with-temp-buffer</span>
    (insert-file-contents zdFile)
    (<span style="color: #51afef;">when</span> removeLines
      (kill-whole-line removeLines))
    (buffer-string)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org01fecd8" class="outline-5">
<h5 id="org01fecd8"><span class="section-number-5">2.4.4.2</span> <code>zd-org-include-file</code> includes a file in <code>org</code> format</h5>
<div class="outline-text-5" id="text-2-4-4-2">
<p>
Inserts the title as a new header, with the <code>#+INCLUDE</code> line below.
Includes only from the second line onward, so that any <code>#+TITLE</code> lines are omitted.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-org-include-file</span> (zdFile)
  <span style="color: #83898d;">"Insert code to include org-file zdFile."</span>
  (insert
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Insert org-mode title</span>
    <span style="color: #98be65;">"* "</span> (zd-lift-file-title zdFile) <span style="color: #98be65;">"\n"</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Insert #+INCLUDE: "file.org" :lines 2-</span>
    <span style="color: #98be65;">"#+INCLUDE: \""</span> zdFile <span style="color: #98be65;">"\" :lines \"2-\"\n\n"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org19991bc" class="outline-5">
<h5 id="org19991bc"><span class="section-number-5">2.4.4.3</span> <code>zd-org-insert-file</code> inserts a files content</h5>
<div class="outline-text-5" id="text-2-4-4-3">
<p>
For a file, insert its title and contents (without first 3 lines).
</p>

<p>
Even better would be: without any of the lines starting with <code>#</code> at the beginning of the file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-org-insert-file</span> (zdFile)
  <span style="color: #83898d;">"Insert title and contents of ZDFILE."</span>
  (insert
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Insert org-mode title</span>
    <span style="color: #98be65;">"\n* "</span> (zd-lift-file-title zdFile) <span style="color: #98be65;">"\n\n"</span>
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Insert file contents (without the first 3 lines)</span>
    (zd-file-contents zdFile 3)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orge5e772f" class="outline-3">
<h3 id="orge5e772f"><span class="section-number-3">2.5</span> Creating visuals</h3>
<div class="outline-text-3" id="text-2-5">
<p>
In this section:
</p>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgab8592e">2.5.1. Introducing graphs</a></li>
<li><a href="#orgd93d444">2.5.2. Graph functions</a>
<ul>
<li><a href="#org79ad861">2.5.2.1. <code>zd-org-graph-search</code> creates graph from search string</a></li>
<li><a href="#orgb29d0a0">2.5.2.2. <code>zd-org-graph-note</code> creates graph from note</a></li>
</ul>
</li>
<li><a href="#org22a162a">2.5.3. Building blocks</a>
<ul>
<li><a href="#org8e22f13">2.5.3.1. <code>zd-graph-syntax-begin</code> provides opening syntax</a></li>
<li><a href="#org07c285f">2.5.3.2. <code>zd-graph-syntax-end</code> provides closing syntax</a></li>
<li><a href="#orgcdcf5a7">2.5.3.3. <code>zd-extract-links</code> pulls links from a file</a></li>
<li><a href="#orgde2493b">2.5.3.4. <code>zd-graph-insert-links</code> inserts graphviz links</a></li>
<li><a href="#org00fe949">2.5.3.5. <code>zd-graph-insert-title</code> inserts graphviz title line</a></li>
<li><a href="#orgc0a781f">2.5.3.6. <code>zd-graph-store-link</code> stores provided notes</a></li>
<li><a href="#org6a3aadb">2.5.3.7. <code>zd-graph-insert-additional-links</code> inserts stored links</a></li>
<li><a href="#orgb3be10e">2.5.3.8. <code>zd-graph-insert-all-titles</code> inserts all stored titles</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgab8592e" class="outline-4">
<h4 id="orgab8592e"><span class="section-number-4">2.5.1</span> Introducing graphs</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
Linking notes together in plain text is fun, but sometimes you want to visualize which notes are connected.
</p>

<p>
The following functions attempt to provide said functionallity, but are in a very early stage of development.
They generate an org source block for <code>graphviz</code>, which can then be executed to generate a pdf.
</p>

<p>
A brief introduction:
</p>
<ul class="org-ul">
<li><code>zd-org-graph-search</code> creates a graph with all the notes containing a provided string.</li>
<li><code>zd-org-graph-note</code> creates a graph that starts at a note, connects all notes linked to it, and all notes linked to those. In other words, it looks two levels deep.</li>
</ul>

<p>
It&rsquo;s worth noting, again, that this is very provisional.
</p>
</div>
</div>

<div id="outline-container-orgd93d444" class="outline-4">
<h4 id="orgd93d444"><span class="section-number-4">2.5.2</span> Graph functions</h4>
<div class="outline-text-4" id="text-2-5-2">
</div>
<div id="outline-container-org79ad861" class="outline-5">
<h5 id="org79ad861"><span class="section-number-5">2.5.2.1</span> <code>zd-org-graph-search</code> creates graph from search string</h5>
<div class="outline-text-5" id="text-2-5-2-1">
<p>
An org code block with <code>graphviz</code> code for a <code>graph.pdf</code>.
</p>

<p>
Find all notes with the provided search term.
Loop over this list, and insert title and links for each one.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-org-graph-search</span> (str)
  <span style="color: #83898d;">"Insert org source block for graph with zd search results. STR should be the search the resulting notes of which should be included in the graph."</span>
  (<span style="color: #51afef;">interactive</span> (list (read-string <span style="color: #98be65;">"search string: "</span>)))
  (<span style="color: #51afef;">setq</span> zd-graph--links (list))
  (<span style="color: #51afef;">let</span> ((zdList (zd-get-file-list str)))
    (insert zd-graph-syntax-begin)
    (insert <span style="color: #98be65;">"\n  // links\n"</span>)
    (<span style="color: #51afef;">dolist</span> (oneFile zdList)
      (insert <span style="color: #98be65;">"\n"</span>)
      (zd-graph-insert-links oneFile))
    (zd-graph-insert-all-titles))
  (insert zd-graph-syntax-end))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb29d0a0" class="outline-5">
<h5 id="orgb29d0a0"><span class="section-number-5">2.5.2.2</span> <code>zd-org-graph-note</code> creates graph from note</h5>
<div class="outline-text-5" id="text-2-5-2-2">
<p>
Insert an org source code block for a graphviz presentation of a note and its connections.
</p>

<p>
When links are added, they are also stored in <code>zd-graph--links</code> which is later used to insert titles.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-org-graph-note</span> (deftFile)
  <span style="color: #83898d;">"Create a graph starting from note DEFTFILE."</span>
  (<span style="color: #51afef;">interactive</span>)
  (<span style="color: #51afef;">setq</span> zd-graph--links (list))
  (insert zd-graph-syntax-begin)
  (insert <span style="color: #98be65;">"\n  // base note and links \n"</span>)
  (zd-graph-insert-links deftFile)
  (zd-graph-insert-additional-links)
  (zd-graph-insert-all-titles)
  (insert zd-graph-syntax-end))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org22a162a" class="outline-4">
<h4 id="org22a162a"><span class="section-number-4">2.5.3</span> Building blocks</h4>
<div class="outline-text-4" id="text-2-5-3">
</div>
<div id="outline-container-org8e22f13" class="outline-5">
<h5 id="org8e22f13"><span class="section-number-5">2.5.3.1</span> <code>zd-graph-syntax-begin</code> provides opening syntax</h5>
<div class="outline-text-5" id="text-2-5-3-1">
<p>
Within graphviz, I advise to use <code>fdp</code>, <code>twopi</code> (which overlaps more) or <code>circo</code> as layouts.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">zd-graph-syntax-begin</span>
  <span style="color: #98be65;">"#+BEGIN_SRC dot :file ./graph.pdf :cmdline -Kfdp -Tpdf</span>
<span style="color: #98be65;">  \n graph {\n"</span>
  <span style="color: #83898d;">"Syntax to be included at the start of the zetteldeft graph."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org07c285f" class="outline-5">
<h5 id="org07c285f"><span class="section-number-5">2.5.3.2</span> <code>zd-graph-syntax-end</code> provides closing syntax</h5>
<div class="outline-text-5" id="text-2-5-3-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defcustom</span> <span style="color: #dcaeea;">zd-graph-syntax-end</span>
  <span style="color: #98be65;">"} \n#+END_SRC\n"</span>
  <span style="color: #83898d;">"Syntax to be included at the end of the zetteldeft graph."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcdcf5a7" class="outline-5">
<h5 id="orgcdcf5a7"><span class="section-number-5">2.5.3.3</span> <code>zd-extract-links</code> pulls links from a file</h5>
<div class="outline-text-5" id="text-2-5-3-3">
<p>
Very similar to the <code>zd-extract-tags</code> function, but returns links instead of storing them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-extract-links</span> (deftFile)
  <span style="color: #83898d;">"Find all links in DEFTFILE and return a list."</span>
  (<span style="color: #51afef;">let</span> ((zdLinks (list)))
    (<span style="color: #51afef;">with-temp-buffer</span>
      (insert-file-contents deftFile)
      (<span style="color: #51afef;">while</span> (re-search-forward zd-id-regex nil t)
        (<span style="color: #51afef;">let</span> ((foundTag (replace-regexp-in-string <span style="color: #98be65;">" "</span> <span style="color: #98be65;">""</span> (match-string 0))))
          <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Add found tag to zdLinks if it isn't there already</span>
          (<span style="color: #51afef;">unless</span> (member foundTag zdLinks)
            (<span style="color: #51afef;">push</span> foundTag zdLinks)))
        <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Remove found tag from buffer</span>
        (delete-region (point) (re-search-backward zd-id-regex))))
   zdLinks))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde2493b" class="outline-5">
<h5 id="orgde2493b"><span class="section-number-5">2.5.3.4</span> <code>zd-graph-insert-links</code> inserts graphviz links</h5>
<div class="outline-text-5" id="text-2-5-3-4">
<p>
Insert the sanitized ID from the file, followed by an arrow and all of the links.
</p>

<p>
Store both the deft file provided and any found files in <code>zd-graph--links</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-graph-insert-links</span> (deftFile)
  <span style="color: #83898d;">"Inserts a file's links in a one line dot graph format.</span>
<span style="color: #83898d;">Any inserted ID is also stored in `</span><span style="color: #a9a1e1;">zd-graph--links</span><span style="color: #83898d;">'."</span>
  (insert <span style="color: #98be65;">"  \""</span>
          (zd-lift-id deftFile)
          <span style="color: #98be65;">"\" -- {"</span>)
  (<span style="color: #51afef;">dolist</span> (oneLink (zd-extract-links deftFile))
    (zd-graph-store-link oneLink t)
    (insert <span style="color: #98be65;">"\""</span> oneLink <span style="color: #98be65;">"\" "</span>))
  (insert <span style="color: #98be65;">"}\n"</span>)
  (zd-graph-store-link deftFile))
</pre>
</div>
</div>
</div>

<div id="outline-container-org00fe949" class="outline-5">
<h5 id="org00fe949"><span class="section-number-5">2.5.3.5</span> <code>zd-graph-insert-title</code> inserts graphviz title line</h5>
<div class="outline-text-5" id="text-2-5-3-5">
<p>
Titles have to be inserted in the correct <code>graphviz</code> format, like so:
</p>

<div class="org-src-container">
<pre class="src src-dot">B [label = <span style="color: #98be65;">"Node B"</span>]
</pre>
</div>

<p>
The following function should achieve that.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-graph-insert-title</span> (deftFile)
  <span style="color: #83898d;">"Inserts the DEFTFILE title definition in a one line dot graph format."</span>
  (<span style="color: #51afef;">let</span> ((zdTitle (zd-lift-file-title deftFile))
        (zdId    (zd-lift-id deftFile)))
    (insert <span style="color: #98be65;">"  \""</span> zdId <span style="color: #98be65;">"\""</span>
            <span style="color: #98be65;">" [label = \""</span> zdTitle <span style="color: #98be65;">" (&#167;"</span> zdId <span style="color: #98be65;">")\""</span>)
    (insert <span style="color: #98be65;">"]"</span> <span style="color: #98be65;">"\n"</span>))
  (zd-graph-store-link deftFile))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0a781f" class="outline-5">
<h5 id="orgc0a781f"><span class="section-number-5">2.5.3.6</span> <code>zd-graph-store-link</code> stores provided notes</h5>
<div class="outline-text-5" id="text-2-5-3-6">
<p>
For future reference, linked files are stored in <code>zd-graph--links</code>.
This function facilitates that process.
</p>

<p>
Provide a link to a file to store it.
Simply providing an ID works too, if you provide the second argument as true.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-graph-store-link</span> (deftFile <span style="color: #ECBE7B;">&amp;optional</span> idToFile)
  <span style="color: #83898d;">"Push DEFTFILE to zd-graph--links unless it's already there.</span>
<span style="color: #83898d;">When IDTOFILE is non-nil, DEFTFILE is considered an id and the the function first looks for the corresponding file."</span>
  (<span style="color: #51afef;">when</span> idToFile
    (<span style="color: #51afef;">let</span> ((deft-filter-only-filenames t))
      (<span style="color: #51afef;">progn</span>
        (deft-filter deftFile t)
        (<span style="color: #51afef;">setq</span> deftFile (car deft-current-files)))))
  (<span style="color: #51afef;">unless</span> (member deftFile zd-graph--links)
    (<span style="color: #51afef;">push</span> deftFile zd-graph--links)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a3aadb" class="outline-5">
<h5 id="org6a3aadb"><span class="section-number-5">2.5.3.7</span> <code>zd-graph-insert-additional-links</code> inserts stored links</h5>
<div class="outline-text-5" id="text-2-5-3-7">
<p>
Insert links stored in the <code>zd-graph--links</code> list.
Except the first list item, as this is considered the base file already included.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-graph-insert-additional-links</span> ()
  <span style="color: #83898d;">"Insert rest of `</span><span style="color: #a9a1e1;">zd-graph--links</span><span style="color: #83898d;">'."</span>
  (<span style="color: #51afef;">setq</span> zd-graph--links (cdr zd-graph--links))
  (<span style="color: #51afef;">dolist</span> (oneFile zd-graph--links)
    (zd-graph-insert-links oneFile)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3be10e" class="outline-5">
<h5 id="orgb3be10e"><span class="section-number-5">2.5.3.8</span> <code>zd-graph-insert-all-titles</code> inserts all stored titles</h5>
<div class="outline-text-5" id="text-2-5-3-8">
<p>
Insert all titles stored in <code>zd-graph--links</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">zd-graph-insert-all-titles</span> ()
  <span style="color: #83898d;">"Insert all graphviz title lines for all links stored in `</span><span style="color: #a9a1e1;">zd-graph--links</span><span style="color: #83898d;">'."</span>
  (insert <span style="color: #98be65;">"\n  // titles \n"</span>)
  (<span style="color: #51afef;">dolist</span> (oneLink zd-graph--links)
    <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Sometimes, a 'nil' list item is present. Ignore those.</span>
    (<span style="color: #51afef;">when</span> oneLink
      (zd-graph-insert-title oneLink))))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org43feb05" class="outline-3">
<h3 id="org43feb05"><span class="section-number-3">2.6</span> Aesthetics</h3>
<div class="outline-text-3" id="text-2-6">
</div>
<div id="outline-container-org545e3af" class="outline-4">
<h4 id="org545e3af"><span class="section-number-4">2.6.1</span> Highlighting zetteldeft links</h4>
<div class="outline-text-4" id="text-2-6-1">
<p>
To highlight zetteldeft links, let&rsquo;s add a <code>font-lock</code> keyword to <code>org-mode</code>.
</p>

<p>
Currently, the regexp to find links is hardcoded.
</p>

<p>
Highlighting not working in comments.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(font-lock-add-keywords 'org-mode '(
  (<span style="color: #98be65;">"&#167;[0-9]\\{2,\\}-[0-9-]+"</span> . font-lock-warning-face)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc144599" class="outline-3">
<h3 id="orgc144599"><span class="section-number-3">2.7</span> End of package</h3>
<div class="outline-text-3" id="text-2-7">
<p>
That&rsquo;s all folks!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">provide</span> '<span style="color: #a9a1e1;">zetteldeft</span>)
<span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">zetteldeft.el ends here</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4cbf40d" class="outline-2">
<h2 id="org4cbf40d"><span class="section-number-2">3</span> Suggested setup</h2>
<div class="outline-text-2" id="text-3">
<p>
The following assumes <code>deft</code> is loaded manually in your dotfile, it merely configures the package.
</p>

<p>
None of these code blocks are tangled into the <code>.el</code> file, they are here merely as a guide.
</p>
</div>

<div id="outline-container-org94436da" class="outline-3">
<h3 id="org94436da"><span class="section-number-3">3.1</span> Suggested <code>zeteldeft</code> keybindings</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org29660cb" class="outline-4">
<h4 id="org29660cb"><span class="section-number-4">3.1.1</span> Keybindings with <code>general</code></h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
To call <code>zetteldeft</code> functions from anywhere behind a leader key such as <code>SPC</code>, I recommend <code>general.el</code> with the following setup.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(general-define-key
  <span style="color: #c678dd;">:prefix</span> <span style="color: #98be65;">"SPC"</span>
  <span style="color: #c678dd;">:non-normal-prefix</span> <span style="color: #98be65;">"C-SPC"</span>
  <span style="color: #c678dd;">:states</span> '(normal visual motion emacs)
  <span style="color: #c678dd;">:keymaps</span> 'override
  <span style="color: #98be65;">"d"</span>  '(nil <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"deft"</span>)
  <span style="color: #98be65;">"dd"</span> '(deft <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"deft"</span>)
  <span style="color: #98be65;">"dD"</span> '(zd-deft-new-search <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"new search"</span>)
  <span style="color: #98be65;">"dR"</span> '(deft-refresh <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"refresh"</span>)
  <span style="color: #98be65;">"ds"</span> '(zd-search-at-point <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"search at point"</span>)
  <span style="color: #98be65;">"dc"</span> '(zd-search-current-id <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"search current id"</span>)
  <span style="color: #98be65;">"df"</span> '(zd-avy-file-search <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"avy file search"</span>)
  <span style="color: #98be65;">"dF"</span> '(zd-avy-file-search-other-window <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"avy file other window"</span>)
  <span style="color: #98be65;">"dl"</span> '(zd-avy-link-search <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"avy link search"</span>)
  <span style="color: #98be65;">"dt"</span> '(zd-avy-tag-search <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"avy tag search"</span>)
  <span style="color: #98be65;">"dT"</span> '(zd-tag-buffer <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"tag list"</span>)
  <span style="color: #98be65;">"di"</span> '(zd-find-file-id-insert <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"insert id"</span>)
  <span style="color: #98be65;">"dI"</span> '(zd-find-file-full-title-insert <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"insert full title"</span>)
  <span style="color: #98be65;">"do"</span> '(zd-find-file <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"find file"</span>)
  <span style="color: #98be65;">"dn"</span> '(zd-new-file <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"new file"</span>)
  <span style="color: #98be65;">"dN"</span> '(zd-new-file-and-link <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"new file &amp; link"</span>)
  <span style="color: #98be65;">"dr"</span> '(zd-file-rename <span style="color: #c678dd;">:wk</span> <span style="color: #98be65;">"rename"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1554612" class="outline-4">
<h4 id="org1554612"><span class="section-number-4">3.1.2</span> Spacemacs keybindings</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
Suggested keybindings for <code>spacemacs</code>.
</p>

<p>
These can be called from anywhere behind <code>SPC d</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Prefix</span>
(spacemacs/declare-prefix <span style="color: #98be65;">"d"</span> <span style="color: #98be65;">"deft"</span>)
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Launch deft</span>
(spacemacs/set-leader-keys <span style="color: #98be65;">"dd"</span> 'deft)
(spacemacs/set-leader-keys <span style="color: #98be65;">"dD"</span> 'zd-deft-new-search)
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">SEARCH</span>
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Search thing at point</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"ds"</span> 'zd-search-at-point)
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Search current file id</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"dc"</span> 'zd-search-current-id)
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Jump &amp; search with avy </span>
 <span style="color: #5B6268;">;  </span><span style="color: #5B6268;">search link as filename</span>
    (spacemacs/set-leader-keys <span style="color: #98be65;">"df"</span> 'zd-avy-file-search)
    (spacemacs/set-leader-keys <span style="color: #98be65;">"dF"</span> 'zd-avy-file-search-other-window)
 <span style="color: #5B6268;">;  </span><span style="color: #5B6268;">search link as contents</span>
    (spacemacs/set-leader-keys <span style="color: #98be65;">"dl"</span> 'zd-avy-link-search)
 <span style="color: #5B6268;">;  </span><span style="color: #5B6268;">search tag as contents</span>
    (spacemacs/set-leader-keys <span style="color: #98be65;">"dt"</span> 'zd-avy-tag-search)
 <span style="color: #5B6268;">;  </span><span style="color: #5B6268;">find all tags</span>
    (spacemacs/set-leader-keys <span style="color: #98be65;">"dT"</span> 'zd-tag-buffer)
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">LINKS</span>
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Insert link from filename</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"di"</span> 'zd-find-file-id-insert)
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Insert link with full filename</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"dI"</span> 'zd-find-file-full-title-insert)
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">FILES</span>
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Open file</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"do"</span> 'zd-find-file)
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Create new file</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"dn"</span> 'zd-new-file)
   (spacemacs/set-leader-keys <span style="color: #98be65;">"dN"</span> 'zd-new-file-and-link)
 <span style="color: #5B6268;">; </span><span style="color: #5B6268;">Rename file</span>
   (spacemacs/set-leader-keys <span style="color: #98be65;">"dr"</span> 'zd-file-rename)
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">UTILITIES</span>
(spacemacs/set-leader-keys <span style="color: #98be65;">"dR"</span> 'deft-refresh)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgee8e305" class="outline-3">
<h3 id="orgee8e305"><span class="section-number-3">3.2</span> Suggested <code>deft</code> setup</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org172bba2" class="outline-4">
<h4 id="org172bba2"><span class="section-number-4">3.2.1</span> Notes &amp; extensions</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
Note extensions are <code>md</code>, <code>txt</code> and <code>org</code>.
First of this list is the default for new notes.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">setq</span> deft-extensions '(<span style="color: #98be65;">"org"</span> <span style="color: #98be65;">"md"</span> <span style="color: #98be65;">"txt"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge192f76" class="outline-4">
<h4 id="orge192f76"><span class="section-number-4">3.2.2</span> Set <code>deft-directory</code></h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Search the deft directory recursively, to include subdirectories.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">setq</span> deft-directory (concat org-directory <span style="color: #98be65;">"/notes/zetteldeft"</span>))
(<span style="color: #51afef;">setq</span> deft-recursive t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b82773" class="outline-4">
<h4 id="org8b82773"><span class="section-number-4">3.2.3</span> Additional <code>deft</code> functions</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Some personal additions.
</p>

<p>
A small function to open a file in the other window and shifting focus to it.
That final part is what the <code>t</code> argument does.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">efls/deft-open-other</span> ()
 (<span style="color: #51afef;">interactive</span>)
 (deft-open-file-other-window t))
</pre>
</div>

<p>
Let&rsquo;s add another function, to simply preview in the other window, i.e. not switch focus to it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">defun</span> <span style="color: #c678dd;">efls/deft-open-preview</span> ()
 (<span style="color: #51afef;">interactive</span>)
 (deft-open-file-other-window))
</pre>
</div>


<p>
To select results from the item list without leaving the <code>insert</code> state, I add the following keys.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">with-eval-after-load</span> 'deft
  (define-key deft-mode-map
    (kbd <span style="color: #98be65;">"&lt;tab&gt;"</span>) 'efls/deft-open-preview)
  (define-key deft-mode-map
    (kbd <span style="color: #98be65;">"&lt;s-return&gt;"</span>) 'efls/deft-open-other)
  (define-key deft-mode-map
    (kbd <span style="color: #98be65;">"s-j"</span>) 'evil-next-line)
  (define-key deft-mode-map (kbd <span style="color: #98be65;">"s-k"</span>) 'evil-previous-line))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d83b69" class="outline-4">
<h4 id="org9d83b69"><span class="section-number-4">3.2.4</span> Ignore more <code>org-mode</code> metadata</h4>
<div class="outline-text-4" id="text-3-2-4">
<p>
I tend to write <code>org-mode</code> titles with <code>#+title:</code> (i.e., uncapitalized). Also other <code>org-mode</code> code at the beginning is written in lower case.
</p>

<p>
In order to filter these from the deft summary, let&rsquo;s alter the regular expression:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #51afef;">setq</span> deft-strip-summary-regexp
 (concat <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">(</span><span style="color: #98be65;">"</span>
         <span style="color: #98be65;">"[\n\t]"</span> <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">blank</span>
         <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">|</span><span style="color: #98be65;">^#\\+[a-zA-Z_]+:.*$"</span> <span style="color: #5B6268;">;;</span><span style="color: #5B6268;">org-mode metadata</span>
         <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">\\</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span>))
</pre>
</div>

<p>
Its original value was <code>\\([\n ]\\|^#\\+[[:upper:]_]+:.*$\\)</code>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org4b8c9fb" class="outline-2">
<h2 id="org4b8c9fb"><span class="section-number-2">4</span> Brainstorm</h2>
<div class="outline-text-2" id="text-4">
<p>
Some ideas for the future.
</p>
</div>

<div id="outline-container-orgec5f9d7" class="outline-3">
<h3 id="orgec5f9d7"><span class="section-number-3">4.1</span> Saved searches</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Create a list of saved searches, somewhere easily accessible.
</p>
</div>
</div>

<div id="outline-container-orgcd9bc7a" class="outline-3">
<h3 id="orgcd9bc7a"><span class="section-number-3">4.2</span> Generate list of tags</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Auto-generate a list of tags.
</p>

<p>
Might exceed my elisp-fu.
</p>
</div>
</div>

<div id="outline-container-orgc787107" class="outline-3">
<h3 id="orgc787107"><span class="section-number-3">4.3</span> HTML export</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Export HTML pages with clickeable links between notes.
</p>
</div>
</div>

<div id="outline-container-orgde80bb7" class="outline-3">
<h3 id="orgde80bb7"><span class="section-number-3">4.4</span> Markdown export</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Export markdown through <code>pandoc</code>.
</p>
</div>
</div>

<div id="outline-container-org97003a1" class="outline-3">
<h3 id="org97003a1"><span class="section-number-3">4.5</span> Templates</h3>
<div class="outline-text-3" id="text-4-5">
<p>
A system for note templates.
</p>
</div>
</div>

<div id="outline-container-org80d020b" class="outline-3">
<h3 id="org80d020b"><span class="section-number-3">4.6</span> Minor mode</h3>
<div class="outline-text-3" id="text-4-6">
<p>
Create a minor mode on top of org-mode with some niceties:
</p>
<ul class="org-ul">
<li>higlight links &amp; tags</li>
<li>clickeable links</li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
For those not yet familiar: <b>deft</b> is a note manager within <code>emacs</code>, for easily searching and retrieving plain text notes.
It is inspired by the popular Notational Velocity.
Check out <a href="https://jblevins.org/projects/deft/">jblevins.org/projects/deft/</a> and <a href="http://notational.net">notational.net</a>.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class='author'>Author: EFLS</p>

    <p class='date'>Modified: 2018-11-14 Wed 23:08</p>

    <p class='creator'><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.1 (<a href="https://orgmode.org">Org</a> mode 9.1.13)</p>
</div>
</body>
</html>
